YUI.add("contacts-smartcontacts-api",function(A){api={deleteSmartContacts:function(G,F,E){F=F||NeoConfig.socdirProxyPath;E=E||A.io;if(A.Lang.isArray(G)&&G.length>0){var C=G.length,D={ydht:{fields:{}}},B=D.ydht.fields;while(C--){B[G[C]]={"value":[0,null,-65536,1,1]};}E(F+"?/setSmartContacts?",{method:"POST",data:A.JSON.stringify(D)});}}};A.namespace("contacts.smartcontacts");A.contacts.smartcontacts.api=api;},"1.0.0",{requires:["io-base"]});YUI.add("ac-widget",function(F){var D=F.Lang,A=F.contacts,H=A.api,E=A.utils,G=F.comms;function C(J){var K=D.isUndefined,M=this,L,I;J.ac=M._getEventPlugin(J);L='<li role="option" ><span class="ac-value">{{hilite}}</span><span title="{{str_ac_remove_item}}" data-action="ac-remove-item" data-ac-sc={{isSmartContact}} data-ac-email-field-id="{{emailFieldId}}" data-ac-id="{{id}}" data-ac-email="{{email}}" class="ac-remove-item">X{{str_ac_remove_item}}</span></li>';I='<li role="option" ><span class="ac-value">{{hilite}}</span></li>';if(J.ac){C.superclass.constructor.apply(M,[J]);}M.set("itemTplNoDelete",I);M.set("itemTplWithDelete",NeoConfig.enableContactDelete?L:I);}C.NAME="ACWidget";function B(){var I=arguments;F.use("rocket-stats",function(){F.common.Utils.rocketstats.stat.apply(0,I);});}F.extend(C,G.ui.AutoComplete,{bindUI:function(I){var J=this;C.superclass.bindUI.apply(J,arguments);},_getEventPlugin:function(I){var J=false,K=D.isUndefined;if(!K(I.acNode)&&!K(I.acTarget)){J=I.acTarget.plug(G.ui.AutoCompleteEventsPlugin,{alignNode:I.acNode}).ac;}return J;},refresh:function(I){var K=this,J=false;J=K._getEventPlugin(I);if(J){I.ac=J;return K.setAttrs(I);}return K;},getItemMarkup:function(L){var I=this,K=I.updateHighlighting(L),J;if(L.isCategory){J=F.common.Utils.substitute(I.get("itemTplNoDelete"),{hilite:K},0,0,0,0,strings);}else{J=F.common.Utils.substitute(I.get("itemTplWithDelete"),{hilite:K,id:L.id,email:L.email,emailFieldId:L.emailField.id,isSmartContact:L.isSmartContact||0},0,0,0,0,strings);}return J;},buildName:function(M,K,L,I){if(M||K||L){var J=F.common.Utils.substitute(strings["str_name_format"],{given_name:M?M:"",middle_name:K?K:"",family_name:L?L:""});J=J.replace(/ +(?= )/g,"");if(I&&NeoConfig.intl==="jp"){J=J+" ("+strings.str_form_lbl_nickname+I+")";}}else{if(I){J=I;}else{J="";}}return J;},updateHighlighting:function(U){var K=U.matches,b=this;if(K&&(K.nickname||K.user||K.firstname||K.lastname||K.mobileno||K.homeno||K.workno||K.email)){var i=F.Lang.isArray(K.nickname)&&K.nickname.length>0?true:false,S=F.Lang.isArray(K.firstname)&&K.firstname.length>0?true:false,L=F.Lang.isArray(K.lastname)&&K.lastname.length>0?true:false,V=F.Lang.isArray(K.mobileno)&&K.mobileno.length>0?true:false,g=F.Lang.isArray(K.homeno)&&K.homeno.length>0?true:false,M=F.Lang.isArray(K.workno)&&K.workno.length>0?true:false,N=F.Lang.isArray(K.email)&&K.email.length>0?true:false;var m=U.user||null,d=U.nickname||null,h=U.firstname||null,P=U.lastname||null,W=U.mobileno||null,R=U.homeno||null,Q=U.workno||null,Z=U.email||null,k=U.sc_score;var j=i?b._hlMatch(d,K.nickname):(d&&d.length>0?d:null),J=S?b._hlMatch(h,K.firstname):(h&&h.length>0?h:null),e=L?b._hlMatch(P,K.lastname):(P&&P.length>0?P:null),T=V?b._hlMatch(W,K.mobileno):null,c=g?b._hlMatch(R,K.homeno):null,I=M?b._hlMatch(Q,K.workno):null,f=N?b._hlMatch(Z,K.email):null;var a,l,X,Y;l="";l=b.buildName(J,"",e,j);j=i?j:null;J=S?J:null;e=L?e:null;X="";if(f){X+=f;}else{X+=Z;}a=l||"";a=F.Lang.trim(a);if(a!=""){if(NeoConfig.bidi){Y=F.Intl.detectDirection(a.replace(/<\/?b\>/,""));a="<span dir="+Y+">"+a+"</span>";}else{a="<span>"+a+"</span>";}}if(X.length>0){if(a.length>0){a+=" ";}if(a==""){a+="<em class='email no-name' dir='ltr'>"+X+"</em>";}else{a+="<em class='email' dir='ltr'>("+X+")</em>";}}}function O(r,q,o,p,n){switch(q){case"amp":if(o){return"&"+o+";";}else{return"&";}case"#39":return"'";case"quot":return'"';case"lt":return"<";case"gt":return">";case"#35":return"#";default:return"";}}a=a.replace(/&((?:[a-zA-Z]+)|(?:#[0-9]+));(?:([a-zA-Z]+|(?:#[0-9]+));)?|([;,])/gi,O);if(NeoConfig.smartcomplete_enabled=="debug"){if(F.UA["gecko"]){a+='<span style = "float:right; margin-top: -15px; color:red;">'+k.toFixed(6);+"</span>";}else{a+='<span style = "float:right; color:red;">'+k.toFixed(6);+"</span>";}}return a;},_hlMatch:function(I,N){var O=I;var K,M,J,P,L;N.sort(this._sortMatches);M=O.length;for(K=N.length-1;K>=0;K--){J=N[K];if(NeoConfig.bidi){P=O.substring(0,J.startIndex);L=O.substring(J.endIndex,M)+O.substring(M);O=P+F.comms.Intl.highlightString(O.substring(J.startIndex,J.endIndex),P,L)+L;}else{O=O.substring(0,J.startIndex)+this.hlFn(O.substring(J.startIndex,J.endIndex))+O.substring(J.endIndex,M)+O.substring(M);}M=J.startIndex;}O=O.substring(0,M)+O.substring(M);return O;},hlFn:function(I){return"<b>"+I+"</b>";},_sortMatches:function(J,I){if(typeof J==="object"&&typeof I==="object"&&typeof J.startIndex==="number"&&typeof I.startIndex==="number"){return +(J.startIndex-I.startIndex);}else{return 0;}},click:function(L){var P=this,O=P.get("ac");L.halt();if(L.target.hasClass("ac-remove-item")){var K=L.target,Q=parseInt(K.getAttribute("data-ac-sc"),10),I=K.getAttribute("data-ac-id"),N=K.getAttribute("data-ac-email-field-id"),M=K.getAttribute("data-ac-email");F.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_generic",function(V){var W=V.common.Utils.substitute(V.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"ok",btnLabel:strings.str_delete}),S=V.common.Utils.substitute(V.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"cancel","default":"default",btnLabel:strings.str_btn_cancel}),U={hd:strings.str_address_remove_hd,bd:V.common.Utils.substitute(Q?strings.str_sc_remove_bd:strings.str_contacts_remove_bd,{name:M}),ft:W+S},T={ok:{handler:function(){V.contacts.smartcontacts.api.deleteSmartContacts([M]);var X=new G.FilterContacts();V.contacts.api.removeEmail(I,parseInt(N),X.buildContactsIndex);O.set("queryValue","");B("autocomplete-delete",Q?"smartContact":"ABContact");U={hd:strings.str_address_removed_hd,bd:V.common.Utils.substitute(strings.str_address_removed_bd,{name:M}),ft:V.common.Utils.substitute(V.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"ok",btnLabel:strings.str_ok})};V.common.ui.DialogHelper.createCommon(U);}},cancel:{handler:function(){O.set("queryValue","");}}},R=function(X){};V.common.ui.DialogHelper.createCommon(U,T,R);});}else{var J=L.currentTarget.one(".ac-value").get("text");
O.set("queryValue",J);P["_selectedIndex"]=-1;O.get("host").simulate("keydown",{keyCode:13});P._currentValue=J;O.get("host").focus();}P.hide();},handleEnter:function(O,J){var M=J.get("ac"),I=J["_selectedIndex"],L,P;O.halt();var K=new G.FilterContacts();if(J.get("data").queryStr!=M.get("queryValue")){K.updateFilterItems(M.get("queryValue"));var N=K.filterContacts(E.getSortedFlatContacts(["firstname","lastname","email"]));J.setAttrs({query:M.get("queryValue"),data:N}).drawMarkUp().setAlign().show();}if(I!=-1){L=J.item(I);if(L){P=L.one(".ac-value").get("text");M.set("queryValue",P);}J["_selectedIndex"]=-1;M.get("host").focus();J.hide();}}});F.namespace("contacts.ui");F.contacts.ui.ACWidget=C;},"1.0.0",{requires:["overlay","node-event-simulate","comms-ui-autocomplete-plugin","comms-ui-autocomplete","contacts-api-utils","contacts-api","filter-contacts","common-utils","comms-intl-bidihighlight","contacts-smartcontacts-api"]});YUI.add("mail-controller-compose-text",function(A){A.namespace("mail.Controller");var J=A.common.Utils,B=A.common.persist.UserData,P={address:1,blockquote:1,body:1,caption:1,center:1,col:1,colgroup:1,dd:1,dir:1,div:1,dl:1,dt:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,li:1,menu:1,ol:1,p:1,pre:1,table:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,ul:1};function C(S,T){var U=S.cloneNode(true),R=A.Node.getDOMNode(U),Q=F(R);if(T){Q=I(Q,true);}return Q;}function L(S,U){var Q=A.Node.create("<div>"+S+"</div>"),T=A.Node.getDOMNode(Q),R=F(T);if(U){R=I(R);}return R;}function F(R){var Q=A.UA.ie;if(!Q){K(R);}else{R.innerHTML=R.innerHTML.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"<BR/>");}return M(R,false,"").replace(/\n[\s\xA0]+$/,"");}function M(T,X,Y){if(T.nodeType===1||T.nodeType===11){var S=T.tagName;if(A.UA.ie&&T.tagName=="DIV"&&T.getAttribute("class")&&T.getAttribute("class")!=null&&T.getAttribute("class").indexOf("hr")!=-1){S="HR";}switch(S){case"SCRIPT":case"STYLE":case"LINK":case"OBJECT":case"EMBED":return"";case"HR":var a=T.previousSibling;return(G(a)?"":"\n")+Y+"________________________________\n"+Y;case"BR":return"\n"+Y;case"BLOCKQUOTE":Y+=">";default:var V=[];var Q=T.firstChild;var W=0;while(Q!==null){var Z=M(Q,Q.tagName==="PRE",Y);if(Q.nodeType===1){if(H(Q)==="block"&&V.length>0&&Q.tagName!=="TD"){var U=Z.match(/^[ \t\r\n\v\f]*$/);if(!U||Q.tagName==="LI"){V.push("\n"+Y);}}switch(Q.tagName){case"LI":W++;V.push("\t"+(Q.parentNode.tagName==="OL"?W+".":"*")+" ");break;}}if(Z){V.push(Z);}if(Q.nodeType===1){switch(Q.tagName){case"TD":V.push(" ");break;}}Q=Q.nextSibling;}return V.join("");}}else{if(T.nodeType===3){var V=T.nodeValue;if(!X){var a=T.previousSibling;var R=a?H(a):null;V=G(a)?V:V.replace(/\n[ \t\r\n\v\f]+/g," ");if(a===null||G(a)){V=V.replace(/^[ \t\r\n\v\f]+/,"");}else{if(R==="block"){V=V.replace(/^[ \t\r\n\v\f]+/,"\n");}else{if(R==="inline"){V=V.replace(/^[ \t\r\n\v\f]+/," ");}}}V=V.replace(/[ \t\r\n\v\f]+$/," ");}return V;}else{return"";}}}function G(Q){if(Q===null||Q.nodeType!==1){return false;}return Q.tagName==="BR";}function H(Q){if(Q===null||Q.nodeType!==1){return null;}if(Q.style.display){if(Q.style.display==="block"){return"block";}else{if(Q.style.display==="inline"){return"inline";}}}return P[Q.tagName.toLowerCase()]?"block":"inline";}function K(T){if(T.nodeType===1||T.nodeType===11){var R=T.firstChild;while(R!==null){var V=R.nextSibling;K(R);R=V;}}else{if(T.nodeType===3){var S=T.nodeValue;if(S.match(/^[ \t\r\n\v\f]*$/)){var Q=T.previousSibling;var U=Q?H(Q):"inline";if(U==="inline"&&!G(Q)){T.nodeValue=T.nodeValue.replace(/\n.*/," ");}else{T.parentNode.removeChild(T);}}}}}function I(R,Q){R=J.escapeHtml(R);R=O(R);if(Q){R=R.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");R=R.replace(/( ){2}/g,"&nbsp;&nbsp;");}R=R.replace(/\n/ig,"<br />");return R;}function O(R){R=R.replace(/(https?:\/\/[^\s<]+)/ig,"<a target='_blank' href=''>$1</oa>");R=R.replace(/([^\/])(www\.(\w+\.)+[^\s<]+)/ig,"$1<a target='_blank' href='http://'>$2</oa>");R=R.replace(/^(www\.(\w+\.)+[^\s<]+)/ig,"<a target='_blank' href='http://'>$1</oa>");R=R.replace(/((&lt;|&gt;|[^A-Za-z0-9#_\/]){1,10})<\/oa>/g,"</oa>$1");var Q;try{Q=new RegExp("'>([^<]+?)</oa>","g");}catch(S){Q=new RegExp("'>([^<]+)","g");}R=R.replace(Q,"$1'>$1</a>");return R;}function D(W,S,U){var T,Q,V=U&&U.isRich,R,X=U&&U.text;if(!X){return"";}X=N(X,V);if(!V){X=E(X);}else{if(!S){try{R="<br>";X=X.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,R);X=X.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,R);X=X.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,R);X=X.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,R);X=X.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,R);X=X.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,R);X=X.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"");X=X.replace(/<\/p>/gi,R);X=X.replace(/(<hr\s*>)/gi,R+"________________________________"+R);X=L(X,true);}catch(T){}}}W=W||"";Q=W!="";if(X!=""){if(A.UA.ie||A.UA.webkit){if(Q){W=W+"<div></div><div>&nbsp;</div>"+X;}else{W="<div></div><div>&nbsp;</div>"+X+W;}}else{if(Q){W=W+"<div>&nbsp;</div>"+X;}else{W="<div>&nbsp;</div>"+X+W;}}}return W;}function N(R,Q){if(R!=null){if(!Q){return R.replace(/<vbr>|\n/gi,"<br />");}else{R=R.replace(/<vbr>/gi,"");}}return R||"";}function E(S){var R,Q;S=A.common.Utils.unescapeHtml(S);S=S.replace(/<hr\s*[^>]*>/gi,"<div><hr></div>");S=S.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklineppblanklinepstartptag");S=S.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklinepstartptag");S=S.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,"endptagpblanklinepstartptag");S=S.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"endptagpblanklinepstartptag");S=S.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,"brtag");S=S.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,"brtag");S=S.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");S=S.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");S=S.replace(/<\/p>/gi,"endptag");R=S.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]ltr[\'|\"]\s*[^>]*>/gi,"ltrstartptag");R=R.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]rtl[\'|\"]\s*[^>]*>/gi,"rtlstartptag");R=R.replace(/(<div\s+[^>]*>)|(<div\s*>)/gi,"startptag");S=R.replace(/<\/div>/gi,"endptag");Q=A.common.Utils.escapeHtml(S);Q=Q.replace(/brtag/g,"<br />");Q=Q.replace(/ltrstartptag/g,"<div dir='ltr'>");Q=Q.replace(/rtlstartptag/g,"<div dir='rtl'>");Q=Q.replace(/startptag/g,"<div>");Q=Q.replace(/endptag/g,"</div>");Q=Q.replace(/pblanklinep/g,"<br/><br/>");return Q;}A.mix(A.mail.Controller.Compose,{convertToPlain:C,convertHTMLToPlain:L,convertGuts:F,injectSignature:D});},"1.0.0",{requires:["common-persist-user-data","mail-controller-compose"]});YUI.add("mail-ui-mailcompose-base-header",function(t){var O=t.common.Utils.substitute,AS=t.Lang.trim,N=t.Node.create,J=t.mail.Controller.Compose,AO=t.common.persist.UserData,E=t.mail.persist.MetaData,AC=t.common.Utils,n=t.mail.ui.PaneUtils,O=AC.substitute,AL=AC.escapeHtml,D=AC.unescapeHtml,W=strings.str_cfg_tog_unescape_ncr,AT=t.ui.Templates,s=AT._shared_module_compose_message_header&&AT._shared_module_compose_message_header.compose_from_address,k=t.contacts,T=k.api,Z=k.utils,AZ="neo.pref.compose.showBcc",AB="hidden",u="focus",AV="offscreen",AD="restore",R="move",H="reply_all",AF="reply_sender";var I=function(Y,Ab){var Ac=this;Ac.isLozengeHighlighted=false;Ac.allLozengesSelected=false;Ac.composeView=Ab;Ac.listeners=[];};function AJ(){}function K(){var Ah={},Ai=(AO.get("externalAccounts")||{}).extAccount||[],Ab=(AO.get("aliases")||{}).alias||[],Y=(AO.get("disposableAddresses")||{}).deaName||[],Ag=Ai.concat(Ab,Y),Ae=AO.get("userSendPref"),Ac,Ad,Af=Ag.length;Ah[Ae.defaultID]=1;Ah[Ae.defaultFromAddress]=1;for(Ad=0;Ad<Af;Ad++){if((Ac=Ag[Ad].address)){Ah[Ac]=1;}}return Ah;}function m(){if(t.ACWidgetInst){t.ACWidgetInst.hide();}}function B(Y){Y.removeAttribute("aria-owns");Y.removeAttribute("aria-activedescendant");}function AU(Y){Y.removeAttribute("aria-describedby");}function P(){var Y=t.ACWidgetInst;Y.get("ac").get("host").set("aria-owns",Y.get("contentBox").generateID());}function AR(Y){var Ad=Y.ancestor("ul"),Ac=Ad.all(".lozenge-static"),Ab;if(Ac.size()>0){Ab=[];Ac.each(function(Ae){Ab.push(Ae.generateID());});}if(Ab){Y.set("aria-describedby",Ab.join(" "));}else{Y.removeAttribute("aria-describedby");}}function i(Ac){var Ab=Ac.get("value"),Af=Ab.length,Ae=parseInt(Ac.ancestor(".ac-input").getStyle("width"),10)-40,Ad=150,Y=17;if(Af>Y){Ad+=(Af-Y)*10;if(Ad>Ae){Ad=Ae;}Ac.setStyle("width",Ad+"px");}else{Ac.setStyle("width","");}}function AN(Ag){var Y=false,Ac=null,Ab=null,Ae=/(<[^<>]+@[^<>]+\.[^<>]+>)|(\([^\(\)]+@[^\(\)]+\.[^\(\)]+\))|(\[[^\[\]]+@[^\[\]]+\.[^\[\]]+\])/,Af,Ad=Ag.replace(/\".*\"/g,"");if(!AS(Ad)||Ad.indexOf("@")<0){return{fail:true,email:Ag,name:Ag};}if(Ae.test(Ag)){Af=Ag.match(Ae);Ab=Af[0];Ac=AS(Ag.replace(Ab,""));Ab=Ab.substring(1,Ab.length-1);}else{Ab=Ac=AS(Ag);}if(!t.comms.Utils.isValidEmail(Ab)){Y=true;}return{fail:Y,email:Ab,name:Ac};}function V(Ab){var Ag=0,Ad=0,Ac=Ab.length,Y=[],Af=false,Ah=false;for(Ad=0;Ad!=Ac;Ad++){var Ae=Ab.charAt(Ad);switch(Ae){case'"':Af=!Af;break;case"&":Ah=true;break;case";":if(Ah){Ah=false;break;}case",":if(!Af){Y.push(Ab.slice(Ag,Ad));Ag=Ad+1;}}}if(Ag!=Ad){Y.push(Ab.slice(Ag,Ad));}return Y;}function v(Y){var Ad=this,Ac=Y.ancestor("ul"),Ab=Ac.all(".hLozenge");if(Ab){B(Y);AU(Y);Ab.remove();}}function c(){var Ab=this,Y;if(!Ab.isLozengeHighlighted){return;}Y=Ab.composeView.baseNode.all(".hLozenge.focus");Y.removeClass(u);B(t.all("#to-field, #cc-field, #bcc-field"));Ab.allLozengesSelected=false;Ab.isLozengeHighlighted=false;}function AY(Ab,Y){var Ad=this;Ad._removeLozengeHighlights();Ab.toggleClass(u);Ad.isLozengeHighlighted=true;var Ac=Ab.one(".lozenge-static").generateID();Y.setAttrs({"aria-owns":Ac,"aria-activedescendant":Ac});if(!t.UA.ie&&Ad.composeView.type=="fullCompose"){Ab.scrollIntoView();}}function o(Y){var Ad=this,Ac=Y.ancestor("ul"),Ab=Ac.all(".hLozenge");if(Ab){Ab.addClass(u);Ad.isLozengeHighlighted=true;}Ad.allLozengesSelected=true;}function AX(Y){var Ae=this,Ac,Ab,Ad;Ac=Y.ancestor();Ab=AS(Y.get("value"));if(!AS(Ab)){Y.set("value","");return;}if(Ab&&Ab.indexOf('"')>-1){Ad=V(Ab);}else{if(Ab.lastIndexOf(",")===(Ab.length-1)){Ab=Ab.substring(0,Ab.length-1);}Ad=Ab.split(/[;,]+/);}Ae._makeLozenges(Ad,Ac);AR(Y);Y.set("value","");}function AW(Ag,Ae){var Ah=this,Ab,Y=Ag.length,Ac,Af,Ad;for(Ab=0;Ab<Y;Ab++){Ac=Ag[Ab];AS(Ac);if(Ac){Af=AN(Ac);Ad=Ah._createLozenge(Af);Ae.insert(Ad,Ae);Ah.composeView._setDirty();}}}function AP(Ae){var Ah,Ad;if(!Ae){return null;}Ae.name=Ae.name||Ae.email;if(strings.str_cfg_tog_compose_enable_nickname){var Y=Z.getContactsByEmail(Ae.email),Ac;if(Y){Ac=Z.getFirstFieldValue(Y[0],"nickname");if(Ac){Ae.isNN=true;Ae.name=Ac;}}}if(!Ah){Ah={email:Ae.email,firstName:Ae.name||Ae.email};}if(Ae.fail){Ad=strings.str_comp_error_email_lozenge_attr;}else{Ad=Ae.email;}var Ab,Ag={label:D(Ae.name),hover:D(Ad),state:Ae.fail?"error":"normal",data:Ae,menu:null,edit:true,copy:true};Ab=new t.comms.ui.Lozenge(Ag);var Af=Ab.getNode();Af.set("role","presentation");return Af;}function AH(Ag){var Ah=Ag.getData("lozenge");var Ad=Ah.data;var Af=Ah.error;if(strings.str_cfg_tog_compose_enable_nickname){if(Ad.name&&Ad.isNN){var Ac=t.contacts.utils,Ab=Ac.getContactsByEmail(Ad.email),Ae,Y;Ae=Ac.getFirstFieldValue(Ab[0],"name");Y=Ae?(Ae.familyName+" "+Ae.givenName):"";Ad.name=Y;}}if(Af){this.currentAddress=Ad.email;this.validAddress=false;}else{this[this.currentField].push(Ad);}}function z(){var Aj=this,Ae={to:[],cc:[],bcc:[],validAddress:true,currentAddress:"",currentField:""},Ah,Al,Am,Ag,An,Ak,Ac,Y,Ab,Ai,Af,Ad;Ah=Aj.composeView.baseNode.one(".cm-to.ac-input").all(".hLozenge");Ae.currentField="to";Ah.each(AH,Ae);Al=Aj.composeView.baseNode.one(".cm-cc.ac-input").all(".hLozenge");Ae.currentField="cc";Al.each(AH,Ae);Am=Aj.composeView.baseNode.one(".cm-bcc.ac-input").all(".hLozenge");Ae.currentField="bcc";Am.each(AH,Ae);An=((AO.get("externalAccounts")||{}).extAccount||[]).length;Ak=((AO.get("aliases")||{}).alias||[]).length;Ac=((AO.get("disposableAddresses")||{}).deaName||[]).length;if((An>0)||(Ak>0)||(Ac>0)){if(Aj.composeView.type&&Aj.composeView.type==="inlineCompose"){Ae.from={email:Aj.composeView.cdo.get("header").from.email,name:Aj.composeView.cdo.get("header").from.name};}else{Y=Aj.composeView.baseNode.one(".from-select").get("value");Ab=Y.lastIndexOf("<");Ai=Y.lastIndexOf(">");Af=Y.substring(Ab+1,Ai);Ad=Y.substring(0,Ab-1);Ae.from={email:Af,name:Ad};}}else{Ae.from={email:AO.get("userSendPref.defaultFromAddress"),name:AO.get("userSendPref.defaultFromName")};}Ag=Aj.composeView.baseNode.one(".cm-subject-field");if(Ag){Ae.subj=Ag.get("value");}else{Ae.subj=Aj.composeView.cdo.get("header").subject;
}return Ae;}function M(Aj){var Af=this,Ad=Af.composeView,Ac,Al,Ak,Ai=Ad.type=="inlineCompose"?Ad.baseNode.one(".thread-recipients"):null,Ag="",Y=[],Ae={to:{list:Aj.to,node:".cm-to-field"},cc:{list:Aj.cc,node:".cm-cc-field"},bcc:{list:Aj.bcc,node:".cm-bcc-field"}},Ah=function(Am){var An={to:n.getConvName(Am),email:n.getAddress(Am)};return An;};function Ab(Ao,Ap){var An=Ad.baseNode.one(Ap),Am=An.ancestor("li");if(Ai&&Ap!=".cm-bcc-field"){Y=Y.concat(Ao);}t.Array.each(Ao,function(Aq){Ac=Af._createLozenge({name:Aq.name,email:Aq.email});Am.insert(Ac,Am);Ad._setDirty();});AR(An);}for(Ak in Ae){if(Ae[Ak].list){Ab(Ae[Ak].list,Ae[Ak].node);}}if(Ai){Ag=n.createRecipientList(Y,AT._shared_module_thread_thread_display_rollup.recipients1,null,null,Ah);Ai.setContent(Ag);}if(Ae.cc.list&&Ae.cc.list.length!=0){Af._ccSwitch(true,false);}if(Ae.bcc.list&&Ae.bcc.list.length!=0){Af._bccSwitch(true,false);}if(Ad.type=="fullCompose"){if(Aj.from){Af._setFromMenu(Aj.from);}if(Aj.subject){Ad.baseNode.one(".cm-subject-field").set("value",Aj.subject);Ad._setDirty();}}}function C(Ab){var Ad=this,Y=Ad.composeView.baseNode.all("div.ac-input input"),Ac=Ad.composeView.baseNode.all("div.subject input");if(Ab){Y.removeAttribute("readOnly");Ac.removeAttribute("readOnly");}else{Y.setAttribute("readOnly",true);Ac.setAttribute("readOnly",true);}}function a(Ab){var Ac=this,Y=Ab.name+" "+"<"+Ab.email+">";Ac.composeView.baseNode.one(".from-select").set("value",Y);}function h(Y,Ak,Af,Am){var Ae=this,Ai,Ac,Ad,Aj=strings.str_tog_loadRTLCss?"rtl":"ltr",An,Ab=Af.fromNameDir||Aj,Al,Ag=Af.fromName||"",Ah=Af.address||"";if(!Ag&&strings.str_cfg_tog_use_default_fromname){Ag=Am;}if(NeoConfig.bidi){Al=(Ab==="rtl"?"\u202B":"\u202A")+Ag+"\u202C";An=(Aj==="rtl"?"\u202B":"\u202A")+"\u200E&lt;"+Ah+"&gt;\u200E\u202C";Ad=AL(Al)+" "+An;}else{Ad=AL(Ag,W)+" &lt;"+Ah+"&gt;";}if(Ah){Ai=O(s,{isDefault:Af.isDefault,address:Ad},Ae.composeView.formatters,null,strings);Ac=Ai.toLowerCase();Y.push(Ac);Ak[Ac]=Ai;}}function AI(){var Aq=this,As,Ac,Av=[],At=(AO.get("aliases")||{}).alias||[],Ah=At.length,Ag=AO.get("userSendPref"),Ab,Aw="",Y,Ai,Ar,Al=strings.str_tog_loadRTLCss?"rtl":"ltr",Am=AO.get("externalAccounts")||{},An=(AO.get("disposableAddresses")||{}).deaName||[],Ad=An.length,Aj=Am.extAccount||[],Au=Aj.length,Ao=Aq.composeView.baseNode.one(".from-select"),Ae={},Ak,Af;if(Ag){Aw=Ag.defaultFromName||"";if(NeoConfig.bidi){Ai=Ag.defaultFromNameDir||Al;Y=(Ai==="rtl"?"\u202B":"\u202A")+Aw+"\u202C";Ar=(Al==="rtl"?"\u202B":"\u202A")+"\u200E&lt;"+Ag.defaultFromAddress+"&gt;\u200E\u202C";Ab=AL(Y)+" "+Ar;}else{Ab=AL(Aw,W)+" "+"&lt;"+Ag.defaultFromAddress+"&gt;";}Ak=O(s,{address:Ab},Aq.composeView.formatters,null,strings);Af=Ak.toLowerCase();Av.push(Af);Ae[Af]=Ak;}for(As=0;As<Au;As++){Ac=Aj[As];if(Ac&&Ac.mailFromAllowed){Aq._buildFromAccount(Av,Ae,Ac,Aw);}}for(As=0;As<Ah;As++){Ac=At[As];if(Ac){Aq._buildFromAccount(Av,Ae,Ac,Aw);}}for(As=0;As<Ad;As++){Ac=An[As];if(Ac&&(!strings.tog_check_active_compos||Ac.activeComposition)){Aq._buildFromAccount(Av,Ae,Ac,Ac.address);}}if(Av.length>(Ag?1:0)){Aq.composeView.baseNode.one("div.account-select").removeClass(AB);}Av=Av.sort(function(Ay,Ax){if(Ay<Ax){return -1;}if(Ay>Ax){return 1;}return 0;});var Ap=[];for(As in Av){Ap.push(Ae[Av[As]]);}Ao.setContent(Ap.join(""));t.later(10,Aq,function(Ax){if(Ax>-1){Ao.set("selectedIndex",Ax);}},Ao.all("option").indexOf(Ao.one(".nsel")));}function y(){var Y=this;Y._bindUIHeader();if(Y.composeView.type=="fullCompose"){Y._buildFromMenu();}}function AK(Ab){var Ac=this,Y=E.get(AZ);Ac._bccSwitch(Y,false);}function AE(Ae){var Ad,Ac,Ab,Y=-1;if(typeof Ae.get("selectionEnd")==="number"){Y=Ae.get("selectionEnd");}else{if(document.selection&&document.selection.createRange){Ad=document.selection.createRange();Ad.moveStart("character",-Ae.get("value").length);Y=Ad.text.length;}}return Y;}function g(Y){var Ae=this,Ad=Ae.composeView.baseNode,Ac=Ad.one(".cm-bcc.ac-input").all(".hLozenge"),Ab=Ad.one(".cm-bcc-field");if(Y||(Ac.isEmpty()&&Ab.get("value").length==0)){Ae._bccSwitch(Y);E.set(AZ,Y);}else{Ae.composeView.confirm(null,strings.str_comp_conf_bcc,function(){Ac.each(function(Af){Af.remove();Ae.composeView._setDirty();});Ab.set("value","");Ae._bccSwitch(false);E.set(AZ,false);});}Ae.composeView._resizeRTE();}function AM(Ab,Y){var Ae=this,Ac=Ae.composeView.baseNode.one(".cm-btn-show-bcc"),Ad=Ae.composeView.baseNode.one(".cm-bcc-group");if(typeof Y=="undefined"){Y=true;}if(Ab){Ad.removeClass(AB);Ac.addClass(AB);Y&&Ae.composeView.setFocus("bcc");}else{Ad.addClass(AB);Ac.removeClass(AB);Y&&Ae.composeView.setFocus("cc");}Ae.composeView.attView.reposAttachObj(R);}function Aa(Af){var Ad={"to-field":".cm-to","cc-field":".cm-cc","bcc-field":".cm-bcc"},Ag=this,Ae=Af.get("id");if(Ae&&Ad[Ae]){Af.removeClass("whiteout");var Ac=Ag.composeView.baseNode.one(Ad[Ae]);var Ab=function(){t.ACWidgetInst.get("ac").on("ac:query",function(Aj){var Ap=this,Ai=Ap.get("dataSource"),Al=Aj.value,An,Ak=this.get("badResult"),Ao;if(Ak){var Am=new RegExp("^"+AL(Ak),"gi");if(Aj.value.match(Am)){this.fire("ac:load",{results:[],query:Aj.value});return;}}if(Z.areContactsLoaded()){var Ah=new t.comms.FilterContacts();Ah.updateFilterItems(Al);An=Ah.fastMatch();An.queryStr=Al;Ao=t.bind(Ap.reload,Ap,An);Ao(An);}});};if(!t.ACWidgetInst){var Y=O(AT._shared_module_offscreen_bin_compose.base,{},null,null,strings,AT);t.one(document.body).append(Y);t.ACWidgetInst=new t.contacts.ui.ACWidget({acNode:Ac,acTarget:Af,contentBox:"#ac-to-results"}).setAlign().render();Ag._setACWidgetARIAOwns();t.ACWidgetInst.after("visibleChange",function(Ak){var Aj=this.get("ac").get("host"),Ah=t.ACWidgetInst.get("contentBox").one("li"),Ai=(Ak.newVal&&Ah)?true:false;Aj.set("aria-expanded",Ai);if(!Ai){Aj.set("aria-activedescendant","");}});t.ACWidgetInst.after("selectedIndexChange",function(Ai){var Ah="";if(Ai.newVal>-1){Ah=this.get("contentBox").one(".yui3-acwidget-selected").generateID();}this.get("ac").get("host").set("aria-activedescendant",Ah);});Ab();}else{if(t.ACWidgetInst.get("ac").get("alignNode")!==Ac){t.ACWidgetInst.get("ac").destructor();
t.ACWidgetInst.refresh({acNode:Ac,acTarget:Af,width:Ac.getStyle("width")}).setAlign().render();Ab();Ag._setACWidgetARIAOwns();}}t.on("contacts:contactChanged",function(){t.ACWidgetInst.get("ac").set("badResult",false);});}}function q(){var Ab=this.listeners;if(Ab){var Ac=Ab.length,Y;for(Y=0;Y<Ac;Y++){if(Ab[Y]){Ab[Y].detach();Ab[Y]=null;}}}}function S(Ac){var Ae=this,Ab=Ac.target,Y=Ac.currentTarget,Ad=Y.ancestor("div.ac-input",false);if(Ad){Ad.addClass(u);Ad.get("parentNode").addClass("active");}Ae.composeView._registerFocus(Y);if(Ab.get("nodeName")=="INPUT"){Ae._initAutoComplete(Ab);}}function AQ(Y){if(!(t.one("div.ac-results:hover")||t.one("div.ac-results li.over"))){m();this._lozengeIt(Y.currentTarget);}}function x(Y){var Ac=this,Ab=Y.currentTarget;if(Ab&&!Ac.composeView.keepHdrFocus){Ab.removeClass(u);Ab.get("parentNode").removeClass("active");}this.handleACBlur(Y);}function j(Ac){var Ae=this,Ab=Ac.currentTarget,Y=Ae.composeView.cdo;if(Ab.get("id")=="subject-field"){var Ad=Ab.get("value");if(Ad&&Ad!=""){if(Y.oComposeData&&Y.oComposeData.header&&typeof Y.oComposeData.header.subj!="undefined"&&Y.oComposeData.header.subj!==Ad){Ae.composeView._setDirty();}}return;}Ac.halt();this.handleACBlur(Ac);}function X(Y){}function A(Ad,Ai){var Ab=this,Ae=Ad.target,Ak=Ad.keyCode,Aj,Ac,Y=Ae.ancestor("div"),Af=Y.one(".hLozenge.focus"),Ag=Ae.get("value"),Ah=Ae.get("id");if(Ah){Aj={"to_add_contacts":"to","cc_add_contacts":"cc","btn-switch-reply-mode":Ai.one("#to_add_contacts"),"bcc_show_btn":Ai.one("#cc_add_contacts"),"bcc_add_contacts":"bcc","bcc_hide_btn":Ai.one("#bcc_add_contacts")};Ac={"cc_add_contacts":Ai.one("#bcc_show_btn"),"to_add_contacts":Ai.one("#btn-switch-reply-mode"),"bcc_add_contacts":Ai.one("#bcc_hide_btn"),"to-field":Ai.one("#to_add_contacts"),"cc-field":Ai.one("#cc_add_contacts"),"bcc-field":Ai.one("#bcc_add_contacts")};if(Ae.get("nodeName")==="A"||(!Ag&&!Af)||(Ag&&AE(Ae)===Ag.length)){focusNode=(Ak==37?Aj[Ah]:Ac[Ah]);if(focusNode){Ab.composeView.setFocus(focusNode);return;}}}if(!Ae.get("value")){Ad.preventDefault();if(Af){if(Ak==37){nextLozenge=Af.previous();}else{nextLozenge=Af.next();if(!nextLozenge.hasClass("hLozenge")){nextLozenge=null;Ab._removeLozengeHighlights();Ae.removeClass("whiteout");}}if(nextLozenge){Ab._removeLozengeHighlights();Ab._selectSingleLozenge(nextLozenge,Ae);}}else{if(Ak==37){listItem=Ae.ancestor();nextLozenge=listItem.previous();if(nextLozenge){Ab._removeLozengeHighlights();Ab._selectSingleLozenge(nextLozenge,Ae);Ae.addClass("whiteout");}}}}}function l(Af){var Ah=this,Ae=Af.keyCode,Ad=Af.target;if(!Ad.get("value")){var Ac=Ad.ancestor(),Ab=Ad.ancestor("div"),Ag=Ab.all(".hLozenge.focus"),Y=Ag.size();Af.halt();if(Ah.allLozengesSelected){Ah.removeAllLozenges(Ad);Ad.removeClass("whiteout");return;}if(Y){Ah.removeARIAFocus(Ad);Ah.removeARIADescription(Ad);if(Y==1){focusedLozenge=Ag.item(0);nextLozenge=focusedLozenge.next();if(nextLozenge==Ac){nextLozenge=focusedLozenge.previous();}if(nextLozenge){Ah._selectSingleLozenge(nextLozenge,Ad);}else{Ad.removeClass("whiteout");}}else{Ad.removeClass("whiteout");}Ah.composeView._setDirty();Ag.detachAll();Ag.remove();Ag=null;}else{if(Ae==8){nextLozenge=Ac.previous();if(nextLozenge){Ah._removeLozengeHighlights();Ah._selectSingleLozenge(nextLozenge,Ad);Ad.addClass("whiteout");}}}}}function L(){var Y=t.ACWidgetInst;return(Y&&Y.isVisible()&&Y.get("data").length>0);}function d(Ac,Ag){var Af=this,Al=t.ACWidgetInst,Ak=Ac.decodeCategory(Ag.get("value"));if(Ak){function Aj(As,Ar,Ap,Aq,Ao){switch(Ar){case"amp":if(Ap){return Aj(As,Ap,"",Aq+5,Ao);}return"&";case"#39":return"'";case"quot":return'"';case"lt":return"<";case"gt":return">";case"#35":return"#";default:return"";}}var Am,Ai=[];for(Am in Ak){var Ah=Ak[Am];if(Ah){var Ab="",Ad=Ah.firstname&&AL(Ah.firstname),An=Ah.middlename&&AL(Ah.middlename),Ae=Ah.lastname&&AL(Ah.lastname),Y=Ah.nickname&&AL(Ah.nickname);Ab=Al.buildName(Ad,An,Ae,Y);Ab=Ab+"("+Ah.email+")";Ai.push(Ab.replace(/&((?:[a-zA-Z]+)|(?:#[0-9]+));(?:([a-zA-Z]+|(?:#[0-9]+));)?|([;,])/gi,Aj));}}Af._makeLozenges(Ai,Ag.ancestor());Af.addARIADescription(Ag);Ag.set("value","");}else{Af._lozengeIt(Ag);}}function e(Af){var Ae=this,Ag=Af.target,Ai=Af.shiftKey,Ab=Af.ctrlKey,Ah=Af.metaKey,Y=Af.altKey,Ak=(t.UA.os=="macintosh")?Ah:Ab,Aj=t.ACWidgetInst;if(Ag.get("nodeName")==="A"||(Ab||Ah)){return;}var Ac=new t.comms.FilterContacts();if(Ae.canACWidgetInstHandleEnter()){Aj.handleEnter(Af,Aj);}else{Ac.updateFilterItems(Ag.get("value"));var Al=Ac.fastMatch();if(Al&&Al.length){var Ad=Al[0];Ag.set("value",N(Aj.getItemMarkup(Ad)).get("text"));}else{}}Af.halt();if(!Ag.get("value")){Af.preventDefault();addressField=Ag.ancestor("div");focusedLozenge=addressField.one(".hLozenge.focus");if(focusedLozenge){focusedLozenge.getData("lozenge").startEdit();}return;}Ae.setACCategory(Ac,Ag);}function f(Ae){var Ad=this,Af=Ae.target,Ah=Ae.shiftKey,Ab=Ae.ctrlKey,Ag=Ae.metaKey,Y=Ae.altKey,Aj=(t.UA.os=="macintosh")?Ag:Ab,Ai=t.ACWidgetInst,Ac=(data=Ai.get("data"))&&data.length;if((Ab||Ag)||!Af.get("value")){return;}if(Ac>=2){return;}else{if(Ac==1){Ae.halt();if(Ai&&Ai.isVisible()){Af.simulate("keydown",{keyCode:13});}}else{Ae.halt();Ad._lozengeIt(Af);}}}function Q(Ac){var Af=this,Ab=Ac.target,Ae=Ac.ctrlKey,Ad=Ac.metaKey,Y=(t.UA.os=="macintosh")?Ad:Ae;if((!Ae&&!Ad)||Ab.get("value")){return;}Ac.halt();Af._selectAllLozenges(Ab);Ab.addClass("whiteout");}function b(Ae){var Ad=this,Af=Ae.target,Ah=Ae.shiftKey,Ab=Ae.ctrlKey,Ag=Ae.metaKey,Y=Ae.altKey,Aj=(t.UA.os=="macintosh")?Ag:Ab,Ai=t.ACWidgetInst,Ac=(data=Ai.get("data"))&&data.length;if(!Af.get("value")&&!Ai.isVisible()){return;}if(!Ab&&!Ag&&!Y){if(Ac>=1){Ae.halt();}Ad.composeView.keepHdrFocus=true;Af.simulate("keydown",{keyCode:13});}}function U(Ad,Ah){var Ag=this,Ac=Ad.target,Af=Ad.ctrlKey,Ae=Ad.metaKey,Ab=(t.UA.os=="macintosh")?Ae:Af;function Y(){var Ai=Ac,Al=Ag.composeView.baseNode.one(".compose-header"),Ak=t.mail.ui.MessagePaneUtils,Aj="";Al.all("li.focus").each(function(Am){Aj+=Am.one("input").get("value");Aj+="; ";});
if(Aj!=""){Aj=Aj.substring(0,Aj.length-1);Ak.initializeCopyText();Ak.copyToClipboard(Aj,null,document.activeElement);}}if(Ab){Ad.stopPropagation();Y();}}function AA(Ac){var Af=this,Ab=Ac.target,Ae=Ac.ctrlKey,Ad=Ac.metaKey,Y=(t.UA.os=="macintosh")?Ad:Ae;if(Y){setTimeout(function(){Af.updateTextField(Ab);},0);}}function AG(Ad){var Ag=this,Ac=Ad.target,Y=Ad.shiftKey,Af=Ad.ctrlKey,Ae=Ad.metaKey,Ab=(t.UA.os=="macintosh")?Ae:Af;Ac.removeClass("whiteout");if(!(Ab||Y)){Ag._removeLozengeHighlights();}}function G(){var Aj=this,Ab=Aj.composeView.baseNode.one("input.cm-subject-field"),Ak=Aj.composeView.baseNode.one("div.compose-header")||Aj.composeView.baseNode.one(".thread-reply-to-edit"),An,Ag,Y,Al,Ae,Ac,Ah,Af,Ai,Am,Ad;this.listeners.push(t.delegate("focus",S,Ak,".cm-to-field,.cm-cc-field,.cm-bcc-field",Aj));this.listeners.push(Ak.delegate("blur",j,"input.cm-to-field, input.cm-cc-field, input.cm-bcc-field, input.cm-subject-field",Aj));this.listeners.push(Ak.all("div.ac-input").on("blur",x,Aj));this.listeners.push(Ak.delegate("keydown",function(BA){var BC=BA.target,A9,A0,A2,Az=BA.keyCode,A4=BA.shiftKey,Ap=BA.ctrlKey,Aq=BA.metaKey,Ao=BA.altKey,A3=(t.UA.os=="macintosh")?Aq:Ap,Ax=null,Aw=t.ACWidgetInst,As,A7,Av;if((Az===83||(Az===89&&A4)||(Az===85&&A4))&&(Ap||Aq)){Aj.composeView.author?Aj.composeView.author.onKeyDown(BA):Aj.composeView.onKeyDown(BA);return;}else{if(BC.hasClass("cm-subject-field")){Av=(Ap||Aq)&&(!Ao&&!A4)||Az==9;if(!Av||(A3&&Az==86)){Aj.composeView._setDirty();}if(Az==9&&!A4){BC.blur();Aj.composeView.setFocus("body");BA.halt();}return;}}var A8,A1,Ar,Ay,At,A5,Au,A6=t.mail.ui.MessagePaneUtils,BB;switch(Az){case 37:case 39:Aj.handleLeftRightArrow(BA,Ak);break;case 8:case 46:Aj.handleDelete(BA);break;case 13:Aj.handleEnter(BA);break;case 32:Aj.handleSpacebar(BA);break;case 65:Aj.handleSelectAll(BA);break;case 38:break;case 9:Aj.handleTab(BA);break;case 67:Aj.handleCopy(BA,Ak);break;case 86:Aj.handlePaste(BA);break;default:Aj.handleDefaultKeydown(BA);break;}},".cm-to-field,.cm-cc-field,.cm-bcc-field,.cm-subject-field,a"));this.listeners.push(Ak.delegate("change",function(){Aj.composeView._setDirty();},".cm-to-field,.cm-cc-field,.cm-bcc-field"));}function w(){var Aj=this,Ab=Aj.composeView.baseNode.one("input.cm-subject-field"),Ak=Aj.composeView.baseNode.one("div.compose-header")||Aj.composeView.baseNode.one(".thread-reply-to-edit"),An,Ag,Y,Al,Ae,Ac,Ah,Af,Ai,Am,Ad;this._bindAutoComplete();t.on("lozenge:highlight",function(Ao){Aj.isLozengeHighlighted=true;});if(NeoConfig.useDD&&Aj.composeView.type=="fullCompose"){t.use("common-ui-lozengeDD",function(Ao){Ao.Lang.later(0,0,function(){var Ap=new Ao.common.ui.lozengeDD({composeView:Aj.composeView});});});}t.delegate("focus",function(Ao){var Ap=Ao.currentTarget.ancestor("div").one(".ac-input");if(Ap){Aj.composeView.focusNode=Ap.get("id");}},Ak,".user-search a",Aj);if(Aj.composeView.type=="fullCompose"){Ab.after("focus",function(){Ab.ancestor("div").addClass(u);Aj.composeView._registerFocus(Ab);});Ab.after("blur",function(){var Ao=Aj.composeView.baseNode.one(".cm-subject-field"),Ap=Aj.composeView.author;Ab.ancestor("div").removeClass(u);Y=AS(Ao.get("value"));if(Y){Ap.updateTabTitle(AL(D(Y)));if(NeoConfig.bidi){Ap.updateTabDirection(Ao.getStyle("direction"));}}else{Ap.updateTabTitle(Aj.composeView.title);if(NeoConfig.bidi){Ap.updateTabDirection("");}}});}Ak.delegate("click",function(Aq){Aq.halt();Aj.composeView.attView.reposAttachObj(AV);var Ao={"to_add_contacts":".cm-to","cc_add_contacts":".cm-cc","bcc_add_contacts":".cm-bcc"},Ap={wspath:NeoConfig.socdirProxyPath,guid:NeoConfig.neoguid,wssid:NeoConfig.wssid,requestFn:t.common.net.SessionMgr.requestProxy,selectAll:false,lookForSelect:true,lookForInput:true,onDone:function(Au,Av){var Ar,Aw,At,As=Av.one("a").get("id");allLozenges=Aj.composeView.baseNode.one(Ao[As]).all("li"),hiddenLi=allLozenges.item(allLozenges.size()-1);for(Ar in Au){Aw={name:Au[Ar].name,email:D(Au[Ar].field.value)};At=Aj._createLozenge(Aw);Aj.composeView._setDirty();hiddenLi.insert(At,hiddenLi);}Aj.composeView.attView.reposAttachObj(AD);Aj.composeView._restoreFocus();},onCancel:function(){Aj.composeView.attView.reposAttachObj(AD);}};t.use("contacts-ui-choosecontactdialog",function(Ar){if(!Aj.composeView.cancelDialogLoad){Ar.fire("ccd:create",Ap,Aq.currentTarget);}});},".btn-kiosk-choosecontact");Ak.delegate("click",function(Ar){var Aq=Ar.target,Ap=Ar.currentTarget,At=Ap.getElementsByTagName("INPUT"),Ao=At.item(At.size()-1),As;if(Aq.hasClass("lozenge-edit")){return;}As=Ap.get("scrollTop");Ao.focus();if(Aq.hasClass("lozenge-static")||Aq.hasClass("lozenge-edit")){Ap.set("scrollTop",As);Ao.addClass("whiteout");}else{Ao.removeClass("whiteout");Aj._removeLozengeHighlights();Ap.set("scrollTop",Ap.get("scrollHeight"));}},"div.ac-input");Ak.on("keyup",function(Ar){var As=Ar.target,Ap=As.get("value"),Aq=Ap.length,Ao=Ap[Aq-1];if(!(As.hasClass("cm-to-field")||As.hasClass("cm-cc-field")||As.hasClass("cm-bcc-field"))){return;}if(Aq>0){Aj.composeView._setDirty();}if(Ao===";"||Ao===","){Ar.halt();Ap=AS(Ap);if(Ap.length==1){As.set("value","");return;}if(!Ap){return;}Aj._lozengeIt(As);}Aj.updateTextField(As);Aj.composeView.attView.reposAttachObj(R);});}function F(Y,Ab){var Ac=Y.action==H;if(Ac){Ab.removeClass("ico-thread-reply");Ab.addClass("ico-thread-reply-all");}else{Ab.removeClass("ico-thread-reply-all");Ab.addClass("ico-thread-reply");}}function p(){var Ae=this,Ai=Ae.composeView.cdo.oComposeData.origin,Y=Ae.composeView.baseNode,Ab,Af=Y.one(".cm-to-field"),Ah=Y.one(".cm-cc-field"),Ad=Y.all(".replyall-toggle-btn a"),Ac=Ai.action||0,Ag;if(Ac!=H&&Ac!=AF){return;}if(Ac==H){Ai.action=AF;Ad.set("text",strings.str_comp_btn_reply_all);AC.rocketstats.stat("SwitchReplyMode","Reply_To_Sender");}else{Ai.action=H;Ad.set("text",strings.str_comp_btn_reply_sender);AC.rocketstats.stat("SwitchReplyMode","Reply_All");}if(Ae.composeView.type=="inlineCompose"){F(Ai,Ad);}Ae.removeAllLozenges(Af);Ae.removeAllLozenges(Ah);Ag=J.getHeaderContent(Ai);Ab=Y.one(".cm-subject-field");
if(Ab){Ag.subject=Ab.get("value");}Ae.setHeader(Ag);Ae.composeView._restoreFocus();}function r(){var Al=this,Ap=Al.composeView.cdo.oComposeData.origin,Ai=Ap&&Ap.oMsg&&Ap.oMsg.header,Aj=Ap&&Ap.oMsg&&Ap.oMsg.body,Y=Ai&&((Ai.to?Ai.to.length:0)+(Ai.cc?Ai.cc.length:0))||0,Ag=Ap.action,Ao,An,Ac,Ae=Al.composeView.baseNode,Ad=Ae.all(".replyall-toggle-btn"),Ah,Ab={},Aq,Am,Af=1,Ak;if(Ap.fid=="Sent"&&Ag==AF){Ap.action=H;}if((Ag!=H&&Ag!=AF)||!Aj||!Y){return;}if(Ai.replyto){Ak=Ai.replyto.length;for(Ah=0;Ah<Ak;Ah++){Ab[Ai.replyto[Ah].email]=1;}}Aq=Ai.to.concat(Ai.cc);Ao=Al.getAllAccountEmails()||{};Ak=Aq.length;for(Ah=0;Ah<Ak;Ah++){An=Aq[Ah].email||"";if((Am&&An!=Am)||(Ak==1&&!(An in Ao||An in Ab))){Af=0;}Am=An;if((An in Ao||An in Ab)&&!Ac){Ac=0;}else{Ac=1;}}if(Ag&&Ac&&!Af&&Ae.one(".replyall-toggle-btn")&&Ap.fid!="Sent"){Ad.removeClass("hidden");if(Al.composeView.type=="inlineCompose"){F(Ap,Ae.all(".replyall-toggle-btn a"));}Ae.delegate("click",p,".replyall-toggle-btn a",Al);}}t.mix(I.prototype,{NAME:"HeaderBase",render:y,getHeader:z,setHeader:M,enableHeader:C,getAllAccountEmails:K,allowEditing:AK,_bindUIHeader:w,setInputFocus:S,setInputBlur:j,setACBlur:x,handleACBlur:AQ,handleLeftRightArrow:A,handleDelete:l,handleEnter:e,handleSpacebar:f,handleTab:b,handleSelectAll:Q,handleCopy:U,handlePaste:AA,handleDefaultKeydown:AG,setACCategory:d,canACWidgetInstHandleEnter:L,_bindAutoComplete:G,_unBindAutoComplete:q,hideACWidget:m,_cmdBccSwitch:g,_setFromMenu:a,removeAllLozenges:v,_removeLozengeHighlights:c,_createLozenge:AP,enableSwitchReplyButton:r,switchReplyMode:p,_lozengeIt:AX,_makeLozenges:AW,_selectSingleLozenge:AY,_selectAllLozenges:o,_tokenizeAddresses:V,removeARIAFocus:B,_setACWidgetARIAOwns:P,removeARIADescription:AU,addARIADescription:AR,updateTextField:i,_buildFromAccount:h,_buildFromMenu:AI,createAddress:AN,_initAutoComplete:Aa,_bccSwitch:AM,getCursorLocation:AE,_ccSwitch:function(){}});t.namespace("mail.compose");t.mail.compose.HeaderBase=I;},"1.0.0",{requires:["comms-ui-lozenge","ac-widget","_shared_module_offscreen_bin_compose","mail-controller-compose","mail-controller-compose-text","contacts-api","_shared_module_compose_message_header"]});YUI.add("mail-ui-mailcompose",function(D){var T=D.common.Utils.substitute,V=D.Lang.trim,L=D.Node.create,Z=D.mail.Controller.Compose,J=D.common.persist.UserData,E=D.common.Utils,I=D.ui.Templates;var W=function(Y,a,c,b){var d=this;d.header=new D.mail.compose.HeaderBase(Y,d);d.cdo=Y;d.isDraft=a;d.title=strings.str_tabs_compose;d.parent=null;d.baseNode=null;d.compArea=null;d.loadingArea=null;d.type="compose";d.dirty=false;d.focusNode=null;d.author=c;d.attachmentsLoading=[];d.attView=null;d.loadingTimer=null;d.allowEdit=false;d.allowSend=true;d.richFontInfo={fontFamily:null,fontSize:null};d.draftMID=null;d.saveTimer=null;d.hasHardDraft=false;d.blockSave=false;d.lastSave=null;d.lastSaveType=null;d.isSending=false;d.isSaving=false;d.cancelDialogLoad=false;d.contentLoaded=false;d.stopwatch=b?b.stopwatch:null;d.suppressDialog=false;d.formatters={page_well_email:function(){return T(I._shared_module_rte_well_tabs_compose.base,{},d.wellTabFormatters,null,strings,I);},page_well_format:function(){return T(I._shared_module_rte_well_content_format.base,{},d.formatters,null,strings,I);},page_well_emoticons:function(){return T(I._shared_module_rte_well_content_emoticons.base,{},d.formatters,null,strings,I);},page_well_attachments:function(){return T(I._shared_module_rte_well_content_attachments.base,{},d.formatters,null,strings,I);},page_compose_email:function(){return T(I._shared_module_rte_well_content_format.page_compose_email,{},d.formatters,null,strings,I);},make_reply_all:function(){var g=d.cdo.oComposeData.origin,e=g.action,f={title:(e=="reply_all"||g.fid=="Sent")?strings.str_comp_btn_reply_sender:strings.str_comp_btn_reply_all};return((e!="reply_all"&&e!="reply_sender")?"":T(I._shared_module_compose_message_header.make_reply_all,f,0,0,strings));},spellCheckEnabled:function(){if(strings.str_tog_spellcheckEnabled){return T(I._shared_module_rte_well_content_format.spellCheckEnabled,{HiddenClassName:""},d.formatters,null,strings,I);}else{return T(I._shared_module_rte_well_content_format.spellCheckEnabled,{HiddenClassName:" hidden"},d.formatters,null,strings,I);}},is_rtl:function(){var e;if(NeoConfig.bidi){e=strings.str_tog_loadRTLCss?I._shared_module_rte_well_content_format.is_rtl:I._shared_module_rte_well_content_format.is_rtl_else;return T(e,{},d.formatters,null,strings,I);}else{return"";}},bidi:function(){if(NeoConfig.bidi){return T(I._shared_module_rte_well_content_format.bidi,{},d.formatters,null,strings,I);}else{return"";}},page_compose_conversation:function(){return"";},compose_from_address:function(){return T(I._shared_module_compose_message_header.compose_from_address,{},d.formatters,null,strings,I);},timestamp_id:function(){return(new Date()).getTime();},fromSelected:function(e){return(e.isDefault?' selected="selected" class="nsel"':"");},fromAddress:function(e){if(typeof e=="string"){return e;}else{if(typeof e=="object"&&typeof e.address=="string"){return e.address;}}return"";},global_path_img:function(){return NeoConfig.globalPathImg+"/u/assets/img";},display_av_logo:function(){return NeoConfig.avLogoUrl?T(I._shared_module_rte_well_content_file_count.display_av_logo,{},d.formatters,null,strings,I):"";},antivirus_logo_path_img:function(){return NeoConfig.avLogoUrl;},page_compose_email_else:function(){return"hidden";},intl_fonts:function(){function f(i,h){return T(I._shared_module_rte_well_content_format.intl_fonts,{},{font_value:function(){return i;},font_name:function(){return h;}},null,strings,I);}var e="";if(strings.str_cfg_intl_fonts){var g=D.JSON.parse(strings.str_cfg_intl_fonts);D.Array.each(g,function(h){e+=f(h.value,h.name);});}return e;}};SAVE_TIME_LIMIT=(NeoConfig.autoSaveInSec||120)*1000;W.superclass.constructor.call(d);d.modifyAttr("canClose",{getter:d.canWeClose});d.cdo.after("saveactionChange",function(f){var e=f.newVal;if(e&&d.cdo){if(e.failure<0){d.saveFailure(e);}else{d.saveSuccess(e);}}});};function U(){var Y=this;W.superclass.ondestroy.call(this,arguments);}function K(){var Y=this;return Y.dirty;}function B(){var Y=this;return Y.draftMID==null?false:true;}function H(e,d,c,b,Y){var f=this,a=e?e:strings.str_comp_dialogheader;if(f.suppressDialog===true){c();return;}D.use("common-ui-dialog-helper",function(h){var g={hd:a,bd:d,suppressRestoreFocus:true};h.common.ui.DialogHelper.confirm(g,{ok:{text:Y,handler:c},cancel:{handler:function(){f._restoreFocus();if(b){b();}}}});});if(f.hiliteCP){f.hiliteCP.hide();}if(f.textCP){f.textCP.hide();}}function S(){var c=this,a=c.attachmentsLoading,Y,b;if(!a){return 0;}Y=a.length;for(b=0;b<Y;b++){if((a[b]*1)){return 1;}}return 0;}function R(Y){var a=this;a.focusNode=Y;if(a.author){a.author.set("focusNode",Y);}}function O(){var Y=this;Y.setFocus(Y.focusNode);}function X(){var Y=this;Y.dirty=true;if(!Y.saveTimer){Y.resetSaveTimer();}}function A(a){var Y=this;if(!a){a=SAVE_TIME_LIMIT;}if(Y.saveTimer){Y.saveTimer.cancel();}if(!NeoConfig.isAMT){Y.saveTimer=D.later(a,Y,function(){Y._invokeSaveDraft({auto:true});},[],false);}}function N(){var Y=this;if(Y.saveTimer){Y.saveTimer.cancel();Y.saveTimer=null;}}function P(a){var d=this,b,c={},Y;if(d.isSaving&&(!a||!a.forceOverwrite)){return;}else{if(!d.contentLoaded){return;}}a=a||{};if(!a.forceSave){if(a.auto&&(d.blockSave||!d.dirty)){d.resetSaveTimer();return;}}d.isSaving=true;d.blockSave=true;if(!a.retry){b=d.assembleSendBody(true);Y={header:d._getHeader(true),textcontent:b.text,content:b.html};d.cdo.updateData(Y);}a.auto?c.auto=true:"";c.cdo=d.cdo;c.author=d.author;c.mid=d.draftMID;c.saveBeforeSend=(a.saveBeforeSend?a.saveBeforeSend:false);Z.save(c);}function G(d){var f=this,b,c,a,Y,e;if(f.cdo==null){return;}b=f.cdo.get("attachments");d=d||{};if(f.dirty!=="ForceClose"&&!f.areAttachmentsPending()){f.dirty=false;}if(b){Y=b.length;for(e=0;e<Y;e++){c=b[e].original;if(c){c.mid=d.mid;c.fid="Draft";}}f.cdo.set("attachments",b);if(f.cdo.get("isRichText")){NeoConfig.hasConv?a=f.baseNode:a=f.getRTEDocNode();a.all("img").each(function(g){var h=g.get("src");if(h.indexOf("ya/download")!=-1&&h.indexOf("fid=Draft")!=-1){h=h.replace(/mid=.*?([&'">])/,"mid="+encodeURIComponent(d.mid)+"$1");
g.set("src",h);}});}}f.lastSave=E.dateFormatter(new Date(),strings.str_tog_dateformat_rsstime_l10n);f.lastSaveType=d.auto?1:0;if(f.type==="inlineCompose"){f.updateSaveText();}else{if(f.author.get("active")){f.updateToolbar();}}f.draftMID=d.mid;d.auto?"":f.hasHardDraft=true;f.resetSaveTimer();f.blockSave=false;f.isSaving=false;f.fire("compose:saveSuccess");if(d.sendAfterSave){f._invokeSend(false,{keepDraft:true});}}function C(b,a){var c=this,Y=b?b:strings.str_comp_dialogheader;if(c.allowSend){D.use("common-ui-dialog-helper",function(f){c.allowSend=false;var e={hd:Y,bd:a,suppressRestoreFocus:true};var d=function(){c.allowSend=true;c._restoreFocus();};f.common.ui.DialogHelper.alert(e,{ok:{handler:d},cancel:{handler:d}});});}else{c._restoreFocus();}}function M(b){var c=this,Y=c.lastSaveType;b=b||{};c.lastSaveType=-1;c.blockSave=false;c.isSaving=false;if(Y!==-1){if(!b.mid){c.draftMID=null;c.hasHardDraft=false;}c._invokeSaveDraft({auto:b.auto,forceOverwrite:true,retry:true});return;}if(c.type==="inlineCompose"){c.updateSaveText();}else{if(c.author.get("active")){c.updateToolbar();}}if(!b.auto){var a=c.allowSend;c.allowSend=true;c._alertProblem(strings.str_comp_title_saveasdraftfail,strings.str_comp_saveasdraftfail);c.allowSend=a;}c.fire("compose:saveFail");}function Q(){var c=this,Y=c.richFontInfo,b=Y.fontFamily,a=Y.fontSize;if(!b){b=Z.getStyleFontFamily(false);}if(!a){a=Z.getStyleFontSize(false);}return{fontFamily:b,fontSize:a,foreColor:Y.foreColor,backColor:Y.backColor};}function F(Y){var e=this,d=e.baseNode.one(".attachment-button-attach");e.cancelDialogLoad=true;if(e.hiliteCP){e.hiliteCP.hide();}if(e.textCP){e.textCP.hide();}if(e.dirty==="ForceClose"){return true;}var b=e.isDirty()||(e.draftMID&&!e.hasHardDraft&&!Y),a=e.areAttachmentsPending();if(a){b=e.dirty=1;}if(b){var c='<span id="{{btnID}}ModalOverlay" class="btn left right {{default}}"><a href="#" data-action="{{btnID}}">{{btnLabel}}</a></span>';D.use("common-ui-dialog-helper",function(f){var n=T(c,{btnID:"SaveDraft","default":"default",btnLabel:strings.str_comp_savetodrafts}),i=T(c,{btnID:"DontSave",btnLabel:(a?strings.str_comp_closewithoutsaving:strings.str_comp_abandon)}),g=T(c,{btnID:"Continue","default":(a?"default":""),btnLabel:(a?strings.str_comp_returntomessage:strings.str_comp_keepwriting)}),l=n+i+g,m=(a?strings.str_comp_close_attachmentprocessing:strings.str_comp_close_confirm);if(a){l=g+i;}var h={modal_classes:"lg",hd:strings.str_comp_close,bd:m,ft:l,suppressRestoreFocus:true};var j={SaveDraft:{handler:function(){e._invokeSaveDraft();if(e.header){e.header.hideACWidget();}e.blockSave=true;e.dirty="ForceClose";e._closeAfterWarning(true);}},DontSave:{handler:function(){if(e.header){e.header.hideACWidget();}e.blockSave=true;e.dirty="ForceClose";if(!e.hasHardDraft&&e.draftMID){f.use("mail-controller-messages-ops",function(o){o.mail.Controller.Messages.remove({fid:"Draft",mid:e.draftMID,force:true},{failure:function(){},success:function(){}});});}e._closeAfterWarning(false);}},Continue:{handler:function(){e._restoreFocus();e.blockSave=false;e.cancelDialogLoad=false;}}};var k=function(o){if(o){e.setFocus("to");}f.common.ui.DialogHelper.createCommon(h,j,function(p){p.set&&p.set("adAction","disableRetriggerOnOk");});};k(e.type!=="inlineCompose");e.blockSave=true;});}else{d&&d.fire("compose:close");}return !b;}D.extend(W,D.mail.ui.BaseWidget);D.mix(W.prototype,{NAME:"MailCompose",isDirty:K,_setDirty:X,_getHeader:function(){return this.header.getHeader();},_setHeader:function(Y){this.header.setHeader(Y);},isSaved:B,areAttachmentsPending:S,resetSaveTimer:A,canWeClose:F,getRichFontInfo:Q,saveSuccess:G,saveFailure:M,_alertProblem:C,_invokeSaveDraft:P,_cancelSaveTimer:N,_closeAfterWarning:function(Y){},confirm:H,_registerFocus:R,_restoreFocus:O,ondestroy:U},true);D.namespace("mail.ui");D.mail.ui.MailCompose=W;},"1.0.0",{requires:["autocomplete_css","common-persist-user-data","mail-persist-meta-data","_shared_module_compose_message_header","mail-controller-compose","mail-ui-mailcompose-base-header","rocket-stats","comms-utils"]});YUI.add("mail-ui-rteview",function(F){var R="hidden",L,Q,C,H;var G=function(Y){var a=this;G.superclass.constructor.call(a,Y);L=Y.bidi;Q=Y.fullpage;C=Y.isFullSSL;H=Y.isRTL;a.rte=null;a.contentInitialized=null;a.focusNode=false;a.baseNode=null;a.rteReady=false;a.rteArea=null;a.evt=[];a.set("isRich",Y.isRich);a.getDefaultFontInfo=Y.getDefaultFontInfo;a.convertToPlain=Y.convertToPlain;a.richFontInfo=a.getDefaultFontInfo(!Y.isRich);a.resizeNestCount=0;a.resizeRTEHeight=0;a.resizeNode=null;var Z={isRich:{setter:function(b){a.isRich=b;a.switchEditMode();}},content:{setter:function(b){a.content=b;a.rte.getInstance().Selection.cleanCursor();a.baseNode&&a.baseNode.fire("switchToPlain");},getter:function(){return a.content?a.content:"";}}};a.addAttrs(Z,Y||{});a.on("closeChange",function(){a.destroy();});a.on("activeChange",function(b){a.handleActiveChanged(b);});};function X(a){var c=this,Z,b,Y=c.evt;c.baseNode=a;F.Frame.DEFAULT_CSS="body { background-color: #fff; } a, a:visited, a:hover { color: blue !important; text-decoration: underline !important; cursor: text !important; } img { cursor: pointer !important; border: none; }";if(F.UA.ie){if(F.UA.ie>=8){F.Frame.getDocType=function(){return"";};}if(!L){F.Frame.DOM_EVENTS.keypress=0;}c.resizeNode=c.baseNode.one("div.compose-message").one("div.inner").ancestor("td");}c.rte=new F.EditorBase({extracss:c.getExtraCSS(c.isRich),defaultblock:F.UA.webkit?"div":"p",dir:L&&strings.str_tog_loadRTLCss?"rtl":"ltr"});F.Plugin.ExecCommand.COMMANDS.fontsize=null;c.rte.plug(F.Plugin.EditorPara);if(L){c.rte.plug(F.Plugin.EditorBidi);c.rte.plug(F.Plugin.EditorAutoBidi);}c.bindUI();c.renderUI();}function S(){var Z=this,Y=Z.evt;Y.push(Z.rte.after("nodeChange",function(c){var b,a=c.changedType;if(Z.isRich){if(a==="keypress"||(!F.UA.ie&&a=="keydown")){return;}if(a==="right"||a==="left"||a==="space"){return;}if(a==="mouseup"){return;}if(a==="mousedown"&&c.changedEvent&&c.changedEvent.which>1){return;}if(c.changedType&&c.changedType.toLowerCase()!="execcommand"){Z.fire("nodeChange",c);}}}));Y.push(Z.rte.frame.after("ready",function(){var a,b;Z.rte.frame._iframe.setStyle("visibility","inherit");Z.rteReady=true;if(Q){Z._setRTEBorder();}Y.push(Z.rte.frame.getInstance().one("win").on("focus",function(){Z.fire("focus",{editor:Z.rte});}));Y.push(Z.rte.getInstance().one("doc").one("body").on("keyup",function(c){if(c.keyCode==8){c.halt();}}));Y.push(Z.rte.frame.on("dom:keydown",function(c){Z.fire("keyDown",c);}));Y.push(Z.rte.frame.on("dom:mousedown",function(c){Z.fire("mousedown");}));Y.push(Z.rte.getInstance().one("doc").one("body").on("drop",function(c){Z.fire("drop",c);}));Y.push(Z.rte.after("dom:paste",function(c){Z.resize(true);Z.fire("paste");}));if(Z.contentInitialized){Z.setContent(Z.contentInitialized);}if(Z.resizeNode){Y.push(Z.resizeNode.on((F.UA.ie&&F.UA.ie<8)?"resize":"windowresize",function(){Z.resize();}));}if(F.UA.ie){F.Node.getDOMNode(Z.rte.getInstance().one("doc").one("body")).contentEditable=true;}Z.resize();Z.set("ready",true);Z.fire("ready");Z.rte.frame.getInstance().one("body").setStyles({"fontSize":Z.richFontInfo.fontSize,"fontFamily":Z.richFontInfo.fontFamily});a=F.one("#rtetext iframe");if(a){a.set("title",strings.str_comp_messagebody);}b=Z.rte.frame.getInstance().one("body");if(b){b.set("aria-label",strings.str_comp_messagebody);if(L&&H){b.set("dir","rtl");}}}));}function E(){var Y=this;Y.rteArea=Y.baseNode.one("div.compose-message").one("div.inner").one("div.cm-rtetext");Y.rte.render(Y.rteArea);if(L){Y.rte.fire("turnautobidioff",{status:!Y.isRich});}}function J(Y,Z){var a=this;if(a.rte){if(Y=="bidi"){a.rte.fire("disableautobidi");}a.rte.execCommand(Y,Z);if(F.UA.webkit){a.rte.frame._iframe.focus();if(Y=="createlink"){inst=a.rte.getInstance();sel=new inst.Selection();sel&&sel._selection&&sel._selection.collapseToEnd();}}}}function D(){var Y=this;if(Y.rte){Y.rteArea.addClass("border");Y.rte.frame._iframe.set("height","100%");Y.rte.frame._iframe.setStyle("border","1px solid #EEE");}}function K(Z,g){var d=this,Y,b,a,c="",i=F.Selection.CURSOR,h=(!F.Lang.isUndefined(g))?g:true;if(h){c=F.UA.webkit?"<div>"+i+"</div>":"<p>"+i+"</p>";}else{c="";}c+=Z;if(d.rteReady){d.rte.set("content",c);b=d.rte.getInstance();b.Selection.filter();if(F.UA.ie){d.rte.frame._fixIECursors();}try{Y=new b.Selection();Y.focusCursor(true,true);}catch(f){}}else{d.contentInitialized=c;}}function W(){return this.rte.getContent();}function M(){return this.rte.get("content");}function O(){return this.rte;}function A(Y){if(this.rte){this.rte.focus(Y);}}function V(){var Y=this;F.each(Y.evt,function(Z){Z.detach();});delete Y.evt;Y.rte.destroy();delete Y.rte;}function N(Y){var Z=this;if(Z.rte){if(Y.newVal){if(F.UA.ie&&Z.rte){Z.rte.frame._iframe.setStyle("display","block");}}else{Z.rte.frame._iframe.setStyle("visibility","inherit");if(F.UA.ie){Z.rte.frame._iframe.setStyle("display","none");}}}}function I(){var a=this,Y,Z;if(a.rte){Z=a.isRich;Y=a.getDefaultFontInfo(!Z);a.rte.set("extracss",a.getExtraCSS(Z));a.rte.frame.getInstance().one("body").setStyles({"fontSize":Y.fontSize,"fontFamily":Y.fontFamily});if(L){a.rte.fire("turnautobidioff",{status:!Z});}}}function U(){var c=this,b=c.rte.getInstance(),Y=b.one("doc").one("body");if(Y){var Z=c.convertToPlain(Y,false);if(Z){if(F.UA.ie){Z=Z.replace(/\xA0/gi," ");}var a=F.Lang.trim(Z);if(a!==""){c.set("content",c.convertToPlain(Y,true));}return a!="";}else{return false;}}return true;}function P(Y){var a=this,Z=a.getDefaultFontInfo(!Y);if(Y){a.richFontInfo.fontFamily=Z.fontFamily;a.richFontInfo.fontSize=Z.fontSize;a.richFontInfo.foreColor="#000";a.richFontInfo.backColor="#fff";}return"body { color: "+a.richFontInfo.foreColor+"; background-color: "+a.richFontInfo.backColor+";padding: 0px; margin: 8px "+(L?(strings.str_tog_loadRTLCss?"12px 0px 2":"2px 0px 12"):"0px 0px 12")+"px; } "+"p { margin : 0 }"+"blockquote { margin : 1em; display : block; }"+"span.mark { background:transparent url("+((C)?"http://mail.yimg.com":"https://s.yimg.com")+"/ok/u/assets/img/rte-mark.png) repeat-x scroll center bottom; }";
}function T(c){var e=this,Y,b,d,a=false,Z=Q?270:100;if(e.resizeNode&&e.resizeNestCount==0){b=e.resizeNode.ancestor("TBODY").get("children");Y=e.baseNode.get("offsetHeight")-b.item(0).get("offsetHeight")-b.item(1).get("offsetHeight");if(Y<Z){Y=Z;a=true;}if(c||Y!=e.resizeRTEHeight){e.resizeRTEHeight=Y;d=e.baseNode.one("div.compose-message");d.setStyle("height",Y+"px");if(NeoConfig.fullPage&&F.UA.ie>0&&F.UA.ie<8){e.resizeNestCount++;d.ancestor("TR").setStyle("height",Y+"px");d.ancestor("TD").setStyle("height",Y+"px");e.resizeNestCount--;}if(e.rte&&e.rteReady&&F.UA.ie){e.rte.frame._ieSetBodyHeight();}if(Q){e.baseNode.setStyle("overflow-y",a?"scroll":"hidden");}}}}function B(Y){if(this.rte){this.rte.plug(Y);}}F.namespace("mail");F.extend(G,F.mail.ui.BaseWidget);F.mail.RTEView=G;F.mix(F.mail.RTEView.prototype,{NAME:"RTE",render:X,renderUI:E,bindUI:S,execute:J,getRTE:O,getContent:W,getContentOnSave:M,getExtraCSS:P,setFocus:A,_setRTEBorder:D,setContent:K,switchEditMode:I,hasContent:U,resize:T,plug:B,handleActiveChanged:N,destroy:V},true);},"1.0.0",{requires:["node-base","node-event-delegate","attribute-base","event-base","mail-ui-basewidget"]});YUI.add("swfdetect",function(C){var J=0,H=C.UA,E=C.Lang,M="ShockwaveFlash",B,G,D,N,A;function L(O){return parseInt(O,10);}function F(O){if(E.isNumber(L(O[0]))){H.flashMajor=O[0];}if(E.isNumber(L(O[1]))){H.flashMinor=O[1];}if(E.isNumber(L(O[2]))){H.flashRev=O[2];}}if(H.gecko||H.webkit||H.opera){if((B=navigator.mimeTypes["application/x-shockwave-flash"])){if((G=B.enabledPlugin)){D=G.description.replace(/\s[rd]/g,".").replace(/[A-Za-z\s]+/g,"").split(".");F(D);}}}else{if(H.ie){try{N=new ActiveXObject(M+"."+M+".6");N.AllowScriptAccess="always";}catch(I){if(N!==null){J=6;}}if(J===0){try{A=new ActiveXObject(M+"."+M);D=A.GetVariable("$version").replace(/[A-Za-z\s]+/g,"").split(",");F(D);}catch(K){}}}}C.SWFDetect={getFlashVersion:function(){return(String(H.flashMajor)+"."+String(H.flashMinor)+"."+String(H.flashRev));},isFlashVersionAtLeast:function(R,T,S){var P=L(H.flashMajor),Q=L(H.flashMinor),O=L(H.flashRev);R=L(R||0);T=L(T||0);S=L(S||0);if(R===P){if(T===Q){return S<=O;}return T<Q;}return R<P;}};},"@VERSION@");YUI.add("mail-service-uploader-utils",function(B){var A=B.common.Utils.rocketstats.intlStat;B.namespace("Y.mail.UploaderUtils");B.mail.UploaderUtils={getUploadCredential:function(D){var E=NeoConfig.launch_protocol+document.location.host+"/ya/upload_get_cred",C=B.mail.UploaderService,F={success:function(H,G,J){var I;if(H&&H.responseText){I=B.JSON.parse(H.responseText).Response.cred;}C.UPLOAD_CREDENTIAL=I||"failed";A("UploaderService","CredentialSet"+(I?"Successful":"FailedCallback"));if(!I){}D&&D();},failure:function(){C.UPLOAD_CREDENTIAL="failed";A("UploaderService","CredentialSetFailed");},suppressCodes:"*"};B.common.net.SessionMgr.request(E,null,F,"GET",null,true);},checkLimits:function(K){var L=K.files||[],P=K.cdo,I=K.uploader,D=B.common.persist.UserData,F=D.get("userFeaturePref.attachTotalSize"),C=D.get("userFeaturePref.attachFiles"),E,G,J,N=P&&P._getAttachmentsSize(),O=P&&P._getAttachmentsCount(),H,M=0;if(!L||!P||!I){return true;}for(H in L){E=L[H];G=E.get&&E.get("size")||E.size;J=E.get&&E.get("id")||E.id+"-"+E.name;if(((G>F)||(N+G>F))&&(!I.processedFiles[J]&&!I.removedFiles[J])){I.removedFiles[J]=1;M=1;delete L[H];}else{if(!I.processedFiles[J]&&!I.removedFiles[J]){N+=G;O++;}}}B.mail.UploaderService.logIt("checkLimits found totalSize = "+N+", totalCount="+O);if(O>C){for(H in L){if(O<=C){break;}E=L[H];J=E.get&&E.get("id")||E.id+"-"+E.name;if(!I.processedFiles[J]&&!I.removedFiles[J]){I.removedFiles[J]=1;delete L[H];O--;}}P.fire("CDO_ATTACHMENT_COUNT_VIOLATION");return false;}if((N>F)||M){P.fire("CDO_ATTACHMENT_SIZE_VIOLATION");return false;}return true;},handlePostRedirectResponse:function(C){var G=this,F=B.common.Utils.parseQueryString(C),E=B.mail.UploaderService.uploadersCreated[F.uploaderID],D=G.parseFormResponse(F,E);E.handlePostRedirectResponse(D);},parseFormResponse:function(E,H){var D=[],F,K,J,N=parseInt(E.cdoidx,10),I=(E.filename+"").split(","),M=(E.mimetype+"").split(","),L=(E.filesize+"").split(","),C=(E.diskfilename+"").split(","),G=(E.errorcode+"").split(",");for(J=0;J<G.length;J++){F={cdoIndex:N+J,filename:I[J],mimetype:M[J],size:{original:parseInt(L[J],10)},serverID:C[J],thumbData:null};this.setAttachmentState({item:F,state:G[J],uploader:H});D.push(F);}return D;},setAttachmentState:function(C){var G=C.item,E=C.state||G.attachCode,I=C.uploader,H=I.type||I.uploaderType,D={attachcode:E,resampled:false,cancelled:false,rotated:false,uploaded:false,scanned:false,failed:false},F=0;switch(E){case"uploadAVNoVirus":case"uploadAVCleaned":D.scanned=true;D.uploaded=true;A("UploaderService",H+"Attachment_UploadSuccess");break;case"uploadAVInternalError":case"uploadAVError":case"uploadAVNotScannable":case"uploadAVServerDown":D.uploaded=true;D.failed=false;D.failCause="averror";break;case"uploadFileSizeError":case"uploadNoFileError":D.failed=true;if(E=="uploadFileSizeError"){D.failCause="size";A("UploaderService",H+"Attachment_UploadFail");}else{D.failCause="nofile";A("UploaderService",H+"Attachment_NoFileError");}F=1;break;case"uploadAVCannotClean":case"uploadAVHasVirus":D.scanned=true;D.uploaded=true;D.failed=true;D.failCause="virus";A("UploaderService",H+"Attachment_UploadFailVirus");F=1;break;case"uploaderFormUploadNoResponse":D.failed=true;D.failCause="form_upload_no_response";A("UploaderService",H+"Attachment_UploadNoResponse");F=1;break;case"uploaderFormUploadUnexpectedResponse":D.failed=true;D.failCause="form_upload_unexpected_response";A("UploaderService",H+"Attachment_UploadUnexpectedResponse");F=1;break;case"uploaderFormUploadTimeout":D.failed=true;D.failCause="form_upload_timeout";A("UploaderService",H+"Attachment_UploadTimeout");F=1;break;case"uploaderFormUserCancelled":D.cancelled=true;D.failCause="form_upload_cancelled";A("UploaderService",H+"Attachment_UploadCancelled");break;case"uploaderYUIUploadError":case"uploaderHTML5UploadError":D.failed=true;D.failCause=H+"_upload_error";A("UploaderService",H+"Attachment_UploadError");F=1;break;case"uploaderYUIResponseTimeout":case"uploaderHTML5ResponseTimeout":D.failed=true;D.failCause=H+"_response_timeout";A("UploaderService",H+"Attachment_UploadResponseTimeout");F=1;break;case"uploaderYUIUploadStartTimeout":case"uploaderHTML5UploadStartTimeout":D.failed=true;D.failCause=H+"_uploadstart_timeout";A("UploaderService",H+"Attachment_UploadStartTimeout");F=1;break;case"uploaderYUIProgressTimeout":case"uploaderHTML5ProgressTimeout":D.failed=true;D.failCause=H+"_progress_timeout";A("UploaderService",H+"Attachment_UploadProgressTimeout");F=1;break;case"uploaderYUIUploadCompleteTimeout":case"uploaderHTML5UploadCompleteTimeout":D.failed=true;D.failCause=H+"_uploadcomplete_timeout";A("UploaderService",H+"Attachment_UploadUploadCompleteTimeout");F=1;break;case"uploaderYUIUserCancelled":case"uploaderHTML5UserCancelled":D.cancelled=true;D.failCause=H+"_upload_cancelled";A("UploaderService",H+"Attachment_UploadCancelled");break;case"uploaderYUIAutoRetryAll":case"uploaderHTML5AutoRetryAll":D.failed=true;D.failCause=H+"_upload_error_retry";A("UploaderService",H+"Attachment_UploadErrorRetry");break;case"uploaderYUIAutoRetry2038":case"uploaderHTML5AutoRetry2038":D.failed=true;D.failCause=H+"_upload_error2038";A("UploaderService",H+"Attachment_UploadError2038");break;case"uploaderYUIError2049":case"uploaderHTML5Error2049":D.failed=true;D.failCause=H+"_upload_error2049";A("UploaderService",H+"Attachment_UploadError2049");F=1;break;case"uploaderYUICredExpired":case"uploaderHTML5CredExpired":D.failed=true;D.failCause=H+"_upload_302";A("UploaderService",H+"Attachment_UploadError302");break;case"uploadInternalError":D.failed=true;D.failCause="internal_server_error";A("UploaderService",H+"Attachment_InternalServerError");F=1;break;case"uploadMailboxError":D.failed=true;D.failCause="mailbox_error";A("UploaderService",H+"Attachment_MailboxError");F=1;break;case"uploadPartialFileError":D.failed=true;D.failCause="partial_file_error";A("UploaderService",H+"Attachment_PartialFileError");F=1;break;case"uploadAuthError":D.failed=true;D.failCause="upload_auth_error";
A("UploaderService",H+"Attachment_UploadAuthError");F=1;break;default:D.failed=true;D.failCause="generic_"+E;A("UploaderService",H+"Attachment_UploadFail");F=1;}A("UploaderService",H+"AttachmentStatus_"+E);if(D.failed){B.use("common-utils-error",function(J){J.common.Utils.error.report(E+":"+D.failCause,"ATTACH_UPLOAD_ERR",1,0,1);});}if(F){A("UploaderService",H+"UploaderFail_"+I.INITIAL_UPLOADER);}G.state=D;},createMenuNode:function(D){var I=parseInt(NeoConfig.switchAttachModeEnabled,10),F=D.node,H=D.uploader,C=D.cdo,G=D.attView,E=F.one("span.attach-btn-menu"),J=F.one(".attachment-button-html5")||F.one(".attachment-button-attach");if(I!=1){return;}H.handles.push(J.on("click",function(){E&&E.menu&&E.menu.hide&&E.menu.hide();C.fire("compose:restoreFocus");},H));E.on("click",this.createAttachOptionMenu,H,C,G);J&&J.removeClass("right");E&&E.removeClass("hidden");},selectDefaultMenuType:function(){var C=B.one("#menu-attach-options"),D=C&&C.one(".active")||0;if(D&&D.get("id")=="switch-form"){A("UploaderServiceMenu","FormOptionDefaulted");B.fire("compose:toggleUploaderType",{form:1,node:C,destroy:0});}},createAttachOptionMenu:function(E,D,H){var I=this,G=E.currentTarget,C=B.mail.UploaderService,F="hidden";E.preventDefault();if(!G.menu){B.use("common-ui-menu-helper","_shared_module_offscreen_bin_menus_compose_attach",function(N){var L=N.ui.Templates._shared_module_offscreen_bin_menus_compose_attach,K=H.type||H.uploaderType,M={html5_active:(H.type==C.UPLOADER_TYPE_HTML5?"active":""),flash_active:(H.type==C.UPLOADER_TYPE_FLASH?"active":""),form_active:(H.type==C.UPLOADER_TYPE_FORM?"active":"")},J=N.one("#menu-attach-options")||N.one("body").appendChild(N.common.Utils.substitute(L.base,M,0,0,strings));if(H.type==C.UPLOADER_TYPE_HTML5){J.one("#switch-flash").addClass(F);J.one("#switch-html5").removeClass(F);}N.common.ui.MenuHelper.create(G,{menu:J,blur:true},function(){G.menu.getMenuNode().on("menuSelected",function(O){switch(O.dataAction){case"switch-html5":A("UploaderServiceMenu","HTML5OptionSelected");N.fire("compose:toggleUploaderType",{html5:1,node:J});break;case"switch-flash":A("UploaderServiceMenu","FlashOptionSelected");N.fire("compose:toggleUploaderType",{flash:1,node:J});break;case"switch-form":A("UploaderServiceMenu","FormOptionSelected");N.fire("compose:toggleUploaderType",{form:1,node:J,destroy:0});break;}D.fire("compose:restoreFocus");});});});}},verifyCrossDomainAccess:function(F){F=F||NeoConfig.attachmentServer;var G=this,E=B.mail.UploaderService,C=NeoConfig.launch_protocol+F+"/crossdomain.xml",D={success:function(){if(NeoConfig.attachmentServer!=F){NeoConfig.attachmentServer=F;E.UPLOAD_URL_BASE=NeoConfig.launch_protocol+(NeoConfig.attachmentServer?NeoConfig.attachmentServer+"/":"")+((NeoConfig.isFullSSL&&!NeoConfig.isAttachSSL)?window.location.host:(strings["str_cfg_base_intl"]+"."+NeoConfig.farm+".mail.yahoo."+(NeoConfig.intl=="jp"?"co.jp":"com")))+"/ya/upload";E.rs.intlStat("UploaderService","UsingBackupServer");}E.CROSS_DOMAIN_VERIFIED=true;},failure:function(){E.rs.intlStat("UploaderService","CrossDomainAccessFailed_"+(F==NeoConfig.attachmentServer?"primary":"backup"));if(F!=NeoConfig.attachmentServerBackup&&NeoConfig.attachmentServerBackup){B.mail.UploaderUtils.verifyCrossDomainAccess(NeoConfig.attachmentServerBackup);}else{E.DEFAULT_UPLOADER=E.UPLOADER_TYPE_FORM;B.fire("compose:toggleUploaderType",{form:1,destroy:1});}},suppressCodes:"*"};B.common.net.SessionMgr.request(C,null,D,"GET",null,true);}};},"1.0.0",{requires:["common-utils-stats","common-net-sessionmgr"]});YUI.add("mail-ui-composeview-attach",function(C){C.namespace("mail");var L={"application/pdf":"pdf","application/mspowerpoint":"ppt","application/vnd.ms-powerpoint":"ppt","application/excel":"xls","application/vnd.ms-excel":"xls","application/msword":"doc","application/vnd.ms-msword":"doc","application/x-trof-msvideo":"video","video/mpeg":"video","video/x-ms-wmv":"video","video/mov":"video","video/movie":"video","video/quicktime":"video","audio/wav":"music","audio/x-wav":"music","audio/mpeg":"music","audio/mp3":"music","audio/mid":"music","audio/realaudio":"music","audio/x-pn-realaudio":"music","image/bmp":"img","image/gif":"img","image/jpe":"img","image/jpeg":"img","image/jpg":"img","image/png":"img","image/tiff":"img","application/x-compressed":"zip","application/x-stuffit":"zip","application/x-tar":"zip","application/x-gzip":"zip"},H={"LOZENGE":0,"ICON":1},A=C.ui.Templates,a=C.common.Utils,G=C.mail.UploaderUtils,l=a.substitute,W=a.escapeHtml,V=window.strings||{},m=C.common.persist.UserData,e=m.get("userFeaturePref.attachTotalSize"),Q=m.get("userFeaturePref.attachFiles"),P=Math.round(e/1048576),h="hidden",T="attachmentVisible",D=(parseInt(NeoConfig.uploaderVersion,10)===2);function c(n,Y){Y=Y||"str_rte_attachments_";return V[Y+n]||"";}C.mail.AttachmentView=function(w,t,n){var p=this,r,x,z,q,u,o=C.mail.UploaderService,v,s,y;p.cdo=w;if(!p.handles){p.handles=[];}y=p.handles;p.tab=t;p.tagPane=n&&n.tagPane?n.tagPane:".attachments-pane";p.tagWell=n&&n.tagWell?n.tagWell:".attachments-well";p.uiAttBar=t.one(p.tagPane);if(p.uiAttBar){p.uiAttRemoveAll=p.uiAttBar.one(".attachment-button-removeall");p.uiAttCount=x=p.uiAttBar.one(".attachments-count");p.uiAttSize=z=p.uiAttBar.one(".attachments-size");p.uiAttAVLogo=p.uiAttBar.one(".file-count img");p.uiAttMessage=p.uiAttBar.one(".error");p.uiAttBtnForm=p.uiAttBar.one(".attachment-button-form")||null;p.uiAttBtnDisabled=p.uiAttBar.one(".attachment-button-disabled");}p.uiAttPane=t.one(p.tagWell);if(p.uiAttPane){p.uiAttList=q=p.uiAttPane.one(".file-attach");p.uiAttWelcome=p.uiAttPane.one(".attachments-welcome");}if(q&&x&&z){var Y=t.one("div.rte li.active a");q.setAttrs({"aria-labelledby":(Y?Y.generateID():""),"aria-describedby":(x.generateID()+" "+z.generateID())});}p.errorFlags={tooMany:false,tooBig:false};p.attachPaneHidden=true;p.attachXY=null;p.uploaderConfig={"attView":p,"tab":t,"cdo":w,"attForm":p.uiAttBtnForm,"attInput":p.tab.one(".attachment-button-file")};p.toggleUploaderHandle=C.on("compose:toggleUploaderType",j,p);if(D){s=o.getDefaultUploaderType();switch(s){case o.UPLOADER_TYPE_HTML5:u="uploader-html5";break;case o.UPLOADER_TYPE_FLASH:u="uploader-flash";break;default:u="mail-service-uploader-form";s=o.UPLOADER_TYPE_FORM;}p.type=s;}v=function(AA){p.uploader=AA;AA.updateUI&&AA.updateUI();p.updateSizeAndCount();if(AA.uploaderType!=C.mail.UploaderService.UPLOADER_TYPE_FORM&&parseInt(NeoConfig.switchAttachModeEnabled,10)===1){G.createMenuNode({uploader:AA,node:p.tab,cdo:p.cdo,attView:p});G.selectDefaultMenuType();}};C.use(u,function(AA){o.create(p.uploaderConfig,v,n?n.type:null);});y.push(p.cdo.on("CDO_ATTACHMENT_ADDED",function(AB,AA){p.addNewAttachment(AA);}));y.push(p.cdo.on("CDO_ATTACHMENT_DELETED",function(AB,AA){p.removeAttachment(AA);p.updateSizeAndCount();}));y.push(p.cdo.on("CDO_ATTACHMENT_PROCESSED",function(AC,AA){p.enableAttachment(AA);p.updateSizeAndCount();function AB(AD){var AE=AD.state;return(AE&&!AE.processed&&!AE.uploaded&&!AE.cancelled);}if(!p.cdo._getAttachmentsCount(AB)){p.checkOverLimit();}}));y.push(p.cdo.on("CDO_ATTACHMENT_SIZE_VIOLATION",function(){p.attachError("size");}));y.push(p.cdo.on("CDO_ATTACHMENT_COUNT_VIOLATION",function(){p.attachError("count");}));y.push(p.cdo.on("CDO_ATTACHMENT_UPLOAD_PROGRESS",function(AC,AB,AA){p.updateAttachmentProgress(AB,AA);}));y.push(p.cdo.on("CDO_THUMBNAIL_GENERATED",function(AD,AA,AC){var AB=p.uiAttList.all(".file-container").item(AA),AE=AB.one("div");if(!AE){AB.insert(C.Node.create("<div></div>"),0);AE=AB.one("div");}AE.setStyle("background","url('"+AC.src+"') no-repeat 0px "+((63-AC.height)/2)+"px");AB.ancestor("li").addClass("image");}));y.push(p.cdo.on("CDO_UPLOADER_CLEANUP",function(){var AA=p.cdo.get("attachments"),AC,AB;for(AC=0;AA&&AC<AA.length;AC++){AB=AA[AC];if(AB&&AB.timeout){clearTimeout(AB.timeout);AB.timeout=null;}if(AB&&AB.state&&!AB.processed&&!AB.state.cancelled){AB.processed=true;AB.state.failed=1;p.enableAttachment(AC);}}p.updateSizeAndCount();}));if(p.uiAttRemoveAll){y.push(p.uiAttRemoveAll.on("click",function(AA){p.cdo._removeAllAttachments();AA.preventDefault();}));}if(p.uiAttBtnDisabled){y.push(p.uiAttBtnDisabled.on("click",function(){p.checkOverLimit(1);}));}if(p.uiAttAVLogo){y.push(p.uiAttAVLogo.on("click",function(){C.fire("globalUltBeaconEvent",{action:"attch_upload_av_click"});window.open(NeoConfig.avTargetUrl);}));}};function O(Y){var n=this;if(Y=="icon"){n.iconType=H.ICON;n.uiAttList.addClass("icons");n.uiAttList.removeClass("lozenges");}else{n.iconType=H.LOZENGE;n.uiAttList.removeClass("icons");n.uiAttList.addClass("lozenges");}}function Z(p,n){var s=this,r=C.mail.AttachmentView.attachErrorSize,o=n?C.all(".file-attach li").item(n):null,Y={"count":l(c("num_files_exceeded","str_comp_attach_"),{},{max_allowed:function(){return Q;}}),"size":l(c("size_exceeded","str_comp_attach_"),{},{max_size_MB:function(){return P;}}),"averror":c("noAVScanWarning")+(o?o.get("title"):""),"virus":c("alert_virus")},q=Y[p];if(o){o.set("title",q||"");}s.updateSizeAndCount();if(p==="size"&&r&&r(s.cdo)){}else{if(q){C.use("common-ui-dialog-helper",function(t){t.common.ui.DialogHelper.alert({hd:(p=="virus")?c("alert_virus_title"):c("error","str_comp_attach_"),bd:q,restoreFocusNode:s.uiAttBar});});}}a.rocketstats.intlStat("ATTACH_ERROR",p);}function J(Y){var n=this;n.addAttachment(Y);n.updateSizeAndCount();}function d(){var q=this,p=q.cdo._getAttachmentsCount(),Y=(p==1)?c("file_single"):l(c("num_files"),{},{file_attach_num_files:function(){return p;}}),u=q.cdo._getAttachmentsSize(),w=0,t=0,x,o,s,r,n,v=(p==1)?V["str_comp_remove"]:V["str_comp_removeall"];
if(p){if(q.uiAttWelcome){q.uiAttWelcome.addClass(h);}q.uiAttList.removeClass(h);if(q.uiAttRemoveAll){q.uiAttRemoveAll.removeClass(h).one("a").setContent(v).set("title",v);}q.uiAttPane.removeClass(h);if(q.uiAttCount){q.uiAttCount.removeClass(h);}if(q.uiAttSize){q.uiAttSize.removeClass(h);}}else{q.uiAttList.addClass(h);if(q.uiAttRemoveAll){q.uiAttRemoveAll.addClass(h);}if(q.uiAttMessage){q.uiAttMessage.addClass(h);}q.uiAttPane.addClass(h);if(q.uiAttCount){q.uiAttCount.setContent("");}if(q.uiAttSize){q.uiAttSize.setContent("");}q.toggleOverLimit(0);if(q.uiAttWelcome){q.uiAttWelcome.removeClass(h);}return;}if(q.uiAttCount){q.uiAttCount.setContent(Y);}if(q.uiAttSize){q.uiAttSize.setContent(l(c("sizes"),{},{transferred_size:function(){return g(u);},total_size:function(){return P+" "+V["str_rte_attachments_megabyte"];}}));}q.errorFlags.tooMany=p>Q;q.errorFlags.tooBig=u>e;if(u>e){q.toggleOverLimit(2);}else{if(p>=Q||u===e){q.toggleOverLimit(1);}else{q.toggleOverLimit(0);}}x=q.uiAttPane.all(".file-attach .transfer-error")._nodes;for(o=0,n=x.length;o<n;o++){s=C.one(x[o]);r=s.hasClass("lozenge")?s.get("parentNode"):s;if(!r.hasClass(h)){w++;if(s.hasClass("transfer-virus")){t++;}}}if(q.uiAttMessage){if(t){q.uiAttMessage.setContent((t==1)?c("virus_single"):l(c("virus_mult"),{},{num_virus_files:function(){return t;}}));q.uiAttMessage.removeClass(h);}else{if(w){q.uiAttMessage.setContent((w==1)?c("error_single"):l(c("error_mult"),{},{num_error_files:function(){return w;}}));q.uiAttMessage.removeClass(h);}else{q.uiAttMessage.addClass(h);if(NeoConfig.intl==="jp"){if(u>e){q.uiAttMessage.setContent(V.str_comp_attach_size_exceeded);q.uiAttMessage.removeClass(h);}else{if(p>Q){q.uiAttMessage.setContent(V.str_comp_attach_num_files_exceeded);q.uiAttMessage.removeClass(h);}}}}}}}function I(Y){var n=this;if(n.errorFlags.tooBig){n.attachError("size");}else{if(n.errorFlags.tooMany||Y){n.attachError("count");}else{return false;}}return true;}function R(o,Y){var w=this,u=w.tab.one(".attachments-well .file-attach")||w.tab.one(".file-attach"),AA=w.cdo.get("attachments")[o],v=AA.state||{},r=AA.size||{},AB,y=v.processed||AA.processed?"":" processing",AD,AC,p,z,s,t,x,n,q=C.mail.UploaderService;r=v.resampled?r.sampled:r.original;r=g(r);if(w.cdo.get("passive")){AA.original=AA.size.original;}if(AA.original&&v.uploaded){AA.processed=true;}if(NeoConfig.bidi){C.use("comms-intl-bidi",function(AE){AB=AE.Intl.detectDirection(unescape(AA.filename));});}Y=Y||(w.uploader&&w.uploader.uploaderType)||q.DEFAULT_UPLOADER;AD="_shared_module_rte_well_content_attach_item";AC=A[AD].browser_plus_attach_else;p=C.Node.create(l(AC,AA,{filename:function(AE){return W(AE.filename.split("\\").pop());},in_progress1:function(){return AA.original?"":A[AD].in_progress1;},transfer_error1:function(){return v.failed?A[AD].transfer_error1:"";},transfer_warn1:function(){return v.failCause?A[AD].transfer_warn1:"";},retry:function(){return l(A[AD].retry,0,0,0,V);}},null,V));if((C.UA.ie>0)&&(C.UA.ie<8)){p.removeClass(h);p.setStyle("float","left");w.uiAttPane.setStyle("paddingBottom","6px");}p.one("a").set("title",(AA.filename.split("\\").pop()||"")+" ("+r+")");w.handles.push(p.one(".lozengeremove").on("click",function(){var AE=o;if(p.hasClass("downloading")&&w.uploader.cancelUpload){if(D){AE=w.cdo.get("attachments")[o].uploaderInternalID;}w.uploader.cancelUpload(AE);}w.cdo._removeAttachment(o);}));x=p.one(".lozengeretry");if(x){if(!C.UA.webkit&&Y==q.UPLOADER_TYPE_FORM){x.addClass("hidden");}else{w.handles.push(x.on("click",function(){var AE=x.getAttribute("retries")||0;x.setAttribute("retries",++AE);w.retryOrSwitchAttachmentMode(o,AE);}));}}if(AB){p.one(".btn").setAttribute("dir",AB).addClass(AB);}w.handles.push(p.on("click",function(AE){if(!p.hasClass("downloading")){w.downloadAttachment(o);}}));u.append(p);if(q.debug){w.handles.push(p.on("click",function(AE){if(AE.altKey){q.logIt(w.cdo.get("attachments")[o]);}}));}w.dirty=true;}function E(Y){var o=this,n;n=o.uiAttList.all("li")&&o.uiAttList.all("li").item(Y);if(n){n.addClass(h);n.removeClass(T);}o.uploader&&o.uploader.removeAttachment&&o.uploader.removeAttachment(Y);}function M(n,Y){var r=this,q,p,o;q=r.uiAttList.all("li")&&r.uiAttList.all("li").item(n);if(q){p=!!q.one(".lozenge");o=p?".lozengeProgress":".progress";q.one(o).setStyle("width",Y+"%");q.one(o).set("aria-valuenow",Y);}}function i(n){var x=this,z="",u=V.str_rte_attachments_click_to_retry+".",v="",r="",s=x.uiAttList.all("li")&&x.uiAttList.all("li").item(n),y,AB,q,t,AE,p,w,Y="",AD,AA,o=C.mail.UploaderService;if(!s){return;}y=!!s.one(".lozenge");if(y){s=s.one(".lozenge").get("parentNode");}else{s.one(".file-container").removeClass("processing");s.one(".prog-indicator").addClass(h);}AB=x.cdo.get("attachments")[n];t=AB.state||{};AE=t.failCause;if(t.failed){s.addClass("transfer-error");if(y){s.all(".lozenge").addClass("lozengeerror");}if(AE==="virus"){s.addClass("transfer-virus");z=c("virusWarning");}else{if(AE==="size"){s.removeClass("downloading");s.one(".lozenge a").set("title",c("alert_size"));}else{if(!y){s.one(".retry").removeClass(h);}z=c("attachFailedWarning");}}if((C.UA.webkit||o.type!=o.UPLOADER_TYPE_FORM)&&AE!="virus"&&(AA=s.one(".lozengeretry"))){AA.removeClass(h);}x.attachError(AE,n);}else{if(AE){if(y){q=s.one("a");q.addClass("lozengewarn");z=c("noAVScanWarning");}else{s.addClass("transfer-warning");if(o.DEFAULT_UPLOADER!=o.UPLOADER_TYPE_FORM||C.UA.webkit){s.one(".lozengeretry").removeClass(h);}x.attachError(AB.state.failCause,n);}}else{if(y){if(s.hasClass("transfer-error")){s.removeClass("transfer-error");}if((AD=s.all(".lozenge"))&&AD.hasClass("lozengeerror")){AD.removeClass("lozengeerror");if(AA=s.one(".lozengeretry")){AA.addClass("hidden");}if(t.retry){s.addClass("downloading");}}}}}if(y){p=AB.size;w=AB.filename;if(!t.retry){s.removeClass("downloading");}p=t.resampled?p.sampled:p.original;p=g(p);try{Y=decodeURIComponent(w||"");}catch(AC){Y=decodeURIComponent(escape(w)||"")||"";}if(AE=="yui_progress_timeout"){v=" YUI Upload Progress Timeout.";
}if(NeoConfig.bidi&&V.str_tog_loadRTLCss){r=z+" "+Y+" \u202b("+p+")\u202c.";}else{r=z+" "+Y+" ("+p+").";}AD=s.one(".lozenge");AD&&AD.one("a").set("title",r);}else{C.use("event-mouseenter",function(){s.on("mouseenter",function(){s.addClass("over");});s.on("mouseleave",function(){s.removeClass("over");});});}if(s.hasClass(h)){x.cdo._removeAttachment(n);}}function f(o,Y,p){var r=this,q,n=!(C.UA.webkit);if(r.uploader.uploaderType!=C.mail.UploaderService.UPLOADER_TYPE_FORM&&Y>1){C.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_ok",function(s){s.common.ui.DialogHelper.custom({hd:V.str_comp_attach_reattach_title,bd:V.str_comp_attach_reattach_body,ft:l(A._shared_module_offscreen_bin_modal_btn_ok.base,0,0,0,V,A)},{"ok":{handler:function(){s.fire("compose:toggleUploaderType",{form:1,destroy:p});q=r.uiAttList.all(".lozengeretry");if(q&&n){q.addClass("hidden");}}}});});}else{if(Y>3){C.use("common-ui-dialog-helper",function(s){s.common.ui.DialogHelper.alert({hd:V.str_comp_attach_reattach_failure_title,bd:V.str_comp_attach_reattach_failure_body},{"ok":{handler:function(){r.cdo._removeAttachment(o);}}});});}else{r.uploader.retryAttachment&&r.uploader.retryAttachment(o);}}}function b(u){var s=this,n=s.tab.one("#upload_file_selection"),o=D&&n&&n.one(".attachment-button-html5")||D&&n&&n.one(".attachment-button-attach")||s.tab.one(".attachment-button-attach"),p=C.mail.UploaderService,v,t=s.uploaderConfig,q=u.flashCrash||0,w=u.destroy||0,x=u.callback||0,r=u.skipDefault||0,Y;if(r){t.skipDefault=r;}if(q){p.rs.intlStat("UploaderService","Uploader"+uploader.uploaderType+"_FlashCrash");}if(w){o.fire("yuiuploader:destroy");}else{if(!r){s.reposAttachObj("offscreen");}}if(x){v=x;}else{v=function(y){p.rs.intlStat("UploaderService","UploaderInstanceSwitchedTo_"+y.uploaderType);s.uploader=y;y.updateUI&&y.updateUI();};}if(s.prevUploader&&s.prevUploader.uploaderType==p.UPLOADER_TYPE_FORM){Y=s.uploader;s.uploader=s.prevUploader;s.prevUploader=Y;p.type=p.UPLOADER_TYPE_FORM;v(s.uploader);p.logIt("compose-attach: Switch to "+p.type+" uploader (found existing)");}else{s.prevUploader=s.uploader;t.forceForm=1;t.previousType=s.prevUploader&&s.prevUploader.uploaderType;C.use("mail-service-uploader-form",function(){p.create(t,v,p.UPLOADER_TYPE_FORM);});p.type=p.UPLOADER_TYPE_FORM;p.logIt("compose-attach: Switch to "+p.type+" uploader, creating new uploader");}s.prevUploader&&s.prevUploader.detachEvents&&s.prevUploader.detachEvents();}function B(n){var q=this,o=C.mail.UploaderService,Y,p=0;n=n||o.UPLOADER_TYPE_FLASH;o.rs.intlStat("UploaderService","SwitchTo"+n+"Uploader");if(q.prevUploader&&q.prevUploader.uploaderType==n){Y=q.uploader;q.uploader=q.prevUploader;q.prevUploader=Y;o.rs.intlStat("UploaderService","UploaderInstanceSwitchedTo_"+n);o.logIt("compose-attach: Switch to "+n+" uploader");o.type=n;q.uploader.bindEvents&&q.uploader.bindEvents();p=1;}else{o.logIt("compose-attach: switch to "+n+", ERROR - existing uploader not found!!");o.rs.intlStat("UploaderService","Existing"+n+"UploaderNotFound");}return p;}function K(o,Y,n){o.addClass("active");Y&&Y.hasClass("active")&&Y.removeClass("active");n&&n.hasClass("active")&&n.removeClass("active");}function S(n){var t=this,r=C.mail.UploaderService,s=n.text,q=t.type,p=t.tab,Y=t.uiAttBar,o=Y.one(".attachment-button-attach a")||Y.one(".attachment-button-attach i");r.logIt("updateAttachButtonUI");if(q==r.UPLOADER_TYPE_FLASH&&p.getStyle("visibility")=="visible"){t.reposAttachObj("restore");}else{t.reposAttachObj("offscreen");}if(D){r.toggleUploaderUI({type:q,tab:p,attView:t});}o.setContent(s);}function j(t){var s=this,o=C.mail.UploaderService,p="#switch-form",Y="#switch-flash",w="#switch-html5",u,n=t.node||C.one("#menu-attach-options"),r=t.flashCrash||0,v=t.destroy||0,q,x,y;o.logIt("toggleUploaderType: form="+t.form+", flash="+t.flash+",html5="+t.html5);if(t.form&&s.type!=o.UPLOADER_TYPE_FORM){o.rs.intlStat("UploaderService","ToggleFormActivated");s.type=o.UPLOADER_TYPE_FORM;s.switchToFormUploader({flashCrash:r,destroy:v});s.updateAttachButtonUI({text:V.str_comp_attach_singular});if(!C.UA.webkit){u=s.tab.all(".lozengeretry");u&&u.addClass("hidden");}n&&K(n.one(p),n.one(Y),n.one(w));}else{if((t.flash&&s.type!=o.UPLOADER_TYPE_FLASH)||(t.html5&&s.type!=o.UPLOADER_TYPE_HTML5)){if(t.flash){q=Y;x=w;y=o.UPLOADER_TYPE_FLASH;}else{q=w;x=Y;y=o.UPLOADER_TYPE_HTML5;}o.rs.intlStat("UploaderService","Toggle"+y+"Activated");n&&K(n.one(q),n.one(p),n.one(x));s.type=y;if(s.switchToUploader(y)){s.updateAttachButtonUI({text:V.str_comp_attach});}else{n&&K(n.one(p),n.one(Y),n.one(w));s.type=o.UPLOADER_TYPE_FORM;}}}}function g(n){var Y=V["str_rte_attachments_bytes"];if(n>1048575){n/=1048576;Y=V["str_rte_attachments_megabyte"];}else{if(n>1023){n/=1024;Y=V["str_rte_attachments_kilobyte"];}}if(isNaN(n)){n=0;}return Math.round(n)+" "+Y;}function N(Y){var q=this,n=q.cdo.get("attachments")[Y],p=n&&n.state||0,o=[];if(p.uploaded&&!p.failed&&!p.cancelled){q.cdo.fire("compose:downloadAttachment",Y);}}function k(s){var r=this,p=r.saveUiBtnStyle,o=s===2?"addClass":"removeClass",q=s>0?"addClass":"removeClass",Y=s>0?"removeClass":"addClass",n=C.one(".yuiUploadBox")||null;if(!r.uploader){return;}if(r.uiAttBtnDisabled&&r.uploader.uploaderType==C.mail.UploaderService.UPLOADER_TYPE_FLASH){r.uiAttBtnDisabled[Y](h);}if(r.uiAttSize){r.uiAttSize[o]("overlimit");}if(r.uiAttBtnForm){r.uiAttBtnForm[q](h);}if(n){if(s>0){if(!p){r.saveUiBtnStyle=n.getAttribute("style");}n.setAttribute("style","position:absolute;top:0;left:0;width:1px;height:1px;");}else{if(typeof p!=="undefined"){n.setAttribute("style",p);}}}}function X(o){var n=o&&o.state||{},p=o.mimetype||"",Y="";p=unescape(p);if(n.failed){Y="transfer-error ";if(n.failCause=="virus"){Y+="virus ";}}if(p){if(L[p]){Y+=L[p];}else{Y+="no-type";}}else{Y+="no-type";}return Y;}function F(r,u){var v=this,q=C.mail.UploaderService,w=v.uploader&&v.uploader.uploaderType,p=q&&q.UPLOADER_TYPE_FLASH,t="offscreen",Y="restore",n="move",o,s=v.uiAttBar.one("#upload_file_selection");if(q&&w==p&&v.uiAttBar){o=v.uiAttBar.one("span.attachment-button-attach");
if(o.hasClass(h)){o=s;}u=u||o.getXY();if(r==t||v.attachPaneHidden){if(!v.attachXY||v.attachXY[0]!=0||v.attachXY[1]!=0){v.attachXY=[0,0];o.fire("compose:reposAttachObj",{x:0,y:0,resize:true,width:"1px",height:"1px"});D&&o.setStyle("position","absolute");}}else{if((!v.attachXY||u[0]!=v.attachXY[0]||u[1]!=v.attachXY[1])&&(v.type==p||!v.type)){if(D){s.setStyle("position","relative").setStyle("top","auto").setStyle("left","auto");return;}v.attachXY=[u[0],u[1]];if(r==Y){o.fire("compose:reposAttachObj",{x:u[0],y:u[1],resize:true,height:o.getStyle("height"),width:o.getStyle("width")});}else{o.fire("compose:reposAttachObj",{x:u[0],y:u[1],resize:false});}}}}}function U(){var n=this,Y=n.uploader;C.each(n.handles,function(o){o.detach&&o.detach();});if(Y&&Y.handles){C.each(Y.handles,function(o){o.detach&&o.detach();});}if(Y&&Y.checkFlashTimeout){clearTimeout(Y.checkFlashTimeout);}n.toggleUploaderHandle&&n.toggleUploaderHandle.detach();n.uploader=null;n.uiAttForm=null;n.tab=null;n.uiAttBar=null;n.uiRemoveAll=null;n.uiAttCount=null;n.uiAttSize=null;n.uiAttAVLogo=null;n.uiAttMessage=null;n.uiAttBtnForm=null;n.uiAttBtnDisabled=null;n.uiAttPane=null;n.uiAttList=null;n.uiAttWelcome=null;n.uploaderConfig=null;}C.mail.AttachmentView.prototype={setAttachmentStyle:O,addAttachment:R,addNewAttachment:J,removeAttachment:E,enableAttachment:i,downloadAttachment:N,toggleOverLimit:k,updateAttachmentProgress:M,updateSizeAndCount:d,getIconClass:X,attachError:Z,checkOverLimit:I,retryOrSwitchAttachmentMode:f,switchToFormUploader:b,switchToUploader:B,toggleUploaderType:j,updateAttachButtonUI:S,reposAttachObj:F,cleanUp:U};},"1.0.0",{requires:["rocket-stats","swfdetect","mail-service-uploader-utils"]});YUI.add("selector-css3",function(a){a.Selector._reNth=/^(?:([\-]?\d*)(n){1}|(odd|even)$)*([\-+]?\d*)$/;a.Selector._getNth=function(d,o,q,h){a.Selector._reNth.test(o);var m=parseInt(RegExp.$1,10),c=RegExp.$2,j=RegExp.$3,k=parseInt(RegExp.$4,10)||0,p=[],l=a.Selector._children(d.parentNode,q),f;if(j){m=2;f="+";c="n";k=(j==="odd")?1:0;}else{if(isNaN(m)){m=(c)?1:0;}}if(m===0){if(h){k=l.length-k+1;}if(l[k-1]===d){return true;}else{return false;}}else{if(m<0){h=!!h;m=Math.abs(m);}}if(!h){for(var e=k-1,g=l.length;e<g;e+=m){if(e>=0&&l[e]===d){return true;}}}else{for(var e=l.length-k,g=l.length;e>=0;e-=m){if(e<g&&l[e]===d){return true;}}}return false;};a.mix(a.Selector.pseudos,{"root":function(b){return b===b.ownerDocument.documentElement;},"nth-child":function(b,c){return a.Selector._getNth(b,c);},"nth-last-child":function(b,c){return a.Selector._getNth(b,c,null,true);},"nth-of-type":function(b,c){return a.Selector._getNth(b,c,b.tagName);},"nth-last-of-type":function(b,c){return a.Selector._getNth(b,c,b.tagName,true);},"last-child":function(c){var b=a.Selector._children(c.parentNode);return b[b.length-1]===c;},"first-of-type":function(b){return a.Selector._children(b.parentNode,b.tagName)[0]===b;},"last-of-type":function(c){var b=a.Selector._children(c.parentNode,c.tagName);return b[b.length-1]===c;},"only-child":function(c){var b=a.Selector._children(c.parentNode);return b.length===1&&b[0]===c;},"only-of-type":function(c){var b=a.Selector._children(c.parentNode,c.tagName);return b.length===1&&b[0]===c;},"empty":function(b){return b.childNodes.length===0;},"not":function(b,c){return !a.Selector.test(b,c);},"contains":function(b,c){var d=b.innerText||b.textContent||"";return d.indexOf(c)>-1;},"checked":function(b){return(b.checked===true||b.selected===true);},enabled:function(b){return(b.disabled!==undefined&&!b.disabled);},disabled:function(b){return(b.disabled);}});a.mix(a.Selector.operators,{"^=":"^{val}","$=":"{val}$","*=":"{val}"});a.Selector.combinators["~"]={axis:"previousSibling"};},"@VERSION@",{requires:["dom-base","selector-native","selector-css2"]});YUI.add("comms-intl-bidi",function(A){A.mix(A.namespace("Intl"),{_rtlChars:"[\uD83A\uD83B][\uDC00-\uDFFF]|[\u0590\u05BE\u05C0\u05C3\u05C6\u05C8-\u05FF\u0604\u0605\u0608\u060B\u060D\u061B-\u064A\u065F\u066D-\u066F\u0671-\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u070E\u0710\u0712-\u072F\u074B-\u07A5\u07B1-\u07EA\u07F4\u07F5\u07FA-\u0815\u081A\u0824\u0828\u082E-\u08FF\u200F\uFB1D\uFB1F-\uFB28\uFB2A-\uFD3D\uFD40-\uFDCF\uFDF0-\uFDFC\uFDFE\uFDFF\uFE70-\uFEFE]|\uD803[\uDC00-\uDE5F\uDE7F-\uDFFF]|\uD802[\uDC00-\uDD1E\uDD20-\uDE00\uDE04\uDE07-\uDE0B\uDE10-\uDE37\uDE3B-\uDE3E\uDE40-\uDF38\uDF40-\uDFFF]",_neutralChars:"[\uDB40-\uDB43][\uDC00-\uDFFF]|\uD802[\uDD1F\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDF39-\uDF3F]|\uD804[\uDC80\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA]|\uD803[\uDE60-\uDE7E]|\uD800[\uDD01\uDD40-\uDD8A\uDD90-\uDD9B\uDDFD]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDD00-\uDD0A]|[\u0000-\u0040\u005B-\u0060\u007B-\u00A9\u00AB-\u00B4\u00B6-\u00B9\u00BB-\u00BF\u00D7\u00F7\u02B9\u02BA\u02C2-\u02CF\u02D2-\u02DF\u02E5-\u02ED\u02EF-\u036F\u0374\u0375\u037E\u0384\u0385\u0387\u03F6\u0483-\u0489\u058A\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0600-\u0603\u0606\u0607\u0609\u060A\u060C\u060E-\u061A\u064B-\u065E\u0660-\u066C\u0670\u06D6-\u06E4\u06E7-\u06ED\u06F0-\u06F9\u070F\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07F6-\u07F9\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0900-\u0902\u093C\u0941-\u0948\u094D\u0951-\u0955\u0962\u0963\u0981\u09BC\u09C1-\u09C4\u09CD\u09E2\u09E3\u09F2\u09F3\u09FB\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AF1\u0B01\u0B3C\u0B3F\u0B41-\u0B44\u0B4D\u0B56\u0B62\u0B63\u0B82\u0BC0\u0BCD\u0BF3-\u0BFA\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C78-\u0C7E\u0CBC\u0CCC\u0CCD\u0CE2\u0CE3\u0CF1\u0CF2\u0D41-\u0D44\u0D4D\u0D62\u0D63\u0DCA\u0DD2-\u0DD4\u0DD6\u0E31\u0E34-\u0E3A\u0E3F\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39-\u0F3D\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F90-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135F\u1390-\u1399\u1400\u1680\u169B\u169C\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DB\u17DD\u17F0-\u17F9\u1800-\u180E\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1940\u1944\u1945\u19DE-\u19FF\u1A17\u1A18\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1B00-\u1B03\u1B34\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1DC0-\u1DE6\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2000-\u200D\u2010-\u2070\u2074-\u207E\u2080-\u208E\u20A0-\u20B8\u20D0-\u20F0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u2150-\u215F\u2189\u2190-\u2335\u237B-\u2394\u2396-\u23E8\u2400-\u2426\u2440-\u244A\u2460-\u249B\u24EA-\u26AB\u26AD-\u26CD\u26CF-\u26E1\u26E3\u26E8-\u26FF\u2701-\u2704\u2706-\u2709\u270C-\u2727\u2729-\u274B\u274D\u274F-\u2752\u2756-\u275E\u2761-\u2794\u2798-\u27AF\u27B1-\u27BE\u27C0-\u27CA\u27CC\u27D0-\u27FF\u2900-\u2B4C\u2B50-\u2B59\u2CE5-\u2CEA\u2CEF-\u2CF1\u2CF9-\u2CFF\u2DE0-\u2E31\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u3004\u3008-\u3020\u302A-\u3030\u3036\u3037\u303D-\u303F\u3099-\u309C\u30A0\u30FB\u31C0-\u31E3\u321D\u321E\u3250-\u325F\u327C-\u327E\u32B1-\u32BF\u32CC-\u32CF\u3377-\u337A\u33DE\u33DF\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA60D-\uA60F\uA66F-\uA673\uA67C-\uA67F\uA6F0\uA6F1\uA700-\uA721\uA788\uA802\uA806\uA80B\uA825\uA826\uA828-\uA82B\uA838\uA839\uA874-\uA877\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uABE5\uABE8\uABED\uFB1E\uFB29\uFD3E\uFD3F\uFDD0-\uFDEF\uFDFD\uFE00-\uFE19\uFE20-\uFE26\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFEFF\uFF01-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFF0-\uFFFF]|\uD835[\uDEDB\uDF15\uDF4F\uDF89\uDFC3\uDFCE-\uDFFF]|\uD834[\uDD67-\uDD69\uDD73-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE00-\uDE45\uDF00-\uDF56]",_initializeBidiPatterns:function(){this._rtlPattern=new RegExp("^(?:"+this._neutralChars+")*(?:"+this._rtlChars+")");this._neturalPattern=new RegExp("^(?:"+this._neutralChars+")*$");},setBidiChars:function(B,C){if(B!==undefined){this._rtlChars=B;}if(C!==undefined){this._neutralChars=C;}this._initializeBidiPatterns();},detectDirection:function(C,B){if(this._rtlPattern.test(C)){return"rtl";}else{if(B==="ltr"){return"ltr";}else{if(this._neturalPattern.test(C)){if(B==="rtl"){return"rtl";}else{return"";}}else{return"ltr";}}}}});A.Intl._initializeBidiPatterns();A.mix(A.namespace("Intl"),{bidiDirection:A.Intl.detectDirection});},"1.0.0");YUI.add("comms-node-setdir",function(B){var A={ltr:"rtl",rtl:"ltr"};B.Node.addMethod("setDirection",function(E,F){var D,C;if(F==="ltr"||F==="rtl"){D=B.one(E);C=D.getStyle("direction");D.setAttribute("dir",F);D.setStyle("direction","");D.removeClass(B.ClassNameManager.getClassName(A[F]));D.addClass(B.ClassNameManager.getClassName(F));if(F!==C){B.fire("directionChange",{target:D,dir:F});}}return D;});},"1.0.0",{requires:["classnamemanager","node-base","node-style"]});YUI.add("comms-bidi-textentry",function(B){function A(){A.superclass.constructor.apply(this,arguments);}A.NS="bidiTextEntry";A.NAME="bidiTextEntry";B.extend(A,B.Plugin.Base,{initializer:function(C){var E=this.get("host"),D;E.BIDI_DISABLED=false;E.PREVIOUS_DIRECTION=E.getStyle("direction");if(!E.PREVIOUS_DIRECTION){E.PREVIOUS_DIRECTION=E.getAttribute("dir");}E.DETECT_DEFAULT_DIRECTION=(C&&C.detect_default_direction===true);if(!E.DETECT_DEFAULT_DIRECTION){E.setDirection(E.PREVIOUS_DIRECTION);}else{D=B.Intl.detectDirection(E.get("value"));E.setDirection(D);E.PREVIOUS_DIRECTION=D;}this.afterHostEvent("valueChange",function(H){var G=this.get("host"),J,I=G.BIDI_DISABLED,F=G.PREVIOUS_DIRECTION,K;if(I){return;}K=G.getAttribute("dir");if(F!=K){G.BIDI_DISABLED=true;return;}J=B.Intl.detectDirection(H.newVal);if(J==="rtl"||J=="ltr"){G.PREVIOUS_DIRECTION=J;}G.setDirection(J);});}});B.namespace("Plugin");B.Plugin.BidiTextEntry=A;B.Plugin.BidiTextInput=A;},"1.0.0",{requires:["plugin","event-valuechange","comms-intl-bidi","comms-node-setdir"]});YUI.add("frame",function(d){var a=function(){a.superclass.constructor.apply(this,arguments);},c=":last-child",b="body";d.extend(a,d.Base,{_ready:null,_rendered:null,_iframe:null,_instance:null,_create:function(e){var k,j,g,i;this._iframe=d.Node.create(a.HTML);this._iframe.setStyle("visibility","hidden");this._iframe.set("src",this.get("src"));this.get("container").append(this._iframe);this._iframe.set("height","99%");var f="",h=((this.get("extracss"))?'<style id="extra_css">'+this.get("extracss")+"</style>":"");f=d.substitute(a.PAGE_HTML,{DIR:this.get("dir"),LANG:this.get("lang"),TITLE:this.get("title"),META:a.META,LINKED_CSS:this.get("linkedcss"),CONTENT:this.get("content"),BASE_HREF:this.get("basehref"),DEFAULT_CSS:a.DEFAULT_CSS,EXTRA_CSS:h});if(d.config.doc.compatMode!="BackCompat"){f=a.getDocType()+"\n"+f;}else{}g=this._resolveWinDoc();g.doc.open();g.doc.write(f);g.doc.close();if(!g.doc.documentElement){var l=d.later(1,this,function(){if(g.doc&&g.doc.documentElement){e(g);l.cancel();}},null,true);}else{e(g);}},_resolveWinDoc:function(f){var e=(f)?f:{};e.win=d.Node.getDOMNode(this._iframe.get("contentWindow"));e.doc=d.Node.getDOMNode(this._iframe.get("contentWindow.document"));if(!e.doc){e.doc=d.config.doc;}if(!e.win){e.win=d.config.win;}return e;},_onDomEvent:function(h){var g,f;if(!d.Node.getDOMNode(this._iframe)){return;}h.frameX=h.frameY=0;if(h.pageX>0||h.pageY>0){if(h.type.substring(0,3)!=="key"){f=this._instance.one("win");g=this._iframe.getXY();h.frameX=g[0]+h.pageX-f.get("scrollLeft");h.frameY=g[1]+h.pageY-f.get("scrollTop");}}h.frameTarget=h.target;h.frameCurrentTarget=h.currentTarget;h.frameEvent=h;this.fire("dom:"+h.type,h);},initializer:function(){this.publish("ready",{emitFacade:true,defaultFn:this._defReadyFn});},destructor:function(){var e=this.getInstance();e.one("doc").detachAll();e=null;this._iframe.remove();},_DOMPaste:function(i){var g=this.getInstance(),f="",h=g.config.win;if(i._event.originalTarget){f=i._event.originalTarget;}if(i._event.clipboardData){f=i._event.clipboardData.getData("Text");}if(h.clipboardData){f=h.clipboardData.getData("Text");if(f===""){if(!h.clipboardData.setData("Text",f)){f=null;}}}i.frameTarget=i.target;i.frameCurrentTarget=i.currentTarget;i.frameEvent=i;if(f){i.clipboardData={data:f,getData:function(){return f;}};}else{i.clipboardData=null;}this.fire("dom:paste",i);},_defReadyFn:function(){var e=this.getInstance();d.each(a.DOM_EVENTS,function(g,f){var h=d.bind(this._onDomEvent,this),i=((d.UA.ie&&a.THROTTLE_TIME>0)?d.throttle(h,a.THROTTLE_TIME):h);if(!e.Node.DOM_EVENTS[f]){e.Node.DOM_EVENTS[f]=1;}if(g===1){if(f!=="focus"&&f!=="blur"&&f!=="paste"){if(f.substring(0,3)==="key"){e.on(f,i,e.config.doc);}else{e.on(f,h,e.config.doc);}}}},this);e.Node.DOM_EVENTS.paste=1;e.on("paste",d.bind(this._DOMPaste,this),e.one("body"));e.on("focus",d.bind(this._onDomEvent,this),e.config.win);e.on("blur",d.bind(this._onDomEvent,this),e.config.win);e._use=e.use;e.use=d.bind(this.use,this);this._iframe.setStyles({visibility:"inherit"});e.one("body").setStyle("display","block");if(d.UA.ie){this._fixIECursors();}},_fixIECursors:function(){var h=this.getInstance(),f=h.all("table"),g=h.all("br"),e;if(f.size()&&g.size()){e=f.item(0).get("sourceIndex");g.each(function(l){var j=l.get("parentNode"),k=j.get("children"),i=j.all(">br");if(j.test("div")){if(k.size()>2){l.replace(h.Node.create("<wbr>"));}else{if(l.get("sourceIndex")>e){if(i.size()){l.replace(h.Node.create("<wbr>"));}}else{if(i.size()>1){l.replace(h.Node.create("<wbr>"));}}}}});}},_onContentReady:function(h){if(!this._ready){this._ready=true;var g=this.getInstance(),f=d.clone(this.get("use"));this.fire("contentready");if(h){g.config.doc=d.Node.getDOMNode(h.target);}f.push(d.bind(function(){if(g.Selection){g.Selection.DEFAULT_BLOCK_TAG=this.get("defaultblock");}if(this.get("designMode")){if(d.UA.ie){g.config.doc.body.contentEditable="true";this._ieSetBodyHeight();g.on("keyup",d.bind(this._ieSetBodyHeight,this),g.config.doc);}else{g.config.doc.designMode="on";}}this.fire("ready");},this));g.use.apply(g,f);g.one("doc").get("documentElement").addClass("yui-js-enabled");}},_ieHeightCounter:null,_ieSetBodyHeight:function(k){if(!this._ieHeightCounter){this._ieHeightCounter=0;}this._ieHeightCounter++;var j=false;if(!k){j=true;}if(k){switch(k.keyCode){case 8:case 13:j=true;break;}if(k.ctrlKey||k.shiftKey){j=true;}}if(j){try{var i=this.getInstance();var g=this._iframe.get("offsetHeight");var f=i.config.doc.body.scrollHeight;if(g>f){g=(g-15)+"px";i.config.doc.body.style.height=g;}else{i.config.doc.body.style.height="auto";}}catch(k){if(this._ieHeightCounter<100){d.later(200,this,this._ieSetBodyHeight);}else{}}}},_resolveBaseHref:function(e){if(!e||e===""){e=d.config.doc.location.href;if(e.indexOf("?")!==-1){e=e.substring(0,e.indexOf("?"));}e=e.substring(0,e.lastIndexOf("/"))+"/";}return e;},_getHTML:function(e){if(this._ready){var f=this.getInstance();e=f.one("body").get("innerHTML");}return e;},_setHTML:function(e){if(this._ready){var f=this.getInstance();f.one("body").set("innerHTML",e);}else{this.on("contentready",d.bind(function(g,i){var h=this.getInstance();h.one("body").set("innerHTML",g);},this,e));}return e;},_getLinkedCSS:function(e){if(!d.Lang.isArray(e)){e=[e];}var f="";if(!this._ready){d.each(e,function(g){if(g!==""){f+='<link rel="stylesheet" href="'+g+'" type="text/css">';}});}else{f=e;}return f;},_setLinkedCSS:function(e){if(this._ready){var f=this.getInstance();f.Get.css(e);}return e;},_setExtraCSS:function(e){if(this._ready){var g=this.getInstance(),f=g.one("#extra_css");f.remove();g.one("head").append('<style id="extra_css">'+e+"</style>");}return e;},_instanceLoaded:function(f){this._instance=f;this._onContentReady();var g=this._instance.config.doc;if(this.get("designMode")){if(!d.UA.ie){try{g.execCommand("styleWithCSS",false,false);g.execCommand("insertbronreturn",false,false);}catch(e){}}}},use:function(){var g=this.getInstance(),f=d.Array(arguments),e=false;if(d.Lang.isFunction(f[f.length-1])){e=f.pop();
}if(e){f.push(function(){e.apply(g,arguments);});}g._use.apply(g,f);},delegate:function(g,f,e,i){var h=this.getInstance();if(!h){return false;}if(!i){i=e;e="body";}return h.delegate(g,f,e,i);},getInstance:function(){return this._instance;},render:function(e){if(this._rendered){return this;}this._rendered=true;if(e){this.set("container",e);}this._create(d.bind(function(i){var k,l,f=d.bind(function(m){this._instanceLoaded(m);},this),h=d.clone(this.get("use")),g={debug:false,win:i.win,doc:i.doc},j=d.bind(function(){g=this._resolveWinDoc(g);k=YUI(g);k.host=this.get("host");try{k.use("node-base",f);if(l){clearInterval(l);}}catch(m){l=setInterval(function(){j();},350);}},this);h.push(j);d.use.apply(d,h);},this));return this;},_handleFocus:function(){var h=this.getInstance(),g=new h.Selection();if(g.anchorNode){var j=g.anchorNode,i;if(j.test("p")&&j.get("innerHTML")===""){j=j.get("parentNode");}i=j.get("childNodes");if(i.size()){if(i.item(0).test("br")){g.selectNode(j,true,false);}else{if(i.item(0).test("p")){j=i.item(0).one("br.yui-cursor");if(j){j=j.get("parentNode");}if(!j){j=i.item(0).get("firstChild");}if(!j){j=i.item(0);}if(j){g.selectNode(j,true,false);}}else{var e=h.one("br.yui-cursor");if(e){var f=e.get("parentNode");if(f){g.selectNode(f,true,false);}}}}}}},focus:function(e){if(d.UA.ie&&d.UA.ie<9){try{d.one("win").focus();this.getInstance().one("win").focus();}catch(g){}if(e===true){this._handleFocus();}if(d.Lang.isFunction(e)){e();}}else{try{d.one("win").focus();d.later(100,this,function(){this.getInstance().one("win").focus();if(e===true){this._handleFocus();}if(d.Lang.isFunction(e)){e();}});}catch(f){}}return this;},show:function(){this._iframe.setStyles({position:"static",left:""});if(d.UA.gecko){try{this._instance.config.doc.designMode="on";}catch(f){}this.focus();}return this;},hide:function(){this._iframe.setStyles({position:"absolute",left:"-999999px"});return this;}},{THROTTLE_TIME:100,DOM_EVENTS:{dblclick:1,click:1,paste:1,mouseup:1,mousedown:1,keyup:1,keydown:1,keypress:1,activate:1,deactivate:1,beforedeactivate:1,focusin:1,focusout:1},DEFAULT_CSS:"body { background-color: #fff; font: 13px/1.22 arial,helvetica,clean,sans-serif;*font-size:small;*font:x-small; } a, a:visited, a:hover { color: blue !important; text-decoration: underline !important; cursor: text !important; } img { cursor: pointer !important; border: none; }",HTML:'<iframe border="0" frameBorder="0" marginWidth="0" marginHeight="0" leftMargin="0" topMargin="0" allowTransparency="true" width="100%" height="99%"></iframe>',PAGE_HTML:'<html dir="{DIR}" lang="{LANG}"><head><title>{TITLE}</title>{META}<base href="{BASE_HREF}"/>{LINKED_CSS}<style id="editor_css">{DEFAULT_CSS}</style>{EXTRA_CSS}</head><body>{CONTENT}</body></html>',getDocType:function(){var e=d.config.doc.doctype,f=a.DOC_TYPE;if(e){f="<!DOCTYPE "+e.name+((e.publicId)?" "+e.publicId:"")+((e.systemId)?" "+e.systemId:"")+">";}else{if(d.config.doc.all){e=d.config.doc.all[0];if(e.nodeType){if(e.nodeType===8){if(e.nodeValue){if(e.nodeValue.toLowerCase().indexOf("doctype")!==-1){f="<!"+e.nodeValue+">";}}}}}}return f;},DOC_TYPE:'<!DOCTYPE HTML PUBLIC "-/'+"/W3C/"+"/DTD HTML 4.01/"+'/EN" "http:/'+'/www.w3.org/TR/html4/strict.dtd">',META:'<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=7">',NAME:"frame",ATTRS:{title:{value:"Blank Page"},dir:{value:"ltr"},lang:{value:"en-US"},src:{value:"javascript"+((d.UA.ie)?":false":":")+";"},designMode:{writeOnce:true,value:false},content:{value:"<br>",setter:"_setHTML",getter:"_getHTML"},basehref:{value:false,getter:"_resolveBaseHref"},use:{writeOnce:true,value:["substitute","node","node-style","selector-css3"]},container:{value:"body",setter:function(e){return d.one(e);}},node:{readOnly:true,value:null,getter:function(){return this._iframe;}},id:{writeOnce:true,getter:function(e){if(!e){e="iframe-"+d.guid();}return e;}},linkedcss:{value:"",getter:"_getLinkedCSS",setter:"_setLinkedCSS"},extracss:{value:"",setter:"_setExtraCSS"},host:{value:false},defaultblock:{value:"p"}}});d.Frame=a;},"@VERSION@",{skinnable:false,requires:["base","node","selector-css3","substitute","yui-throttle"]});YUI.add("selection",function(b){var a="textContent",d="innerHTML",c="fontFamily";if(b.UA.ie){a="nodeValue";}b.Selection=function(o){var j,p,f,g,e,l;if(b.config.win.getSelection){j=b.config.win.getSelection();}else{if(b.config.doc.selection){j=b.config.doc.selection.createRange();}}this._selection=j;if(j.pasteHTML){this.isCollapsed=(j.compareEndPoints("StartToEnd",j))?false:true;if(this.isCollapsed){this.anchorNode=this.focusNode=b.one(j.parentElement());if(o){f=b.config.doc.elementFromPoint(o.clientX,o.clientY);}e=j.duplicate();if(!f){p=j.parentElement();g=p.childNodes;for(l=0;l<g.length;l++){if(e.inRange(j)){if(!f){f=g[l];}}}}this.ieNode=f;if(f){if(f.nodeType!==3){if(f.firstChild){f=f.firstChild;}if(f&&f.tagName&&f.tagName.toLowerCase()==="body"){if(f.firstChild){f=f.firstChild;}}}this.anchorNode=this.focusNode=b.Selection.resolve(f);e.moveToElementText(j.parentElement());var m=j.compareEndPoints("StartToStart",e),q=0;if(m){q=Math.abs(j.move("character",-9999));}this.anchorOffset=this.focusOffset=q;this.anchorTextNode=this.focusTextNode=b.one(f);}}else{if(j.htmlText&&j.htmlText!==""){var k=b.Node.create(j.htmlText);if(k&&k.get("id")){var h=k.get("id");this.anchorNode=this.focusNode=b.one("#"+h);}else{if(k){k=k.get("childNodes");this.anchorNode=this.focusNode=k.item(0);}}}}}else{this.isCollapsed=j.isCollapsed;this.anchorNode=b.Selection.resolve(j.anchorNode);this.focusNode=b.Selection.resolve(j.focusNode);this.anchorOffset=j.anchorOffset;this.focusOffset=j.focusOffset;this.anchorTextNode=b.one(j.anchorNode);this.focusTextNode=b.one(j.focusNode);}if(b.Lang.isString(j.text)){this.text=j.text;}else{if(j.toString){this.text=j.toString();}else{this.text="";}}};b.Selection.removeFontFamily=function(f){f.removeAttribute("face");var e=f.getAttribute("style").toLowerCase();if(e===""||(e=="font-family: ")){f.removeAttribute("style");
}if(e.match(b.Selection.REG_FONTFAMILY)){e=e.replace(b.Selection.REG_FONTFAMILY,"");f.setAttribute("style",e);}};b.Selection.filter=function(e){var h=(new Date()).getTime();var g=b.all(b.Selection.ALL),k=b.all("strong,em"),n=b.config.doc,p,f={},i="",l;var j=(new Date()).getTime();g.each(function(r){var q=b.Node.getDOMNode(r);if(q.style[c]){f["."+r._yuid]=q.style[c];r.addClass(r._yuid);b.Selection.removeFontFamily(q);}});var o=(new Date()).getTime();b.all(".hr").addClass("yui-skip").addClass("yui-non");if(b.UA.ie){p=n.getElementsByTagName("hr");b.each(p,function(t){var r=n.createElement("div");r.className="hr yui-non yui-skip";r.setAttribute("readonly",true);r.setAttribute("contenteditable",false);if(t.parentNode){t.parentNode.replaceChild(r,t);}var q=r.style;q.border="1px solid #ccc";q.lineHeight="0";q.height="0";q.fontSize="0";q.marginTop="5px";q.marginBottom="5px";q.marginLeft="0px";q.marginRight="0px";q.padding="0";});}b.each(f,function(r,q){i+=q+" { font-family: "+r.replace(/"/gi,"")+"; }";});b.StyleSheet(i,"editor");k.each(function(u,q){var r=u.get("tagName").toLowerCase(),s="i";if(r==="strong"){s="b";}b.Selection.prototype._swap(k.item(q),s);});l=b.all("ol,ul");l.each(function(r,q){var s=r.all("li");if(!s.size()){r.remove();}});if(e){b.Selection.filterBlocks();}var m=(new Date()).getTime();};b.Selection.filterBlocks=function(){var f=(new Date()).getTime();var n=b.config.doc.body.childNodes,h,g,q=false,k=true,e,r,t,p,m,o,u;if(n){for(h=0;h<n.length;h++){g=b.one(n[h]);if(!g.test(b.Selection.BLOCKS)){k=true;if(n[h].nodeType==3){o=n[h][a].match(b.Selection.REG_CHAR);u=n[h][a].match(b.Selection.REG_NON);if(o===null&&u){k=false;}}if(k){if(!q){q=[];}q.push(n[h]);}}else{q=b.Selection._wrapBlock(q);}}q=b.Selection._wrapBlock(q);}r=b.all(b.Selection.DEFAULT_BLOCK_TAG);if(r.size()===1){t=r.item(0).all("br");if(t.size()===1){if(!t.item(0).test(".yui-cursor")){t.item(0).remove();}var j=r.item(0).get("innerHTML");if(j===""||j===" "){r.set("innerHTML",b.Selection.CURSOR);e=new b.Selection();e.focusCursor(true,true);}if(t.item(0).test(".yui-cursor")&&b.UA.ie){t.item(0).remove();}}}else{r.each(function(s){var i=s.get("innerHTML");if(i===""){s.remove();}});}if(!b.UA.ie){}var l=(new Date()).getTime();};b.Selection.REG_FONTFAMILY=/font-family: ;/;b.Selection.REG_CHAR=/[a-zA-Z-0-9_!@#\$%\^&*\(\)-=_+\[\]\\{}|;':",.\/<>\?]/gi;b.Selection.REG_NON=/[\s|\n|\t]/gi;b.Selection.REG_NOHTML=/<\S[^><]*>/g;b.Selection._wrapBlock=function(f){if(f){var e=b.Node.create("<"+b.Selection.DEFAULT_BLOCK_TAG+"></"+b.Selection.DEFAULT_BLOCK_TAG+">"),h=b.one(f[0]),g;for(g=1;g<f.length;g++){e.append(f[g]);}h.replace(e);e.prepend(h);}return false;};b.Selection.unfilter=function(){var g=b.all("body [class]"),h="",f,i,e=b.one("body");g.each(function(j){if(j.hasClass(j._yuid)){j.setStyle(c,j.getStyle(c));j.removeClass(j._yuid);if(j.getAttribute("class")===""){j.removeAttribute("class");}}});f=b.all(".yui-non");f.each(function(j){if(!j.hasClass("yui-skip")&&j.get("innerHTML")===""){j.remove();}else{j.removeClass("yui-non").removeClass("yui-skip");}});i=b.all("body [id]");i.each(function(j){if(j.get("id").indexOf("yui_3_")===0){j.removeAttribute("id");j.removeAttribute("_yuid");}});if(e){h=e.get("innerHTML");}b.all(".hr").addClass("yui-skip").addClass("yui-non");return h;};b.Selection.resolve=function(f){if(f&&f.nodeType===3){try{f=f.parentNode;}catch(e){f="body";}}return b.one(f);};b.Selection.getText=function(f){var e=f.get("innerHTML").replace(b.Selection.REG_NOHTML,"");e=e.replace("<span><br></span>","").replace("<br>","");return e;};b.Selection.DEFAULT_BLOCK_TAG="p";b.Selection.ALL="[style],font[face]";b.Selection.BLOCKS="p,div,ul,ol,table,style";b.Selection.TMP="yui-tmp";b.Selection.DEFAULT_TAG="span";b.Selection.CURID="yui-cursor";b.Selection.CUR_WRAPID="yui-cursor-wrapper";b.Selection.CURSOR='<span><br class="yui-cursor"></span>';b.Selection.hasCursor=function(){var e=b.all("#"+b.Selection.CUR_WRAPID);return e.size();};b.Selection.cleanCursor=function(){var f,e="br.yui-cursor";f=b.all(e);if(f.size()){f.each(function(g){var i=g.get("parentNode.parentNode.childNodes"),h;if(i.size()){g.remove();}else{h=b.Selection.getText(i.item(0));if(h!==""){g.remove();}}});}};b.Selection.prototype={text:null,isCollapsed:null,anchorNode:null,anchorOffset:null,anchorTextNode:null,focusNode:null,focusOffset:null,focusTextNode:null,_selection:null,_wrap:function(g,e){var f=b.Node.create("<"+e+"></"+e+">");f.set(d,g.get(d));g.set(d,"");g.append(f);return b.Node.getDOMNode(f);},_swap:function(g,e){var f=b.Node.create("<"+e+"></"+e+">");f.set(d,g.get(d));g.replace(f,g);return b.Node.getDOMNode(f);},getSelected:function(){b.Selection.filter();b.config.doc.execCommand("fontname",null,b.Selection.TMP);var f=b.all(b.Selection.ALL),e=[];f.each(function(h,g){if(h.getStyle(c)==b.Selection.TMP){h.setStyle(c,"");b.Selection.removeFontFamily(h);if(!h.test("body")){e.push(b.Node.getDOMNode(f.item(g)));}}});return b.all(e);},insertContent:function(e){return this.insertAtCursor(e,this.anchorTextNode,this.anchorOffset,true);},insertAtCursor:function(l,g,i,o){var q=b.Node.create("<"+b.Selection.DEFAULT_TAG+' class="yui-non"></'+b.Selection.DEFAULT_TAG+">"),f,j,h,p,k=this.createRange(),n;if(g&&g.test("body")){n=b.Node.create("<span></span>");g.append(n);g=n;}if(k.pasteHTML){if(i===0&&g&&!g.previous()&&g.get("nodeType")===3){g.insert(l,"before");if(k.moveToElementText){k.moveToElementText(b.Node.getDOMNode(g.previous()));}k.collapse(false);k.select();return g.previous();}else{p=b.Node.create(l);try{k.pasteHTML('<span id="rte-insert"></span>');}catch(m){}f=b.one("#rte-insert");if(f){f.set("id","");f.replace(p);if(k.moveToElementText){k.moveToElementText(b.Node.getDOMNode(p));}k.collapse(false);k.select();return p;}else{b.on("available",function(){f.set("id","");f.replace(p);if(k.moveToElementText){k.moveToElementText(b.Node.getDOMNode(p));}k.collapse(false);k.select();},"#rte-insert");}}}else{if(i>0){f=g.get(a);j=b.one(b.config.doc.createTextNode(f.substr(0,i)));h=b.one(b.config.doc.createTextNode(f.substr(i)));
g.replace(j,g);p=b.Node.create(l);if(p.get("nodeType")===11){n=b.Node.create("<span></span>");n.append(p);p=n;}j.insert(p,"after");if(h){p.insert(q,"after");q.insert(h,"after");this.selectNode(q,o);}}else{if(g.get("nodeType")===3){g=g.get("parentNode");}p=b.Node.create(l);l=g.get("innerHTML").replace(/\n/gi,"");if(l===""||l==="<br>"){g.append(p);}else{if(p.get("parentNode")){g.insert(p,"before");}else{b.one("body").prepend(p);}}if(g.get("firstChild").test("br")){g.get("firstChild").remove();}}}return p;},wrapContent:function(f){f=(f)?f:b.Selection.DEFAULT_TAG;if(!this.isCollapsed){var h=this.getSelected(),k=[],g,i,j,e;h.each(function(o,l){var m=o.get("tagName").toLowerCase();if(m==="font"){k.push(this._swap(h.item(l),f));}else{k.push(this._wrap(h.item(l),f));}},this);g=this.createRange();j=k[0];i=k[k.length-1];if(this._selection.removeAllRanges){g.setStart(k[0],0);g.setEnd(i,i.childNodes.length);this._selection.removeAllRanges();this._selection.addRange(g);}else{if(g.moveToElementText){g.moveToElementText(b.Node.getDOMNode(j));e=this.createRange();e.moveToElementText(b.Node.getDOMNode(i));g.setEndPoint("EndToEnd",e);}g.select();}k=b.all(k);return k;}else{return b.all([]);}},replace:function(k,i){var f=this.createRange(),j,e,g,h;if(f.getBookmark){g=f.getBookmark();e=this.anchorNode.get("innerHTML").replace(k,i);this.anchorNode.set("innerHTML",e);f.moveToBookmark(g);h=b.one(f.parentElement());}else{j=this.anchorTextNode;e=j.get(a);g=e.indexOf(k);e=e.replace(k,"");j.set(a,e);h=this.insertAtCursor(i,j,g,true);}return h;},remove:function(){this._selection.removeAllRanges();return this;},createRange:function(){if(b.config.doc.selection){return b.config.doc.selection.createRange();}else{return b.config.doc.createRange();}},selectNode:function(i,k,f){if(!i){return;}f=f||0;i=b.Node.getDOMNode(i);var g=this.createRange();if(g.selectNode){g.selectNode(i);this._selection.removeAllRanges();this._selection.addRange(g);if(k){try{this._selection.collapse(i,f);}catch(h){this._selection.collapse(i,0);}}}else{if(i.nodeType===3){i=i.parentNode;}try{g.moveToElementText(i);}catch(j){}if(k){g.collapse(((f)?false:true));}g.select();}return this;},setCursor:function(){this.removeCursor(false);return this.insertContent(b.Selection.CURSOR);},getCursor:function(){return b.all("#"+b.Selection.CURID);},removeCursor:function(e){var f=this.getCursor();if(f){if(e){f.removeAttribute("id");f.set("innerHTML",'<br class="yui-cursor">');}else{f.remove();}}return f;},focusCursor:function(g,e){if(g!==false){g=true;}if(e!==false){e=true;}var f=this.removeCursor(true);if(f){f.each(function(h){this.selectNode(h,g,e);},this);}},toString:function(){return"Selection Object";}};},"@VERSION@",{skinnable:false,requires:["node"]});YUI.add("exec-command",function(b){var a=function(){a.superclass.constructor.apply(this,arguments);};b.extend(a,b.Base,{_lastKey:null,_inst:null,command:function(f,e){var d=a.COMMANDS[f];if(d){return d.call(this,f,e);}else{return this._command(f,e);}},_command:function(g,f){var d=this.getInstance();try{try{d.config.doc.execCommand("styleWithCSS",null,1);}catch(j){try{d.config.doc.execCommand("useCSS",null,0);}catch(i){}}d.config.doc.execCommand(g,null,f);}catch(h){}},getInstance:function(){if(!this._inst){this._inst=this.get("host").getInstance();}return this._inst;},initializer:function(){b.mix(this.get("host"),{execCommand:function(e,d){return this.exec.command(e,d);},_execCommand:function(e,d){return this.exec._command(e,d);}});this.get("host").on("dom:keypress",b.bind(function(d){this._lastKey=d.keyCode;},this));}},{NAME:"execCommand",NS:"exec",ATTRS:{host:{value:false}},COMMANDS:{wrap:function(f,d){var e=this.getInstance();return(new e.Selection()).wrapContent(d);},inserthtml:function(f,d){var e=this.getInstance();if(e.Selection.hasCursor()||b.UA.ie){return(new e.Selection()).insertContent(d);}else{this._command("inserthtml",d);}},insertandfocus:function(h,e){var g=this.getInstance(),d,f;if(g.Selection.hasCursor()){e+=g.Selection.CURSOR;d=this.command("inserthtml",e);f=new g.Selection();f.focusCursor(true,true);}else{this.command("inserthtml",e);}return d;},insertbr:function(j){var i=this.getInstance(),h=new i.Selection(),d="<var>|</var>",e=null,g=(b.UA.webkit)?"span.Apple-style-span,var":"var";if(h._selection.pasteHTML){h._selection.pasteHTML(d);}else{this._command("inserthtml",d);}var f=function(l){var k=i.Node.create("<br>");l.insert(k,"before");return k;};i.all(g).each(function(m){var l=true;if(b.UA.webkit){l=false;if(m.get("innerHTML")==="|"){l=true;}}if(l){e=f(m);if((!e.previous()||!e.previous().test("br"))&&b.UA.gecko){var k=e.cloneNode();e.insert(k,"after");e=k;}m.remove();}});if(b.UA.webkit&&e){f(e);h.selectNode(e);}},insertimage:function(e,d){return this.command("inserthtml",'<img src="'+d+'">');},addclass:function(f,d){var e=this.getInstance();return(new e.Selection()).getSelected().addClass(d);},removeclass:function(f,d){var e=this.getInstance();return(new e.Selection()).getSelected().removeClass(d);},forecolor:function(f,g){var e=this.getInstance(),d=new e.Selection(),h;if(!b.UA.ie){this._command("useCSS",false);}if(e.Selection.hasCursor()){if(d.isCollapsed){if(d.anchorNode&&(d.anchorNode.get("innerHTML")==="&nbsp;")){d.anchorNode.setStyle("color",g);h=d.anchorNode;}else{h=this.command("inserthtml",'<span style="color: '+g+'">'+e.Selection.CURSOR+"</span>");d.focusCursor(true,true);}return h;}else{return this._command(f,g);}}else{this._command(f,g);}},backcolor:function(f,g){var e=this.getInstance(),d=new e.Selection(),h;if(b.UA.gecko||b.UA.opera){f="hilitecolor";}if(!b.UA.ie){this._command("useCSS",false);}if(e.Selection.hasCursor()){if(d.isCollapsed){if(d.anchorNode&&(d.anchorNode.get("innerHTML")==="&nbsp;")){d.anchorNode.setStyle("backgroundColor",g);h=d.anchorNode;}else{h=this.command("inserthtml",'<span style="background-color: '+g+'">'+e.Selection.CURSOR+"</span>");d.focusCursor(true,true);}return h;}else{return this._command(f,g);}}else{this._command(f,g);}},hilitecolor:function(){return a.COMMANDS.backcolor.apply(this,arguments);
},fontname2:function(f,g){this._command("fontname",g);var e=this.getInstance(),d=new e.Selection();if(d.isCollapsed&&(this._lastKey!=32)){if(d.anchorNode.test("font")){d.anchorNode.set("face",g);}}},fontsize2:function(f,h){this._command("fontsize",h);var e=this.getInstance(),d=new e.Selection();if(d.isCollapsed&&d.anchorNode&&(this._lastKey!=32)){if(b.UA.webkit){if(d.anchorNode.getStyle("lineHeight")){d.anchorNode.setStyle("lineHeight","");}}if(d.anchorNode.test("font")){d.anchorNode.set("size",h);}else{if(b.UA.gecko){var g=d.anchorNode.ancestor(e.Selection.DEFAULT_BLOCK_TAG);if(g){g.setStyle("fontSize","");}}}}},insertunorderedlist:function(d){this.command("list","ul");},insertorderedlist:function(d){this.command("list","ol");},list:function(v,z){var f=this.getInstance(),h,u="dir",e="yui3-touched",m,k,l,g,o,q,i,j,x,d,t=(f.host.editorPara?true:false),r=new f.Selection();v="insert"+((z==="ul")?"un":"")+"orderedlist";if(b.UA.ie&&!r.isCollapsed){k=r._selection;h=k.htmlText;l=f.Node.create(h);if(l.test("li")||l.one("li")){this._command(v,null);return;}if(l.test(z)){g=k.item?k.item(0):k.parentElement();o=f.one(g);d=o.all("li");q="<div>";d.each(function(n){if(t){q+="<p>"+n.get("innerHTML")+"</p>";}else{q+=n.get("innerHTML")+"<br>";}});q+="</div>";i=f.Node.create(q);if(o.get("parentNode").test("div")){o=o.get("parentNode");}if(o&&o.hasAttribute(u)){if(t){i.all("p").setAttribute(u,o.getAttribute(u));}else{i.setAttribute(u,o.getAttribute(u));}}if(t){o.replace(i.get("innerHTML"));}else{o.replace(i);}if(k.moveToElementText){k.moveToElementText(i._node);}k.select();}else{j=b.one(k.parentElement());if(!j.test(f.Selection.BLOCKS)){j=j.ancestor(f.Selection.BLOCKS);}if(j){if(j.hasAttribute(u)){m=j.getAttribute(u);}}if(h.indexOf("<br>")>-1){h=h.split(/<br>/i);}else{var y=f.Node.create(h),p=y.all("p");if(p.size()){h=[];p.each(function(s){h.push(s.get("innerHTML"));});}else{h=[h];}}x="<"+z+' id="ie-list">';b.each(h,function(s){var n=f.Node.create(s);if(n.test("p")){if(n.hasAttribute(u)){m=n.getAttribute(u);}s=n.get("innerHTML");}x+="<li>"+s+"</li>";});x+="</"+z+">";k.pasteHTML(x);g=f.config.doc.getElementById("ie-list");g.id="";if(m){g.setAttribute(u,m);}if(k.moveToElementText){k.moveToElementText(g);}k.select();}}else{if(b.UA.ie){j=f.one(r._selection.parentElement());if(j.test("p")){if(j&&j.hasAttribute(u)){m=j.getAttribute(u);}h=b.Selection.getText(j);if(h===""){var w="";if(m){w=' dir="'+m+'"';}x=f.Node.create(b.Lang.sub("<{tag}{dir}><li></li></{tag}>",{tag:z,dir:w}));j.replace(x);r.selectNode(x.one("li"));}else{this._command(v,null);}}else{this._command(v,null);}}else{f.all(z).addClass(e);if(r.anchorNode.test(f.Selection.BLOCKS)){j=r.anchorNode;}else{j=r.anchorNode.ancestor(f.Selection.BLOCKS);}if(!j){j=r.anchorNode.one(f.Selection.BLOCKS);}if(j&&j.hasAttribute(u)){m=j.getAttribute(u);}if(j&&j.test(z)){h=f.Node.create("<div/>");g=j.all("li");g.each(function(n){if(t){h.append("<p>"+n.get("innerHTML")+"</p>");}else{h.append(n.get("innerHTML")+"<br>");}});if(m){if(t){h.all("p").setAttribute(u,m);}else{h.setAttribute(u,m);}}if(t){j.replace(h.get("innerHTML"));}else{j.replace(h);}r.selectNode(h.get("firstChild"));}else{this._command(v,null);}x=f.all(z);if(m){if(x.size()){x.each(function(s){if(!s.hasClass(e)){s.setAttribute(u,m);}});}}x.removeClass(e);}}},justify:function(i,j){if(b.UA.webkit){var h=this.getInstance(),g=new h.Selection(),d=g.anchorNode;var f=d.getStyle("backgroundColor");this._command(j);g=new h.Selection();if(g.anchorNode.test("div")){var e="<span>"+g.anchorNode.get("innerHTML")+"</span>";g.anchorNode.set("innerHTML",e);g.anchorNode.one("span").setStyle("backgroundColor",f);g.selectNode(g.anchorNode.one("span"));}}else{this._command(j);}},justifycenter:function(d){this.command("justify","justifycenter");},justifyleft:function(d){this.command("justify","justifyleft");},justifyright:function(d){this.command("justify","justifyright");},justifyfull:function(d){this.command("justify","justifyfull");}}});var c=function(j,v,r){var k=this.getInstance(),t=k.config.doc,h=t.selection.createRange(),g=t.queryCommandValue(j),l,f,i,e,n,u,q;if(g){l=h.htmlText;f=new RegExp(r,"g");i=l.match(f);if(i){l=l.replace(r+";","").replace(r,"");h.pasteHTML('<var id="yui-ie-bs">');e=t.getElementById("yui-ie-bs");n=t.createElement("div");u=t.createElement(v);n.innerHTML=l;if(e.parentNode!==k.config.doc.body){e=e.parentNode;}q=n.childNodes;e.parentNode.replaceChild(u,e);b.each(q,function(d){u.appendChild(d);});h.collapse();if(h.moveToElementText){h.moveToElementText(u);}h.select();}}this._command(j);};if(b.UA.ie){a.COMMANDS.bold=function(){c.call(this,"bold","b","FONT-WEIGHT: bold");};a.COMMANDS.italic=function(){c.call(this,"italic","i","FONT-STYLE: italic");};a.COMMANDS.underline=function(){c.call(this,"underline","u","TEXT-DECORATION: underline");};}b.namespace("Plugin");b.Plugin.ExecCommand=a;},"@VERSION@",{skinnable:false,requires:["frame"]});YUI.add("editor-tab",function(c){var b=function(){b.superclass.constructor.apply(this,arguments);},a="host";c.extend(b,c.Base,{_onNodeChange:function(f){var d="indent";if(f.changedType==="tab"){if(!f.changedNode.test("li, li *")){f.changedEvent.halt();f.preventDefault();if(f.changedEvent.shiftKey){d="outdent";}this.get(a).execCommand(d,"");}}},initializer:function(){this.get(a).on("nodeChange",c.bind(this._onNodeChange,this));}},{NAME:"editorTab",NS:"tab",ATTRS:{host:{value:false}}});c.namespace("Plugin");c.Plugin.EditorTab=b;},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("createlink-base",function(b){var a={};a.STRINGS={PROMPT:"Please enter the URL for the link to point to:",DEFAULT:"http://"};b.namespace("Plugin");b.Plugin.CreateLinkBase=a;b.mix(b.Plugin.ExecCommand.COMMANDS,{createlink:function(i){var h=this.get("host").getInstance(),e,c,g,f,d=prompt(a.STRINGS.PROMPT,a.STRINGS.DEFAULT);if(d){f=h.config.doc.createElement("div");d=d.replace(/"/g,"").replace(/'/g,"");d=h.config.doc.createTextNode(d);f.appendChild(d);d=f.innerHTML;this.get("host")._execCommand(i,d);
g=new h.Selection();e=g.getSelected();if(!g.isCollapsed&&e.size()){c=e.item(0).one("a");if(c){e.item(0).replace(c);}if(b.UA.gecko){if(c.get("parentNode").test("span")){if(c.get("parentNode").one("br.yui-cursor")){c.get("parentNode").insert(c,"before");}}}}else{this.get("host").execCommand("inserthtml",'<a href="'+d+'">'+d+"</a>");}}return c;}});},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("editor-base",function(d){var c=function(){c.superclass.constructor.apply(this,arguments);},b=":last-child",a="body";d.extend(c,d.Base,{frame:null,initializer:function(){var e=new d.Frame({designMode:true,title:c.STRINGS.title,use:c.USE,dir:this.get("dir"),extracss:this.get("extracss"),linkedcss:this.get("linkedcss"),defaultblock:this.get("defaultblock"),host:this}).plug(d.Plugin.ExecCommand);e.after("ready",d.bind(this._afterFrameReady,this));e.addTarget(this);this.frame=e;this.publish("nodeChange",{emitFacade:true,bubbles:true,defaultFn:this._defNodeChangeFn});},destructor:function(){this.frame.destroy();this.detachAll();},copyStyles:function(h,g){if(h.test("a")){return;}var e=["color","fontSize","fontFamily","backgroundColor","fontStyle"],f={};d.each(e,function(i){f[i]=h.getStyle(i);});if(h.ancestor("b,strong")){f.fontWeight="bold";}if(h.ancestor("u")){if(!f.textDecoration){f.textDecoration="underline";}}g.setStyles(f);},_lastBookmark:null,_resolveChangedNode:function(i){var h=this.getInstance(),f,e,g;if(h&&i&&i.test("html")){f=h.one(a).one(b);while(!g){if(f){e=f.one(b);if(e){f=e;}else{g=true;}}else{g=true;}}if(f){if(f.test("br")){if(f.previous()){f=f.previous();}else{f=f.get("parentNode");}}if(f){i=f;}}}if(!i){i=h.one(a);}return i;},_defNodeChangeFn:function(t){var j=(new Date()).getTime();var q=this.getInstance(),i,u,p=q.Selection.DEFAULT_BLOCK_TAG;if(d.UA.ie){try{i=q.config.doc.selection.createRange();if(i.getBookmark){this._lastBookmark=i.getBookmark();}}catch(g){}}t.changedNode=this._resolveChangedNode(t.changedNode);switch(t.changedType){case"keydown":if(!d.UA.gecko){if(!c.NC_KEYS[t.changedEvent.keyCode]&&!t.changedEvent.shiftKey&&!t.changedEvent.ctrlKey&&(t.changedEvent.keyCode!==13)){}}break;case"tab":if(!t.changedNode.test("li, li *")&&!t.changedEvent.shiftKey){t.changedEvent.frameEvent.preventDefault();if(d.UA.webkit){this.execCommand("inserttext","\t");}else{if(d.UA.gecko){this.frame.exec._command("inserthtml",c.TABKEY);}else{if(d.UA.ie){this.execCommand("inserthtml",c.TABKEY);}}}}break;case"backspace-up":if(d.UA.webkit&&t.changedNode){t.changedNode.set("innerHTML",t.changedNode.get("innerHTML"));}break;}if(d.UA.webkit&&t.commands&&(t.commands.indent||t.commands.outdent)){var v=q.all(".webkit-indent-blockquote");if(v.size()){v.setStyle("margin","");}}var o=this.getDomPath(t.changedNode,false),f={},n,h,l=[],m="",k="";if(t.commands){f=t.commands;}var s=false;d.each(o,function(A){var w=A.tagName.toLowerCase(),B=c.TAG2CMD[w];if(B){f[B]=1;}var z=A.currentStyle||A.style;if((""+z.fontWeight)=="normal"){s=true;}if((""+z.fontWeight)=="bold"){f.bold=1;}if(d.UA.ie){if(z.fontWeight>400){f.bold=1;}}if(z.fontStyle=="italic"){f.italic=1;}if(z.textDecoration=="underline"){f.underline=1;}if(z.textDecoration=="line-through"){f.strikethrough=1;}var C=q.one(A);if(C.getStyle("fontFamily")){var y=C.getStyle("fontFamily").split(",")[0].toLowerCase();if(y){n=y;}if(n){n=n.replace(/'/g,"").replace(/"/g,"");}}h=c.NORMALIZE_FONTSIZE(C);var x=A.className.split(" ");d.each(x,function(D){if(D!==""&&(D.substr(0,4)!=="yui_")){l.push(D);}});m=c.FILTER_RGB(C.getStyle("color"));var e=c.FILTER_RGB(z.backgroundColor);if(e!=="transparent"){if(e!==""){k=e;}}});if(s){delete f.bold;delete f.italic;}t.dompath=q.all(o);t.classNames=l;t.commands=f;if(!t.fontFamily){t.fontFamily=n;}if(!t.fontSize){t.fontSize=h;}if(!t.fontColor){t.fontColor=m;}if(!t.backgroundColor){t.backgroundColor=k;}var r=(new Date()).getTime();},getDomPath:function(g,e){var i=[],f,h=this.frame.getInstance();f=h.Node.getDOMNode(g);while(f!==null){if((f===h.config.doc.documentElement)||(f===h.config.doc)||!f.tagName){f=null;break;}if(!h.DOM.inDoc(f)){f=null;break;}if(f.nodeName&&f.nodeType&&(f.nodeType==1)){i.push(f);}if(f==h.config.doc.body){f=null;break;}f=f.parentNode;}if(i.length===0){i[0]=h.config.doc.body;}if(e){return h.all(i.reverse());}else{return i.reverse();}},_afterFrameReady:function(){var e=this.frame.getInstance();this.frame.on("dom:mouseup",d.bind(this._onFrameMouseUp,this));this.frame.on("dom:mousedown",d.bind(this._onFrameMouseDown,this));this.frame.on("dom:keydown",d.bind(this._onFrameKeyDown,this));if(d.UA.ie){this.frame.on("dom:activate",d.bind(this._onFrameActivate,this));this.frame.on("dom:beforedeactivate",d.bind(this._beforeFrameDeactivate,this));}this.frame.on("dom:keyup",d.bind(this._onFrameKeyUp,this));this.frame.on("dom:keypress",d.bind(this._onFrameKeyPress,this));this.frame.on("dom:paste",d.bind(this._onPaste,this));e.Selection.filter();this.fire("ready");},_beforeFrameDeactivate:function(h){if(h.frameTarget.test("html")){return;}var g=this.getInstance(),f=g.config.doc.selection.createRange();if(f.compareEndPoints&&!f.compareEndPoints("StartToEnd",f)){f.pasteHTML('<var id="yui-ie-cursor">');}},_onFrameActivate:function(i){if(i.frameTarget.test("html")){return;}var h=this.getInstance(),g=new h.Selection(),f=g.createRange(),j=h.all("#yui-ie-cursor");if(j.size()){j.each(function(m){m.set("id","");if(f.moveToElementText){try{f.moveToElementText(m._node);var k=f.move("character",-1);if(k===-1){f.move("character",1);}f.select();f.text="";}catch(l){}}m.remove();});}},_onPaste:function(f){this.fire("nodeChange",{changedNode:f.frameTarget,changedType:"paste",changedEvent:f.frameEvent});},_onFrameMouseUp:function(f){this.fire("nodeChange",{changedNode:f.frameTarget,changedType:"mouseup",changedEvent:f.frameEvent});},_onFrameMouseDown:function(f){this.fire("nodeChange",{changedNode:f.frameTarget,changedType:"mousedown",changedEvent:f.frameEvent});},_currentSelection:null,_currentSelectionTimer:null,_currentSelectionClear:null,_onFrameKeyDown:function(h){var g,f;
if(!this._currentSelection){if(this._currentSelectionTimer){this._currentSelectionTimer.cancel();}this._currentSelectionTimer=d.later(850,this,function(){this._currentSelectionClear=true;});g=this.frame.getInstance();f=new g.Selection(h);this._currentSelection=f;}else{f=this._currentSelection;}g=this.frame.getInstance();f=new g.Selection();this._currentSelection=f;if(f&&f.anchorNode){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:"keydown",changedEvent:h.frameEvent});if(c.NC_KEYS[h.keyCode]){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:c.NC_KEYS[h.keyCode],changedEvent:h.frameEvent});this.fire("nodeChange",{changedNode:f.anchorNode,changedType:c.NC_KEYS[h.keyCode]+"-down",changedEvent:h.frameEvent});}}},_onFrameKeyPress:function(g){var f=this._currentSelection;if(f&&f.anchorNode){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:"keypress",changedEvent:g.frameEvent});if(c.NC_KEYS[g.keyCode]){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:c.NC_KEYS[g.keyCode]+"-press",changedEvent:g.frameEvent});}}},_onFrameKeyUp:function(h){var g=this.frame.getInstance(),f=new g.Selection(h);if(f&&f.anchorNode){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:"keyup",selection:f,changedEvent:h.frameEvent});if(c.NC_KEYS[h.keyCode]){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:c.NC_KEYS[h.keyCode]+"-up",selection:f,changedEvent:h.frameEvent});}}if(this._currentSelectionClear){this._currentSelectionClear=this._currentSelection=null;}},execCommand:function(j,l){var g=this.frame.execCommand(j,l),i=this.frame.getInstance(),h=new i.Selection(),f={},k={changedNode:h.anchorNode,changedType:"execcommand",nodes:g};switch(j){case"forecolor":k.fontColor=l;break;case"backcolor":k.backgroundColor=l;break;case"fontsize":k.fontSize=l;break;case"fontname":k.fontFamily=l;break;}f[j]=1;k.commands=f;this.fire("nodeChange",k);return g;},getInstance:function(){return this.frame.getInstance();},render:function(e){this.frame.set("content",this.get("content"));this.frame.render(e);return this;},focus:function(e){this.frame.focus(e);return this;},show:function(){this.frame.show();return this;},hide:function(){this.frame.hide();return this;},getContent:function(){var e="",f=this.getInstance();if(f&&f.Selection){e=f.Selection.unfilter();}e=e.replace(/ _yuid="([^>]*)"/g,"");return e;}},{NORMALIZE_FONTSIZE:function(g){var e=g.getStyle("fontSize"),f=e;switch(e){case"-webkit-xxx-large":e="48px";break;case"xx-large":e="32px";break;case"x-large":e="24px";break;case"large":e="18px";break;case"medium":e="16px";break;case"small":e="13px";break;case"x-small":e="10px";break;}if(f!==e){g.setStyle("fontSize",e);}return e;},TABKEY:'<span class="tab">&nbsp;&nbsp;&nbsp;&nbsp;</span>',FILTER_RGB:function(h){if(h.toLowerCase().indexOf("rgb")!=-1){var k=new RegExp("(.*?)rgb\\s*?\\(\\s*?([0-9]+).*?,\\s*?([0-9]+).*?,\\s*?([0-9]+).*?\\)(.*?)","gi");var f=h.replace(k,"$1,$2,$3,$4,$5").split(",");if(f.length==5){var j=parseInt(f[1],10).toString(16);var i=parseInt(f[2],10).toString(16);var e=parseInt(f[3],10).toString(16);j=j.length==1?"0"+j:j;i=i.length==1?"0"+i:i;e=e.length==1?"0"+e:e;h="#"+j+i+e;}}return h;},TAG2CMD:{"b":"bold","strong":"bold","i":"italic","em":"italic","u":"underline","sup":"superscript","sub":"subscript","img":"insertimage","a":"createlink","ul":"insertunorderedlist","ol":"insertorderedlist"},NC_KEYS:{8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete"},USE:["substitute","node","selector-css3","selection","stylesheet"],NAME:"editorBase",STRINGS:{title:"Rich Text Editor"},ATTRS:{content:{value:'<br class="yui-cursor">',setter:function(e){if(e.substr(0,1)==="\n"){e=e.substr(1);}if(e===""){e='<br class="yui-cursor">';}if(e===" "){if(d.UA.gecko){e='<br class="yui-cursor">';}}return this.frame.set("content",e);},getter:function(){return this.frame.get("content");}},dir:{writeOnce:true,value:"ltr"},linkedcss:{value:"",setter:function(e){if(this.frame){this.frame.set("linkedcss",e);}return e;}},extracss:{value:false,setter:function(e){if(this.frame){this.frame.set("extracss",e);}return e;}},defaultblock:{value:"p"}}});d.EditorBase=c;},"@VERSION@",{skinnable:false,requires:["base","frame","node","exec-command","selection"]});YUI.add("editor-lists",function(f){var e=function(){e.superclass.constructor.apply(this,arguments);},b="li",c="ol",d="ul",a="host";f.extend(e,f.Base,{_onNodeChange:function(l){var j=this.get(a).getInstance(),g,o,p,h,i,m,n=false,q,k=false;if(l.changedType==="tab"){if(l.changedNode.test(b+", "+b+" *")){l.changedEvent.halt();l.preventDefault();o=l.changedNode;i=l.changedEvent.shiftKey;m=o.ancestor(c+","+d);q=d;if(m.get("tagName").toLowerCase()===c){q=c;}if(!o.test(b)){o=o.ancestor(b);}if(i){if(o.ancestor(b)){o.ancestor(b).insert(o,"after");n=true;k=true;}}else{if(o.previous(b)){h=j.Node.create("<"+q+"></"+q+">");o.previous(b).append(h);h.append(o);n=true;}}}if(n){if(!o.test(b)){o=o.ancestor(b);}o.all(e.REMOVE).remove();if(f.UA.ie){o=o.append(e.NON).one(e.NON_SEL);}(new j.Selection()).selectNode(o,true,k);}}},initializer:function(){this.get(a).on("nodeChange",f.bind(this._onNodeChange,this));}},{NON:'<span class="yui-non">&nbsp;</span>',NON_SEL:"span.yui-non",REMOVE:"br",NAME:"editorLists",NS:"lists",ATTRS:{host:{value:false}}});f.namespace("Plugin");f.Plugin.EditorLists=e;},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("editor-bidi",function(a){var b=function(){b.superclass.constructor.apply(this,arguments);},i="host",h="dir",f="BODY",d="nodeChange",e="bidiContextChange",c=f+" > p",g="style";a.extend(b,a.Base,{lastDirection:null,firstEvent:null,_checkForChange:function(){var k=this.get(i),m=k.getInstance(),l=new m.Selection(),j,n;if(l.isCollapsed){j=b.blockParent(l.focusNode);if(j){n=j.getStyle("direction");if(n!==this.lastDirection){k.fire(e,{changedTo:n});this.lastDirection=n;}}}else{k.fire(e,{changedTo:"select"});this.lastDirection=null;}},_afterNodeChange:function(j){if(this.firstEvent||b.EVENTS[j.changedType]){this._checkForChange();
this.firstEvent=false;}},_afterMouseUp:function(j){this._checkForChange();this.firstEvent=false;},initializer:function(){var j=this.get(i);this.firstEvent=true;j.after(d,a.bind(this._afterNodeChange,this));j.after("dom:mouseup",a.bind(this._afterMouseUp,this));}},{EVENTS:{"backspace-up":true,"pageup-up":true,"pagedown-down":true,"end-up":true,"home-up":true,"left-up":true,"up-up":true,"right-up":true,"down-up":true,"delete-up":true},BLOCKS:a.Selection.BLOCKS,DIV_WRAPPER:"<DIV></DIV>",blockParent:function(l,k){var j=l,n,m;if(!j){j=a.one(f);}if(!j.test(b.BLOCKS)){j=j.ancestor(b.BLOCKS);}if(k&&j.test(f)){n=a.Node.create(b.DIV_WRAPPER);j.get("children").each(function(p,o){if(o===0){m=p;}else{n.append(p);}});m.replace(n);n.prepend(m);j=n;}return j;},_NODE_SELECTED:"bidiSelected",addParents:function(m){var j,l,k;for(j=0;j<m.length;j+=1){m[j].setData(b._NODE_SELECTED,true);}for(j=0;j<m.length;j+=1){l=m[j].get("parentNode");if(!l.test(f)&&!l.getData(b._NODE_SELECTED)){k=true;l.get("children").some(function(n){if(!n.getData(b._NODE_SELECTED)){k=false;return true;}});if(k){m.push(l);l.setData(b._NODE_SELECTED,true);}}}for(j=0;j<m.length;j+=1){m[j].clearData(b._NODE_SELECTED);}return m;},NAME:"editorBidi",NS:"editorBidi",ATTRS:{host:{value:false}},RE_TEXT_ALIGN:/text-align:\s*\w*\s*;/,removeTextAlign:function(j){if(j){if(j.getAttribute(g).match(b.RE_TEXT_ALIGN)){j.setAttribute(g,j.getAttribute(g).replace(b.RE_TEXT_ALIGN,""));}if(j.hasAttribute("align")){j.removeAttribute("align");}}return j;}});a.namespace("Plugin");a.Plugin.EditorBidi=b;a.Plugin.ExecCommand.COMMANDS.bidi=function(m,s){var p=this.getInstance(),k=new p.Selection(),r=this.get(i).get(i).editorBidi,j,n,o,t,l;if(!r){a.error("bidi execCommand is not available without the EditorBiDi plugin.");return;}p.Selection.filterBlocks();if(k.isCollapsed){n=b.blockParent(k.anchorNode);if(!n){n=p.one("body").one(p.Selection.BLOCKS);}n=b.removeTextAlign(n);if(!s){l=n.getAttribute(h);if(!l||l=="ltr"){s="rtl";}else{s="ltr";}}n.setAttribute(h,s);if(a.UA.ie){var q=n.all("br.yui-cursor");if(q.size()===1&&n.get("childNodes").size()==1){q.remove();}}j=n;}else{o=k.getSelected();t=[];o.each(function(u){t.push(b.blockParent(u));});t=p.all(b.addParents(t));t.each(function(v){var u=s;v=b.removeTextAlign(v);if(!u){l=v.getAttribute(h);if(!l||l=="ltr"){u="rtl";}else{u="ltr";}}v.setAttribute(h,u);});j=t;}r._checkForChange();return j;};},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("editor-para",function(a){var d=function(){d.superclass.constructor.apply(this,arguments);},k="host",f="body",c="nodeChange",j="parentNode",b=f+" > p",h="p",g="<br>",i="firstChild",e="li";a.extend(d,a.Base,{_fixFirstPara:function(){var p=this.get(k),r=p.getInstance(),q,s,l=r.config.doc.body,o=l.innerHTML,m=((o.length)?true:false);if(o===g){o="";m=false;}l.innerHTML="<"+h+">"+o+r.Selection.CURSOR+"</"+h+">";s=r.one(b);q=new r.Selection();q.selectNode(s,true,m);},_onNodeChange:function(R){var F=this.get(k),q=F.getInstance(),x,D,C,T,O,H=q.Selection.DEFAULT_BLOCK_TAG,z,o,s,P,v,l,G,M,u,N,V,S,J,B,A,Q=":last-child";switch(R.changedType){case"enter-up":var m=((this._lastPara)?this._lastPara:R.changedNode),U=m.one("br.yui-cursor");if(this._lastPara){delete this._lastPara;}if(U){if(U.previous()||U.next()){if(U.ancestor(h)){U.remove();}}}if(!m.test(H)){var E=m.ancestor(H);if(E){m=E;E=null;}}if(m.test(H)){var I=m.previous(),L,w,y=false;if(I){L=I.one(Q);while(!y){if(L){w=L.one(Q);if(w){L=w;}else{y=true;}}else{y=true;}}if(L){F.copyStyles(L,m);}}}break;case"enter":if(a.UA.ie){if(R.changedNode.test("br")){R.changedNode.remove();}else{if(R.changedNode.test("p, span")){var U=R.changedNode.one("br.yui-cursor");if(U){U.remove();}}}}if(a.UA.webkit){if(R.changedEvent.shiftKey){F.execCommand("insertbr");R.changedEvent.preventDefault();}}if(R.changedNode.test("li")&&!a.UA.ie){x=q.Selection.getText(R.changedNode);if(x===""){C=R.changedNode.ancestor("ol,ul");var K=C.getAttribute("dir");if(K!==""){K=' dir = "'+K+'"';}C=R.changedNode.ancestor(q.Selection.BLOCKS);T=q.Node.create("<p"+K+">"+q.Selection.CURSOR+"</p>");C.insert(T,"after");R.changedNode.remove();R.changedEvent.halt();O=new q.Selection();O.selectNode(T,true,false);}}if(a.UA.gecko&&F.get("defaultblock")!=="p"){C=R.changedNode;if(!C.test(e)&&!C.ancestor(e)){if(!C.test(H)){C=C.ancestor(H);}T=q.Node.create("<"+H+"></"+H+">");C.insert(T,"after");O=new q.Selection();if(O.anchorOffset){z=O.anchorNode.get("textContent");D=q.one(q.config.doc.createTextNode(z.substr(0,O.anchorOffset)));o=q.one(q.config.doc.createTextNode(z.substr(O.anchorOffset)));P=O.anchorNode;P.setContent("");l=P.cloneNode();l.append(o);G=false;u=P;while(!G){u=u.get(j);if(u&&!u.test(H)){M=u.cloneNode();M.set("innerHTML","");M.append(l);s=u.get("childNodes");var r=false;s.each(function(n){if(r){M.append(n);}if(n===P){r=true;}});P=u;l=M;}else{G=true;}}o=l;O.anchorNode.append(D);if(o){T.append(o);}}if(T.get(i)){T=T.get(i);}T.prepend(q.Selection.CURSOR);O.focusCursor(true,true);x=q.Selection.getText(T);if(x!==""){q.Selection.cleanCursor();}R.changedEvent.preventDefault();}}break;case"keyup":if(a.UA.gecko){if(q.config.doc&&q.config.doc.body&&q.config.doc.body.innerHTML.length<20){if(!q.one(b)){this._fixFirstPara();}}}break;case"backspace-up":case"backspace-down":case"delete-up":if(!a.UA.ie){N=q.all(b);S=q.one(f);if(N.item(0)){S=N.item(0);}V=S.one("br");if(V){V.removeAttribute("id");V.removeAttribute("class");}D=q.Selection.getText(S);D=D.replace(/ /g,"").replace(/\n/g,"");B=S.all("img");if(D.length===0&&!B.size()){if(!S.test(h)){this._fixFirstPara();}J=null;if(R.changedNode&&R.changedNode.test(h)){J=R.changedNode;}if(!J&&F._lastPara&&F._lastPara.inDoc()){J=F._lastPara;}if(J&&!J.test(h)){J=J.ancestor(h);}if(J){if(!J.previous()&&J.get(j)&&J.get(j).test(f)){R.changedEvent.frameEvent.halt();}}}if(a.UA.webkit){if(R.changedNode){S=R.changedNode;if(S.test("li")&&(!S.previous()&&!S.next())){x=S.get("innerHTML").replace(g,"");if(x===""){if(S.get(j)){S.get(j).replace(q.Node.create(g));R.changedEvent.frameEvent.halt();
R.preventDefault();q.Selection.filterBlocks();}}}}}}if(a.UA.gecko){T=R.changedNode;A=q.config.doc.createTextNode(" ");T.appendChild(A);T.removeChild(A);}break;}if(a.UA.gecko){if(R.changedNode&&!R.changedNode.test(H)){J=R.changedNode.ancestor(H);if(J){this._lastPara=J;}}}},_afterEditorReady:function(){var m=this.get(k),n=m.getInstance(),l;if(n){n.Selection.filterBlocks();l=n.Selection.DEFAULT_BLOCK_TAG;b=f+" > "+l;h=l;}},_afterContentChange:function(){var l=this.get(k),m=l.getInstance();if(m&&m.Selection){m.Selection.filterBlocks();}},_afterPaste:function(){var l=this.get(k),n=l.getInstance(),m=new n.Selection();a.later(50,l,function(){n.Selection.filterBlocks();});},initializer:function(){var l=this.get(k);if(l.editorBR){a.error("Can not plug EditorPara and EditorBR at the same time.");return;}l.on(c,a.bind(this._onNodeChange,this));l.after("ready",a.bind(this._afterEditorReady,this));l.after("contentChange",a.bind(this._afterContentChange,this));if(a.Env.webkit){l.after("dom:paste",a.bind(this._afterPaste,this));}}},{NAME:"editorPara",NS:"editorPara",ATTRS:{host:{value:false}}});a.namespace("Plugin");a.Plugin.EditorPara=d;},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("editor-br",function(c){var d=function(){d.superclass.constructor.apply(this,arguments);},a="host",b="li";c.extend(d,c.Base,{_onKeyDown:function(j){if(j.stopped){j.halt();return;}if(j.keyCode==13){var g=this.get(a),i=g.getInstance(),h=new i.Selection(),f="";if(h){if(c.UA.ie){if(!h.anchorNode||(!h.anchorNode.test(b)&&!h.anchorNode.ancestor(b))){h._selection.pasteHTML("<br>");h._selection.collapse(false);h._selection.select();j.halt();}}if(c.UA.webkit){if(!h.anchorNode.test(b)&&!h.anchorNode.ancestor(b)){g.frame._execCommand("insertlinebreak",null);j.halt();}}}}},_afterEditorReady:function(){var e=this.get(a).getInstance();try{e.config.doc.execCommand("insertbronreturn",null,true);}catch(f){}if(c.UA.ie||c.UA.webkit){e.on("keydown",c.bind(this._onKeyDown,this),e.config.doc);}},_onNodeChange:function(h){switch(h.changedType){case"backspace-up":case"backspace-down":case"delete-up":var g=this.get(a).getInstance();var i=h.changedNode;var f=g.config.doc.createTextNode(" ");i.appendChild(f);i.removeChild(f);break;}},initializer:function(){var e=this.get(a);if(e.editorPara){c.error("Can not plug EditorBR and EditorPara at the same time.");return;}e.after("ready",c.bind(this._afterEditorReady,this));if(c.UA.gecko){e.on("nodeChange",c.bind(this._onNodeChange,this));}}},{NAME:"editorBR",NS:"editorBR",ATTRS:{host:{value:false}}});c.namespace("Plugin");c.Plugin.EditorBR=d;},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("editor",function(a){},"@VERSION@",{skinnable:false,use:["frame","selection","exec-command","editor-base","editor-para","editor-br","editor-bidi","editor-tab","createlink-base"]});YUI.add("comms-editor-autobidi",function(D){var B=function(){B.superclass.constructor.apply(this,arguments);},A="host",C="text";D.extend(B,D.Base,{autoBidiOff:false,watchForAction:true,redetectDirection:false,disableAutoBidi:false,throttledFindEmptyParas:null,findEmptyParas:function(){var F=this.get(A).getInstance();if(F){var E=F.Selection.DEFAULT_BLOCK_TAG;if(F.all(E).size()==0){E=B.PARAGRAPHS;}F.all(E).each(function(H){var G=H.get(C);if(G===""||G===" "||G==="\u00A0"){H.setData(B.AUTO_BIDI,true);}});}},_onKeyDown:function(E){if(this.watchForAction&&!(E.crtlKey||E.metaKey)){this.throttledFindEmptyParas();this.watchForAction=false;}},autoBidi:function(J){var I,H,G,F,E;if(((J&&J.keyCode&&!B.NODETECT_KEYS[J.keyCode])||(J&&J.type&&J.type==="paste"))&&!this.autoBidiOff&&!this.disableAutoBidi){I=this.get(A).getInstance();E=I.Selection.DEFAULT_BLOCK_TAG;H=new I.Selection();G=H.anchorNode;if(G&&!(G.test(B.PARAGRAPHS))){G=G.ancestor(B.PARAGRAPHS);}if((G&&G.getData(B.AUTO_BIDI))||(G&&this.redetectDirection)){F=D.Intl.detectDirection(G.get(C));if(F){G.setAttribute("dir",F);G.setData(B.AUTO_BIDI,false);this.redetectDirection=false;}}}},_afterNodeChange:function(E){if(E.changedType==="mouseup"||(E.changedType==="keydown"&&(E.changedEvent.crtlKey||E.changedEvent.metaKey))){this.watchForAction=true;this.redetectDirection=true;}if(B.AFFECTING_EVENTS[E.changedType]){this.watchForAction=true;this.disableAutoBidi=false;}else{if(B.REDIRECTING_EVENTS[E.changedType]&&!this.disableAutoBidi){this.redetectDirection=true;}else{if(E.changedType!="keydown"&&E.changedType!="keyup"){D.later(50,this,this.autoBidi,E.changedEvent);}}}},_disableAutoBidi:function(){this.watchForAction=false;this.disableAutoBidi=true;},_turnAutoBidiOff:function(E){this.autoBidiOff=E.status;},initializer:function(){var E=this.get(A);E.after("nodeChange",D.bind(this._afterNodeChange,this));E.frame.on("dom:keydown",D.bind(this._onKeyDown,this));E.on("disableautobidi",D.bind(this._disableAutoBidi,this));E.on("turnautobidioff",D.bind(this._turnAutoBidiOff,this));this.throttledFindEmptyParas=D.throttle(D.bind(this.findEmptyParas,this),150);}},{PARAGRAPHS:"P, DIV, UL, OL",AUTO_BIDI:"autobidi",AFFECTING_EVENTS:{"enter":true,"backspace":true,"delete":true},REDIRECTING_EVENTS:{"home":true,"left":true,"right":true},NODETECT_KEYS:{8:"backspace",9:"tab",13:"enter",16:"shift",18:"alt",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete"},NAME:"editorAutoBidi",NS:"editorAutoBidi",ATTRS:{host:{value:false}}});D.namespace("Plugin");D.Plugin.EditorAutoBidi=B;},"1.0.0",{requires:["editor-base","selection","comms-intl-bidi"]});YUI.add("_shared_module_compose_loading",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_loading={base:'<div id="loadingpane" class="cm-loadingpane"> {{start}} {{slow}} {{error}} {{populate}}</div>',start:"<h2>{{str_comp_loading}}</h2> ",slow:'<h2>{{str_comp_loadslow}} <span class="btn left right small"><a href="#" class="retryOrigin">{{str_comp_loadretry}}</a></span></h2> ',error:'<h2>{{str_comp_loaderr}} <span class="btn left right small"><a href="#" class="retryOrigin">{{str_comp_loadretry}}</a></span></h2> ',populate:"<h2>{{str_comp_loadpopulate}}</h2> "};},"1.0.0");YUI.add("_shared_module_offscreen_bin_compose_menu_list",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose_menu_list={base:'<div id="menu-list" class="optionMenu"> <ul> <li data-action="insertunorderedlist"><a href="#" title="{{str_rte_bullet_list_attr}}"><span>{{str_rte_bullet_list}}</span></a></li> <li data-action="insertnumberedlist"><a href="#" title="{{str_rte_numbered_list_attr}}"><span>{{str_rte_numbered_list}}</span></a></li> </ul></div>'};},"1.0.0");YUI.add("_shared_module_offscreen_bin_compose_menu_text_align",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose_menu_text_align={base:'<div id="menu-text-align" class="optionMenu"> <ul> <li data-action="align-l"><a href="#"><span>{{str_rte_align_l}}</span></a></li> <li data-action="align-c"><a href="#"><span>{{str_rte_align_c}}</span></a></li> <li data-action="align-r"><a href="#"><span>{{str_rte_align_r}}</span></a></li> </ul></div>'};},"1.0.0");YUI.add("mail-ui-fullcompose",function(AP){var Ap=AP.Lang.trim,T=AP.Node.create,R=AP.mail.Controller.Compose,AW=[],AT=AP.common.Utils,V=AT.substitute,AY=AT.escapeHtml,I=AT.unescapeHtml,Aq=AP.ui.Templates,h=Aq._shared_module_compose,Ah=Aq._shared_module_rte_well_tabs_compose,c=Aq._shared_module_rte_well_content_format.page_inoutdent_menu,Am=AP.common.persist.UserData,J=AP.mail.persist.MetaData,AS="hidden",AQ="focus",Ac=500,r="",Ae="neo.pref.compose.wellDisplay",d={none:{well:null,tab:null,isRTE:true},atch:{well:".attachments-pane",tab:".rte .attachments",isRTE:false},emo:{well:".emoticons-pane",tab:".rte .emoticons",isRTE:true},fmt:{well:".format-pane",tab:".rte .rich-text",isRTE:true}},U={"align-l":"justifyleft","align-c":"justifycenter","align-r":"justifyright",inserthrule:"inserthorizontalrule",insertlink:"createlink",setfontstyle:"fontname",setfontsize:"fontsize",insertnumberedlist:"insertorderedlist",color:"notyet",hilitecolor:"notyet"},Av=Aq._shared_module_compose_loading,g=[10,13,16,18,24,32,48],S=[8,10,12,14,18,24,36],Ay=2000,E=7000,AN=AP.EditorBase.NC_KEYS,As="offscreen",AU="restore",Z="move",z=AP.contacts,f=z.api,k=z.utils;var AO=function(Y,A0,A2,A1){var A3=this,Az={};AO.superclass.constructor.apply(A3,arguments);A3.lastACEl=null;A3.header=new AP.mail.compose.HeaderBase(Y,A3);A3.acInputs=null;A3.firstRender=true;A3.tab=null;A3.rtSwitch=null;A3.rtSwitch2=null;A3.rteArea=null;A3.formatButtons=null;A3.fontFamilyOptions=null;A3.fontSizeOptions=null;A3.spellCheckView=null;A3.scView=null;A3.slowOriginReqTimer=null;A3.keepHdrFocus=false;A3.formatShortcutTimer=null;A3.mouseFocusEvent=false;A3.composeViewRendered=false;A3.resizeHandle=null;A3.type="fullCompose";A3.evt=[];Az={bidi:NeoConfig.bidi,fullpage:NeoConfig.fullPage,isRTL:NeoConfig.isRTL,isFullSSL:NeoConfig.isFullSSL,isRich:A3._isRTEActive(),getDefaultFontInfo:R.getDefaultFontInfo,convertToPlain:R.convertToPlain};A3.editor=new AP.mail.RTEView(Az);A3.addChild(A3.editor);A3.wellTabFormatters={page_well_format:function(){return r=="format"?Ah.page_well_format:"";},page_well_emoticons:function(){return r=="emoticons"?Ah.page_well_emoticons:"";},page_well_attachments:function(){return r=="attachments"?Ah.page_well_attachments:"";},page_well_photos:function(){return r=="photos"?Ah.page_well_photos:"";},page_compose_email:function(){return V(Ah.page_compose_email,{},A3.wellTabFormatters,null,strings,Aq);}};A3.loadFormatters={start:function(A5,A4){return(A4=="start")?V(Av.start,null,null,null,strings):"";},slow:function(A5,A4){return(A4=="slow")?V(Av.slow,null,null,null,strings):"";},error:function(A5,A4){return(A4=="err")?V(Av.error,null,null,null,strings):"";},populate:function(A5,A4){return(A4=="pop")?V(Av.populate,null,null,null,strings):"";}};A3.tbFormatters={lastsaved:function(){if(A3.lastSaveType===-1){return V(strings.str_comp_saveasdraftfail,0,0,0,{autosave_time:A3.lastSave});}else{if(A3.lastSave){if(A3.lastSaveType===1){return V(strings.str_comp_autosave,0,0,0,{autosave_time:A3.lastSave});}else{return V(strings.str_comp_saved,0,0,0,{saved_time:A3.lastSave});}}}return"";}};if(NeoConfig.bidi){AP.use("comms-intl-bidihighlight");}A3.evt.push(A3.on("closeChange",A3.handleCloseChange,A3));A3.evt.push(A3.on("activeChange",A3.handleActiveChanged,A3));};function l(){var Az=this,Y;if(Az.isSending){return;}Y=T(V(Aq._shared_module_toolbar_compose.base,{},Az.tbFormatters,0,strings,Aq));Az.author.attachToolbar(new AP.mail.ui.Toolbar({root:Y}));}function AG(A0){var A1=this,Y,Az;if(A0.newVal){A1.updateToolbar();if(A1.composeViewRendered){if(A1.isDraft){Y="draft";}else{Az=(A1.cdo&&A1.cdo.get&&A1.cdo.get("origin"));Y=Az?Az.action:null;}Y=Y||"new";AP.Lang.later(90,null,function(){A1.fire("darlaEvent",{action:"compose_"+Y});});}A1.attView&&A1.attView.reposAttachObj(AU);if(AP.UA.ie){AP.Lang.later(20,null,function(){A1._resizeComposePage();});}}else{A1.header.hideACWidget();if(A1.dirty&&A1.dirty!=="ForceClose"&&NeoConfig.saveOnHideCompose){A1._invokeSaveDraft({auto:true});AT.rocketstats.stat("savemessage","switchingTab");}if(A1.hiliteCP){A1.hiliteCP.hide();}if(A1.textCP){A1.textCP.hide();}A1.attView&&A1.attView.reposAttachObj(As);}if(A0.cbk){A0.cbk();}}function An(){var A1=this,Az=A1.attView,A0=Az&&Az.uploader,Y=A1.cdo;A1.blockSave=true;if(A1.saveTimer){A1.saveTimer.cancel();}A1._clearOriginTimers();if(A1.hiliteCP){A1.hiliteCP.hide();}if(A1.textCP){A1.textCP.hide();}if(A1.resizeHandle){A1.resizeHandle.detach();}if(!AP.Lang.isNull(A1.spellCheckView)&&!AP.Lang.isUndefined(A1.spellCheckView)){A1.spellCheckView.destroy();}delete A1.spellCheckView;if(Az){Az.cleanUp&&Az.cleanUp();delete A1.attView;}if(Y){AP.each(Y.handles,function(A2){A2.detach&&A2.detach();});AP.each(Y.get("attachments"),function(A2){if(A2.timeout){clearTimeout(A2.timeout);A2.timeout=null;}});delete A1.cdo;}A1.fontFamilyOptions&&A1.fontFamilyOptions.remove().destroy(true);A1.fontSizeOptions&&A1.fontSizeOptions.remove().destroy(true);A1.formatButtons&&A1.formatButtons.remove().destroy(true);A1.fontFamilyOptions=null;A1.fontSizeOptions=null;A1.formatButtons=null;if(A1.baseNode){AP.each(A1.evt,function(A2){A2.detach();});delete A1.evt;A1.baseNode.remove().destroy(true);}A1.header=null;A1.formatters=null;A1.author=null;}function F(A3){var A5=this,A2=A3?A3.dataAction:0,Az=(A3&&A3.rawEvent&&A3.rawEvent.shiftKey)?A3.rawEvent.shiftKey:false;switch(A2){case"send":setTimeout(function(){A5._invokeSend(true,{saveBeforeSend:Az});},0);break;case"savedraft":A5.blockSave=true;A5._invokeSaveDraft();break;case"cancelcompose":A5.set("close",1);break;case"insertsignature":var A4=A5.cdo.get("isRichText"),A1,Y,A0=R.getSignature(A5.header.getHeader().from.email);if(A0){A1=A5.assembleSendBody();Y=A1.html;Y=R.injectSignature(Y,A4,A0);A5.cdo.set("content",Y,{textConvert:true});}break;default:break;}}function B(){var A6=this,BC,A3,Y,A8,A1,Az,A4,A2,A5,BB,A0,BA=A6.cdo,A9,A7=A6.evt;A7.push(A6.baseNode.delegate("click",function(BF){var BG=BF.currentTarget.get("className").replace(/emoticon_(\d+)/,A6.formatters.global_path_img()+"/emoticons/emo$1.gif"),BD=BF.currentTarget.getAttribute("title"),BE;
BD=BD.replace(/"/,"&quot;").replace(/</,"&lt").replace(/>/,"&gt;").replace(/&/,"&amp;");BE='<img src="'+BG+'" alt="'+BD+'">';BF.target.blur();A6._invokeRTECommand("insertandfocus",BE);},".emoticons-pane li"));A7.push(A6.baseNode.delegate("keydown",function(BE){var BF,BD;if(BE.keyCode===13){BF=BE.target.get("nodeName");if(BF==="A"){BE.target.blur();BD=A6.baseNode.one("div.attachments-pane #attachment-button-input");BD&&BD.set("tabIndex","0");BE.target.simulate("click");BE.preventDefault();}else{if(AP.UA.ie&&AP.UA.ie<=9&&BF==="INPUT"){BE.preventDefault();}else{if(AP.UA.gecko>1.92&&BF==="INPUT"){BE.target._node&&BE.target._node.click();BE.preventDefault();}}}}},"#attachment-button-input,span.attachment-button-removeall a"));if(NeoConfig.bidi){A6.baseNode.all(".cm-subject-field").plug(AP.Plugin.BidiTextEntry);}if(!BA.handles){BA.handles=[];}A9=BA.handles;A9.push(BA.on("compose:downloadAttachment",function(BE,BD){var BF=function(){AP.use("mail-common-downloader-v"+(NeoConfig.downloaderVersion||"1"),"mail-controller-messages",function(){var BI="Draft",BH=A6.draftMID,BG={success:function(BQ){var BP=[],BM=BA.get("attachments")[BD],BN,BO,BL,BK=BQ.attachments.length,BJ;for(BJ=0;BJ<BK;BJ++){BN=BQ.attachments[BJ];if((!BM.state.cancelled)&&(Ap(BN.filename)==BM.filename)){BO={fid:BI,mid:BQ.mid,pid:BN.partId,filename:BN.filename};BL=BN.tnefId;if(typeof BL!="undefined"){BO.tnefid=BL;}BP.push(BO);break;}}AP.mail.common.downloader.render(BP);},failure:function(BJ){}};if(BH){AP.mail.Controller.Messages.get({fid:BI,msg:{mid:BH}},BG);}});};if(A6.draftMID){BF();}else{A6.downloadHandle=A6.on("compose:saveSuccess",function(){A6.downloadHandle.detach();BF();});A6._invokeSaveDraft();}}));A7.push(AP.on("mousedown",function(){A6.attView&&A6.attView.reposAttachObj(AU);},A6.baseNode.one(".attachment-button-attach")));A7.push(A6.editor.on({keyDown:function(BE){var BD=false;if(BE.ctrlKey||BE.metaKey||BE.altKey||BE.shiftKey){BD=A6.author?A6.author.onKeyDown(BE):A6.onKeyDown(BE);}if(BD){BE.halt();}else{A6._setDirty();}},nodeChange:function(BD){A6._updateRTToolbar(BD);},focus:function(BD){A6._registerFocus(BD.editor);},mousedown:function(BD){A6.header._removeLozengeHighlights();},drop:function(BF){var BD=A6.attView,BE=BD&&BD.uploader;A6._setDirty();if(BE&&BE.uploaderType===AP.mail.UploaderService.UPLOADER_TYPE_HTML5&&BE._ddEventHandler&&A6.author.get("active")){BE._ddEventHandler(BF);}},paste:function(){A6._setDirty();},ready:function(){if(A6.focusNode){A6.setFocus(A6.focusNode);}}}));A9.push(BA.on("compose:restoreFocus",function(){if(A6.focusNode instanceof AP.Node){A6._restoreFocus();}else{A6.setFocus("body",0,1);}},A6));A7.push(AP.on("click",function(BD){BD.halt(false);if(A6.allowEdit){A6._cmdTextSwitch();}},A6.rtSwitch));A7.push(AP.on("click",function(BD){BD.halt(false);if(A6.allowEdit){A6._cmdTextSwitch();}},A6.rtSwitch2));A7.push(AP.on("click",function(BD){BD.halt(false);if(A6.allowEdit){A6.header._cmdBccSwitch(BD.currentTarget.get("parentNode").get("id")=="btn-show-bcc");}A6._restoreFocus();},A6.baseNode.all("span.bcc-btn a")));A7.push(A6.baseNode.delegate("click",function(){A6._clearOriginTimers();A6._displayLoading();R.fetchOrigin(BA,A6.isDraft);},"a.retryOrigin"));A6.once("renderComplete",function(){A6.contentLoaded=true;AP.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base",function(BD){});});if(NeoConfig.fullPage||(AP.UA.ie&&AP.UA.ie>=8)){A6.resizeHandle=AP.on((AP.UA.ie&&AP.UA.ie<8)?"resize":"windowresize",function(){A6._resizeComposePage();});}if(NeoConfig.intl!=="jp"){A6._addFocusListeners();}A7.push(A6.baseNode.delegate("keydown",function(BE){var BD;if(BE.keyCode===13){BE.halt();A6.focusNode=BE.target;BD=BE.target.one("b");BD&&BD.simulate("click");}},"div.rte-well-container a"));A0=A6.baseNode.one("#attachment-button-input");if(A0){A7.push(A0.on({focus:function(BD){A0.ancestor("span").addClass("focused");},blur:function(BD){A0.ancestor("span").removeClass("focused");},click:function(BD){if(A6.attView.uploader&&A6.attView.uploader.uploaderType===AP.mail.UploaderService.UPLOADER_TYPE_YUI&&!A6.attView.formUploader){A6.attView.switchToFormUploader({skipDefault:true});}}}));}}function Ar(){var A4=this,A2,A6,BB,Az=["bold","italic","underline"],A0,BC,A3,A8,BA,A5,A9,Y,A1,A7=A4.evt;A4.baseNode.all("div.gwell").addClass(AS);A4.baseNode.one("div.attachments-well").addClass(AS);Y=A4.baseNode.one("div.rte");if((A1=Y.one("li.active"))){A1.removeClass("active");A1.one("a").removeAttribute("aria-selected");}A0=Y.one("b.emoticons");A8=function(BD){if(A4.baseNode.one("div.emoticons-pane").hasClass(AS)&&(A4.baseNode.one("div.rich-text-switch-pane").hasClass("hidden")||!Y.one("b.emoticons").get("parentNode").get("parentNode").hasClass("active"))){A4._switchWell("emo",BD);}else{A4._closeWell(BD);}BD.preventDefault();};A7.push(A0.on("click",A8));BC=Y.one("b.rich-text");A9=A4.baseNode.one("div.format-pane");BA=function(BD){if(A9.hasClass(AS)&&(A4.baseNode.one("div.rich-text-switch-pane").hasClass(AS)||!Y.one("b.rich-text").get("parentNode").get("parentNode").hasClass("active"))){A4._switchWell("fmt",BD);}else{A4._closeWell(BD);}BD.preventDefault();};A7.push(BC.on("click",BA));A3=Y.one("b.attachments");A5=function(BD){if(A4.attView.attachPaneHidden){A4._switchWell("atch",BD);}else{A4._closeWell(BD);}BD.preventDefault();};A7.push(A3.on("click",A5));A6=A9.all("select");A7.push(AP.on("change",function(BD){A4._invokeAction(BD.currentTarget.get("parentNode"),BD.currentTarget.get("value"));},A6));formatButtons=A9.all(".btn");A7.push(AP.on("click",function(BD){BD.preventDefault();A4._invokeAction(BD.currentTarget,"");},formatButtons));formatButtons.each(function(BE){var BF,BD=Az.length,BG=BE.getAttribute("data-action");if(BG){for(BF=0;BF<BD;BF++){if(Az[BF]==BG){BE.addClass("btnpress");}}}});BB=A4.baseNode.all("div.rte-pane span.close");A7.push(AP.on("click",function(BD){A4._closeWell(BD);A4._restoreFocus();},BB));A4._intlBindUIRTE();}function AK(A1){var A4=this,A0,A2;if(A1){A4.parent=A1;A0=V(h.base,A4.cdo,A4.formatters,null,strings,Aq);
A1.append(A0);A4.baseNode=A1.one(".compose.content");A4.attView=new AP.mail.AttachmentView(A4.cdo,A4.parent);A4.compArea=A4.baseNode.one("div.compose-message").one("div.inner");A4.rtSwitch=A4.baseNode.one("b.plaintext");A4.rtSwitch2=A4.baseNode.one("div.rich-text-switch-pane").one("a");A4.rteArea=A4.compArea.one("div.cm-rtetext");A4.loadingArea=A4.compArea.one("div.cm-loadingpane");fo=R.getDefaultFontInfo(!A4._isRTEActive());A4.richFontInfo.fontFamily=fo.fontFamily;A4.richFontInfo.fontSize=fo.fontSize;A2=A4.baseNode.one("div.cm-plaintext");if(A2){A2.get("parentNode").removeChild(A2);}if(AP.UA.gecko&&!NeoConfig.fullPage){A4.compArea.ancestor("td").setStyle("height","0");}A4._switchEditMode(A4._isRTEActive());A4.header.enableHeader(false);A4.baseNode.all("div.gwell").addClass(AS);if(NeoConfig.low_bandwidth){var Y=A4.baseNode.all(".rte li"),A3=Y.size(),Az;Y.item(0).addClass("end-grp");for(Az=1;Az<A3;Az++){Y.item(Az).addClass(AS);}}A4.bindUI();A4.header.render();A4.composeViewRendered=true;}}function Ad(){var A1=this,Az=A1.evt;function Y(A3){var A6=A3.params,A5={attachments:1,format:1};if(!A5.hasOwnProperty(A6.tab)){return;}if(!A1.baseNode){return;}A6.tooltip=A6.tooltip||"";var A2=["<span class='btn left right menu' data-app='",A3.appInstance,"'>","<a href='#' title='",A6.tooltip,"'>",A6.label,"</a>","</span>"].join(""),A4=T(A2);A1.baseNode.one("."+A6.tab+"-pane").one(".om-buttons").append(A4);Az.push(A4.on("click",function(A7){A7.preventDefault();A3.handler(AP.stamp(A4),A1);}));}function A0(A2){if(!A1.baseNode){return;}A1.baseNode.all('.om-buttons > span[data-app="'+A2+'"]').remove().destroy(true);}AP.each(AW,Y);Az.push(AP.on("om:compose_add_btn",function(){Y(AW[AW.length-1]);}));Az.push(AP.on("om:compose_remove_btns",A0));}function Af(){var A4=this,A6,A2,Az,A1,BA,A7,Y,A0,A5,A8=A4.cdo,A9;A4.editor.render(A4.baseNode);A4._bindWellUI();A9=A4.baseNode.one("div.format-pane");A4.formatButtons=A9.all(".btn");A4.fontFamilyOptions=A9.all("span.showFontStyle select option");A4.fontSizeOptions=A9.all("span.showFontSize select option");A4._bindCDO();if(A4._isOrigin()){A4.slowOriginReqTimer=setTimeout(function(){A4._handleSlowOriginRequest();},E);A4.loadingTimer=setTimeout(function(){A4._displayLoading();},Ay);if(AP.UA.ie){A4.rteArea.setStyle("display","none");}if(A4.cdo&&A4.cdo.get("passive")){text=A4.cdo.get("content");A4.contentChangeAfter(text);A4.replyheaderChangeAfter();A4.replyContentChangeAfter(text);if(A4.cdo.get("attachments")){var A3=A8.oComposeData.attachments.length;for(i=0;i<A3;i++){A4.attView.addNewAttachment(i);}}}else{R.fetchOrigin(A8,A4.isDraft,A4.stopwatch,function(){if(A4.isDraft&&A8&&A8.oComposeData&&A8.oComposeData.origin&&A8.oComposeData.origin.oMsg){A4.draftMID=A8.oComposeData.origin.oMsg.mid;}});}if(A4.isDraft){AP.Lang.later(90,null,function(){A4.fire("darlaEvent",{action:"compose_draft"});});A4.hasHardDraft=true;A4.draftMID=A8.oComposeData.origin.oMsg.mid;}else{A5=A8.get("origin");AP.Lang.later(90,null,function(){A4.fire("darlaEvent",{action:"compose_"+A5.action});});}Az=A8.oComposeData.origin.oMsg;A1=Az&&Az.header&&Az.header.to;BA=A4.baseNode.all("#from-field option");AP.Array.some(A1||[],function(BB){BA.each(function(BD,BC){var BE=BD.get("value").replace(/.+\<(.+)\>/,"$1");if(BB.email==BE){AP.later(100,A4,function(){BD.get("parentNode").set("selectedIndex",BC);});return true;}});});if(Az.header.from&&A4.isDraft){AP.later(10,A4,function(){A4.header._setFromMenu(Az.header.from);});}}else{A6=A8.get("header");A4.header.setHeader(A6);A4._allowEditing(A8.get("content"));A4.dirty=A8.get("prePopulated");A4.setFocus((A6.to&&A6.to.length>0)?"body":"to");A4.fire("darlaEvent",{action:"compose_new"});}if(NeoConfig.fullPage){A4._resizeComposePage();}else{if(A4.editor.get("ready")){A4.editor.resize(true);}}if(A8.get("passive")){A4.dirty=1;}Y=A4.richFontInfo.fontFamily;A0=A4.richFontInfo.fontSize;A4.fontFamilyOptions.each(function(BB){var BC=BB.get("value");if(BC===Y){BB.set("selected",true);}});if(A0){A7=parseInt(A0.replace("pt",""));A7=AP.Array.indexOf(S,A7);if(A7>=0){A4.fontSizeOptions.item(A7).set("selected",true);}}A4._initOpenMailButtons();}function Al(){var A4=this,A1,Y,A3,A2,A0=A4.baseNode.one("div.emoticons-pane ul"),Az=A4.evt;A0.plug(AP.comms.ui.NodeFocusBase,{descendants:"li",keys:{next:"39",previous:"37"}});Az.push(A0.delegate("keydown",function(A5){if(A5.keyCode===9&&!A5.shiftKey){A2=A4.baseNode.one(".attachments-well");if(A2&&!A2.hasClass(AS)){A1=A2.one('li.attachmentVisible span.left a[tabIndex="0"]');if(!A1){A1=A2.one("li.attachmentVisible span.left a");A1&&A1.set("tabIndex","0");}}else{A5.target.blur();A4.setFocus("body");A5.halt();}}else{if(AP.UA.gecko&&A5.keyCode===9){A1=AP.one('.rte li a[tabIndex="0"]');A1&&A4.setFocus(A1);A5.halt();}else{if(A5.keyCode===13||A5.keyCode===32){A5.target.simulate("click");A5.halt();}}}},"li"));A0=A4.baseNode.one("div.attachments-pane");A0.plug(AP.comms.ui.NodeFocusBase,{descendants:"input[type=file],span.attachment-button-removeall a",keys:{next:"39",previous:"37"}});Az.push(A0.delegate("keydown",function(A5){A1=null;if(A5.keyCode===9){if(!A5.shiftKey){A2=A4.baseNode.one(".attachments-well");if(A2&&!A2.hasClass(AS)){A1=A2.one('li.attachmentVisible span.left a[tabIndex="0"]');if(!A1){A1=A2.one("li.attachmentVisible span.left a");A1&&A1.set("tabIndex","0");}}else{A5.target.blur();A4.setFocus("body");A5.halt();}}else{A4.baseNode.all("div.rte li a").each(function(A6){if(A6.get("tabIndex")=="0"&&!A1){A1=A6;}});if(!A1){A1=A4.baseNode.one("div.rte li a");}A1.focus();A5.halt();}}},"span"));A0=A4.baseNode.one("div.rte-well-container div.rte");A0.plug(AP.comms.ui.NodeFocusBase,{descendants:"a[role=tab]",keys:{next:"39",previous:"37"}});Az.push(A0.delegate("keydown",function(A6){if(A6.keyCode===9&&!A6.shiftKey){var A5=A4.baseNode.one("div.rte-well-container .rte li.active a");if(!A5||(AP.UA.ie&&AP.UA.ie<8&&A5.get("target")=="attachments")){A2=A4.baseNode.one(".attachments-well");if(A2&&!A2.hasClass(AS)){A1=A2.one('li.attachmentVisible span.left a[tabIndex="0"]');
if(!A1){A1=A2.one("li.attachmentVisible span.left a");A1&&A1.set("tabIndex","0");}}else{A6.target.blur();A4.setFocus("body");A6.halt();}}}},"a"));A0=A4.baseNode.one(".attachments-well");Az.push(A0.delegate("keydown",function(A5){A3=null;Y=null;A1=null;switch(A5.keyCode){case 8:case 46:A5.target.blur();A5.target.set("tabIndex","-1");Y=A5.target.ancestor("li");A1=Y.previous(".attachmentVisible")||Y.next(".attachmentVisible");if(A1){A1=A1.one("span.left a");if(A1){A1.set("tabIndex","0");A4.setFocus(A1);}}else{A4.setFocus("body",0,1);}Y.one(".lozengeremove a").simulate("click");break;case 9:if(!A5.shiftKey){A5.target.blur();A4.setFocus("body");A5.halt();}break;case 37:case 38:A3="previous";case 39:case 40:A3=(A3?A3:"next");Y=A5.target.ancestor("li")[A3](".attachmentVisible");if(Y){A1=Y.one("span.left a");if(A1){A5.target.set("tabIndex","-1");A1.set("tabIndex","0");A4.setFocus(A1);}}break;}},"a"));A0=A4.baseNode.one(".rich-text-switch-pane");Az.push(A0.delegate("keydown",function(A5){if(A5.keyCode===9&&!A5.shiftKey){A2=A4.baseNode.one(".attachments-well");if(A2&&!A2.hasClass(AS)){A1=A2.one('li.attachmentVisible span.left a[tabIndex="0"]');if(!A1){A1=A2.one("li.attachmentVisible span.left a");A1&&A1.set("tabIndex","0");}}else{A5.target.blur();A4.setFocus("body");A5.halt();}}else{if(A5.keyCode===13||A5.keyCode==32){if(A5.keyCode===32){A5.target.simulate("click");}A5.preventDefault();A5.target.blur();A4.setFocus("body");}}},"a"));A0=A4.baseNode.one("div.format-pane div.format-inner");Az.push(A0.on("keydown",function(A8){var A7=A8.target,BA=A7.get("nodeName"),A5=A7.ancestor("span"),A6;if(!A5||(BA!="A"&&BA!="SELECT")){return;}switch(A8.keyCode){case 9:if(A5.hasClass("showFontSize")&&!A8.shiftKey){var A9=A4.baseNode.one('.format-pane .format-inner a[tabIndex="0"]');if(A9){A9.focus();}else{A4.baseNode.one(".format-pane .format-inner a").focus();}A8.halt();}else{if(A5.hasClass("showFontStyle")&&A8.shiftKey){var A9=A4.baseNode.one('.rte li a[tabIndex="0"]');if(A9){A9.focus();}else{A4.baseNode.one(".rte li a").focus();}A8.halt();}else{if(BA=="A"&&!A8.shiftKey){A2=A4.baseNode.one(".attachments-well");if(A2&&!A2.hasClass(AS)){A1=A2.one('li.attachmentVisible span.left a[tabIndex="0"]');if(!A1){A1=A2.one("li.attachmentVisible span.left a");A1&&A1.set("tabIndex","0");}}else{A8.target.blur();A4.setFocus("body");A8.halt();}}}}break;case 13:case 32:if(BA=="A"){A7.simulate("click");}break;case 37:case 39:if(BA!="A"){return;}if(A8.keyCode===37){if(A5.one("a")&&A5.one("a").hasClass("bold")){return;}A6=A5.previous("span");}else{if(A8.keyCode===39){if(A5.get("id")==="btn-spell-langs"){return;}A6=A5.next("span");}}if(A6){A6=A6.one("a");if(A6){A7.set("tabIndex","-1");A6.set("tabIndex","0");A6.focus();}}break;default:}}));}function j(A7){var A5=this,BD=A7.keyCode,A9,BB=(A7.ctrlKey||A7.metaKey)&&(!A7.altKey&&!A7.shiftKey),A2=AP.UA.os,Y=(A7.ctrlKey&&(A2=="windows"||A2=="win"))||(A7.metaKey&&(A2=="macintosh"||A2=="mac")),A1=Y&&BB,A6=null,A0,A4=false;switch(BD){case 85:if((Y&&A7.shiftKey)&&!AP.UA.ie&&(!AP.UA.gecko||AP.UA.gecko>1.92)&&(A0=A5.baseNode.one("#attachment-button-input"))){if(!A5.baseNode.one("ul[role=tablist] li").hasClass("active")){A5._switchWell("atch",A7);}A0._node.click();A7.halt();}break;case 13:if(Y&&!A7.altKey){A4=(A7.shiftKey?true:false);A9=A5.baseNode.one(".ac-input.focus input");if(A9){A9.blur();}A5._invokeSend(false,{saveBeforeSend:A4});if(A7.frameEvent){A7.frameEvent.halt();}A7.halt();return true;}else{if(A7.target.get("nodeName")=="A"){A7.target.simulate("click");return true;}}break;case 83:if(BB){A5._invokeSaveDraft();if(A7.frameEvent){A7.frameEvent.halt();}A7.halt();return true;}break;case 89:if((A7.ctrlKey||A7.metaKey)&&A7.shiftKey){A7.halt();if(A5.allowEdit){A5._cmdTextSwitch();}return true;}break;case 219:case 221:AP.fire("tabview:handleKeyDown",A7);break;default:break;}if(A7.frameEvent){if(BB||(NeoConfig.bidi&&A7.ctrlKey)){switch(BD){case 66:A6="bold";break;case 73:A6="italic";break;case 85:A6="underline";break;case 16:if(NeoConfig.bidi){A6="bidi";}break;case 86:A5._setDirty();break;default:break;}if(A6){if(A5._isRTEActive()){A6=A5.baseNode.one(".format-pane .btn[data-action="+A6+"]");clearTimeout(A5.formatShortcutTimer);A5.formatShortcutTimer=setTimeout(function(){A5._invokeAction(A6,"",true);},100);}A7.frameEvent.halt();return true;}}else{if(A7.shiftKey){if(BD==9){var BC=A5.baseNode.one("div.rte-well-container"),A8=BC.one("li.active b"),BA,A3=BC.one(".rich-text-switch-pane"),Az=BC.one(".attachments-well"),BE;if(Az&&!Az.hasClass(AS)){Az.all("li.attachmentVisible span.left a").each(function(BF){if(!BA&&BF.get("tabIndex")=="0"){BA=BF;}});if(!BA){BA=Az.one("li.attachmentVisible span.left a");BA.set("tabIndex","0");}}else{if(!A8){A5.baseNode.all("div.rte li a").each(function(BF){if(!BA&&BF.get("tabIndex")=="0"){BA=BF;}});if(!BA){BA=BC.one("li a");}}else{if(A3&&!A3.hasClass(AS)){BA=A3.one("a");}else{if(A8.hasClass("attachments")){BE=function(){A5.baseNode.all("#attachment-button-input, .attachments-pane span.attachment-button-removeall a").each(function(BF){if(!BA&&BF.get("tabIndex")=="0"){BA=BF;}});if(!BA){BA=A5.baseNode.one("#attachment-button-input");}if(AP.UA.ie&&AP.UA.ie<8){BA&&AP.later(0,BA,function(){A5.setFocus(BA);BA.simulate("keydown",{keyCode:9});});BA=null;}};if(A5.attView.uploader.uploaderType===AP.mail.UploaderService.UPLOADER_TYPE_YUI&&!A5.attView.formUploader){BE();A5.attView.switchToFormUploader({skipDefault:true});}else{BE();}}else{if(A8.hasClass("emoticons")){A5.baseNode.all("div.emoticons-pane li").each(function(BF){if(BF.get("tabIndex")=="0"){BA=BF;}});if(!BA){BA=A5.baseNode.one("div.emoticons-pane li");}}else{if(A8.hasClass("rich-text")){BA=A5.baseNode.one("div.format-pane .showFontStyle select");}}}}}}BA&&A5.setFocus(BA);A7.frameEvent.halt();return true;}}}}if(BB){return true;}return false;}function q(Az){var Y=AP.Node.getDOMNode(Az);if(Y!=null){return(Y.tagName.toUpperCase()=="DIV");}return false;}function AM(){var A0=this,Y=A0.cdo,Az;if(!Y.handles){Y.handles=[];}Az=Y.handles;
Az.push(Y.after("contentChange",function(A1){A0.contentChangeAfter(A1);}));Az.push(Y.after("isRichTextChange",function(A1){A0.editor.set("isRich",!NeoConfig.low_bandwidth&&A1.newVal);A0._switchEditMode(A1.newVal);}));Az.push(Y.after("replyheaderChange",function(){A0.replyheaderChangeAfter();}));Az.push(Y.after("replycontentChange",function(A1){A0.replyContentChangeAfter(A1);}));Az.push(Y.after("originerrorChange",function(A2){A0._clearOriginTimers();var A1=A2.newVal;if(A1.code!=AP.common.net.Error.abort){A0._writeLoadingHtml("err");}}));Az.push(Y.on("CDO_ATTACHMENT_ADDED",function(A3,A2,A1){A0._setDirty();if(!A1){A0.attachmentsLoading[A2]=1;}A0.editor.resize();}));Az.push(Y.on("CDO_ATTACHMENT_DELETED",function(A2,A1){A0._setDirty();A0.editor.resize();A0.attachmentsLoading[A1]=0;if(AP.UA.os=="macintosh"&&AP.UA.chrome>=11){A0.setFocus("body",0,1);}else{A0._restoreFocus();}}));Az.push(Y.on("CDO_ATTACHMENT_PROCESSED",function(A2,A1){A0._setDirty();A0.attachmentsLoading[A1]=0;}));Az.push(Y.on("CDO_ATTACHMENT_FILES_SELECTED",function(A2){var A1=A0.baseNode.one("#attachment-button-input");if(A1){A1.blur();}if(AP.UA.os=="macintosh"&&AP.UA.chrome>=11){A0.setFocus("body",0,1);}else{A0._restoreFocus();}}));}function AL(Y){var Az=this;if(!Y.uiUpdate){Y.newVal?Az.editor.setContent(Y.newVal,!Y.textConvert||AP.UA.gecko):Az.editor.setContent(Az.cdo.get("content"));}}function Au(){var Az=this,Y;Az.header.setHeader(Az.cdo.get("header"));Y=Az.cdo.get("header").subject;Az.author.updateTabTitle(AY(I(Y)));if(NeoConfig.bidi){Az.author.updateTabDirection(AP.Intl.detectDirection(Y));}}function u(Y){var A0=this;A0._allowEditing(Y.newVal);A0.header.enableSwitchReplyButton();A0.dirty=false;var Az=A0.cdo.get("header");A0.setFocus((Az.to&&Az.to.length>0)?"body":"to");}function G(Y){var A0=this,Az;A0.rtSwitch.setContent(strings[Y?"str_rte_plaintext":"str_rte_richtext"]);A0._toggleRTEWellMode(Y);}function Ak(){var A2=this,Y={content:A2.getContent()},A0,A1;A2.cdo.updateData(Y);if(A2._isRTEActive()){function Az(){A2._setDirty();R.toPlainText(A2.cdo,A2.editor.get("content"));A2.setFocus("body");}if(A2.editor.hasContent()){A1=true;A2.confirm(null,strings.str_comp_conf_plainText,Az);}else{Az();}}else{A2._setDirty();R.toRichText(A2.cdo);}!A1&&A2._restoreFocus();}function At(){return !NeoConfig.low_bandwidth&&this.cdo.get("isRichText");}function Aw(){return(this.spellCheckView&&this._isRTEActive());}function Q(Y){return this.baseNode.one(".cm-"+Y+" ul li");}function A(){return this.editor.getContent();}function AF(){return this.editor.getRTE();}function Ag(A2,A1,Y){var A4=this,A0=true,A3,Az=A4.editor.getRTE();if((typeof A2=="string")){A3=A4.baseNode.one(".compose-header");switch(A2){case"to":case"cc":case"bcc":case"subject":A3=A4.baseNode.one(".compose-header");A2=A3.one(".cm-"+A2+"-field");break;case"body":A2=Az;A0=(Y&&AP.UA.os=="macintosh"&&AP.UA.chrome>=11)?0:A4.editor.get("ready");break;}}if(A0){if(A2==Az){A4.editor.setFocus(A1);}else{A2&&A2.focus();}}A2&&A4._registerFocus(A2);}function AX(Az){var A0=this,Y;A0._clearOriginTimers();A0.header.enableHeader(true);if(AP.UA.ie){A0.rteArea.setStyle("display","block");}A0.rteArea.setStyle("visibility","");A0.loadingArea.addClass(AS);Y=J.get(Ae);if(AP.Lang.isUndefined(Y)||(typeof Y!="string")||AP.Lang.isUndefined(d[Y])){Y="fmt";J.set(Ae,Y);}if(NeoConfig.low_bandwidth){Y="none";}if(Y!="none"){A0._switchWellGuts(Y);}if(Az){A0.editor.setContent(Az,!A0.isDraft);}A0.header.allowEditing(Az);A0._adjustLowRes();A0.allowEdit=true;A0.fire("renderComplete");}function m(){var Y=this;if(!NeoConfig.fullPage&&screen.height<=600){if(Y.compArea.ancestor("TR").getY()>Y.baseNode.get("winHeight")-30){Y._closeWellGuts();}}}function n(Y,A0){var A2=this,Az=null,A1=A0;switch(Y){case"fontname":Az="userUIPref.composeFontFamily";break;case"fontsize":A2.fontSizeOptions.each(function(A3){if(A1==A3.get("value")){A0=A3.get("text");Az="userUIPref.composeFontSize";}});break;default:break;}if(Az&&A0){R.savePref(Az,A0);}}function a(Y,A1){var A2=this,A0,Az;if(A0=U[Y]){Y=A0;}if(Y=="notyet"){alert("not yet");}else{if(Y=="forecolor"){if(!A2._formatPane){A2._formatPane=A2.baseNode.one(".format-pane");}Az=A2._formatPane.one("#btn-forecolor i");Az.setStyle("backgroundColor",A1);}A2._setComposePreference(Y,A1);A2._invokeRTECommand(Y,A1);}}function AE(Y,Az){var A0=this;A0._setDirty();A0.setFocus("body",function(){A0.editor.execute(Y,Az);});}function AA(){var A1=this,A0,Az,Y=A1.evt;if(!A1._formatPane){A1._formatPane=A1.baseNode.one(".format-pane");}A0=A1._formatPane.one(".btn[data-action="+"spellcheck"+"]");Az=A0.next();Y.push(A0.on("click",function(A2){A1._doSpellCheck();A2.preventDefault();}));Y.push(Az.on("click",function(A2){A1._openSpellCheckMenu(A2);A2.preventDefault();}));}function Ao(Az,A0,A2){var A1=this,Y;AP.use("editor-lists","createlink-base",function(A3){A1.editor.plug(A3.Plugin.EditorLists);Y=Az.getAttribute("data-action");if(Y&&(Y==="color"||Y==="hilitecolor")){}else{if(Y&&Y!="menu"){if((Y=="bold")||(Y=="italic")||(Y=="underline")){Az.toggleClass("pressed");}else{if(Y&&Y==="insertlink"){A3.Plugin.CreateLinkBase.STRINGS.PROMPT=strings.str_comp_createlink_prompt;A3.Plugin.CreateLinkBase.STRINGS.DEFAULT=strings.str_comp_createlink_default;}else{if(Y&&Y==="bidi"){if(!A2){A0=Az.getAttribute("value");}}}}A1._invokeDataAction(Y,A0);}else{if(Az.hasClass("menu")){A1._showMenus(Az);}}}});}function AJ(Y){var A4=this,A2,A7,A0,Az,A6,A5,A3,A8,A9,A1=false;if(Y.menu){return;}A7=Y.get("id");AP.use("common-ui-menu-helper","menus_css",function(){switch(A7){case"btn-indent":A2=c;break;case"btn-text-align":A2=Aq._shared_module_offscreen_bin_compose_menu_text_align.base;break;case"btn-list":A2=Aq._shared_module_offscreen_bin_compose_menu_list.base;break;case"btn-forecolor":case"btn-backcolor":A6=[["000000","111111","2d2d2d","434343","5b5b5b","737373","8b8b8b","a2a2a2","b9b9b9","d0d0d0","e6e6e6","ffffff"],["7f7f00","bfbf00","ffff00","ffff40","ffff80","ffffbf","525330","898a49","aea945","c3be71","e0dcaa","fcfae1"],["407f00","60bf00","80ff00","a0ff40","c0ff80","dfffbf","3b5738","668f5a","7f9757","8a9b55","b7c296","e6ebd5"],["007f40","00bf60","00ff80","40ffa0","80ffc0","bfffdf","033d21","438059","7fa37c","8dae94","acc6b5","ddebe2"],["007f7f","00bfbf","00ffff","40ffff","80ffff","bfffff","033d3d","347d7e","609a9f","96bdc4","b5d1d7","e2f1f4"],["00407f","0060bf","0080ff","40a0ff","80c0ff","bfdfff","1b2c48","385376","57708f","7792ac","a8bed1","deebf6"],["00007f","0000bf","0000ff","4040ff","8080ff","bfbfff","212143","373e68","444f75","585e82","8687a4","d2d1e1"],["40007f","6000bf","8000ff","a040ff","c080ff","dfbfff","302449","54466f","655a7f","726284","9e8fa9","dcd1df"],["7f007f","bf00bf","ff00ff","ff40ff","ff80ff","ffbfff","4a234a","794a72","936386","9d7292","c0a0b6","ecdae5"],["7f003f","bf005f","ff007f","ff409f","ff80bf","ffbfdf","451528","823857","a94a76","bc6f95","d8a5bb","f7dde9"],["800000","c00000","ff0000","ff4040","ff8080","ffc0c0","441415","82393c","aa4d4e","bc6e6e","d8a3a4","f8dddd"],["7f3f00","bf5f00","ff7f00","ff9f40","ffbf80","ffdfbf","482c1b","855a40","b27c51","c49b71","e1c4a8","fdeee0"]];
A5=A6[0].length;A3=A6.length;A2=["<div id='menu-color-picker' class='optionMenu colorPickerMenu'>"];Az=(A7=="btn-forecolor")?"forecolor":"backcolor";for(A8=0;A8<A3;A8++){A2.push("<ul>");for(A9=0;A9<A5;A9++){A2.push("<li style='background-color:#",A6[A8][A9],";' data-action='",Az,"' data-value='#",A6[A8][A9],"'><a href='#'></a></li>");}A2.push("</ul>");}A2.push("</div>");A2=A2.join("");break;default:break;}if(A2){A0=A4._showRTEMenu(V(A2,null,null,null,strings),Y,function(BA){A4.evt.push(BA.on("menuSelected",function(BB){A4._invokeDataAction(BB.dataAction,BB.dataValue);}));});}});}function O(A3,BI){var BE=this,BF=BE.header.getHeader(),A9=true,A5=false,A4=0,BK=BE.cdo._getAttachments(),A1,Y,A6,BJ,BH,BA,BG,BC=true,A7,Az=BE.getRTEInstance(),BD,A8,A2;if(BE.isSending){return;}A2=function(BL){BE.allowSend=true;if(!BL){BE.setFocus("body",0,1);}else{BE._restoreFocus();}};if(BE.allowSend){if(BE.baseNode.one(".file-attach .downloading:not(.hidden)")){AP.use("common-ui-dialog-helper",function(BL){BE.allowSend=false;BL.common.ui.DialogHelper.alert({hd:strings.str_comp_dialogheader,bd:strings.str_comp_still_uploading,suppressRestoreFocus:true},{ok:{handler:A2},cancel:{handler:A2}});});return;}}else{return;}if(BE.attView&&BE.attView.checkOverLimit()){return;}while(A9&&BK[A4]){Y=BK[A4++].state;if(!Y.cancelled&&Y.failed){A9=false;}if(Y.failCause=="virus"){A5=true;}}if(!A9){BE._alertInvalidAttachments(A5);return;}if(!BF.validAddress){var BB=strings.str_comp_invalidAddressA+"<br><br>"+AY(BF.currentAddress)+"<br><br>";BB+=V(strings.str_comp_invalidAddressB,null,null,null,strings);BE._alertProblem(strings.str_comp_title_invalidAddr,BB);return;}if(BF.to.length<1&&BF.cc.length<1&&BF.bcc.length<1){BE._alertProblem(strings.str_comp_title_emptyToField,strings.str_comp_emptyToField);BE._registerFocus(AP.one("#to-field"));return;}if(BI.saveBeforeSend){BE._invokeSaveDraft({saveBeforeSend:true});return;}BD=Az.all("a");BD.each(function(BM){var BL=BM.get("href");if(typeof(BL)==="string"){BL=BL.replace(/&amp;/g,"&");BM.set("href",BL);}});A7=new AT.Stopwatch("SendConfirm","start");A1=BE.assembleSendBody();var A0=function(){var BO=BE.baseNode.one(".attachment-button-attach"),BM=BE.cdo.get("origin");if(BO){BO.fire("compose:close");}if(BE.isSending){return;}else{BE.isSending=true;}BE._cancelSaveTimer();BE.dirty=false;var BL={header:BE.header.getHeader(),content:A1.html,textcontent:A1.text};BE.cdo.updateData(BL);A6={draftMID:BE.draftMID,noScroll:A3,keepDraft:BI.keepDraft?BI.keepDraft:false,cid:BM.oMsg&&BM.oMsg.cid};var BN=BE.cdo.oComposeData.header;BE.author.invokeSend(BE.cdo,A6,A7);};BJ=Ap(BF.subj);BH=Ap(A1.text);if(BE.getRTEDocNode().one("body img")){BC=false;}if(BJ.length<1&&BH.length<1&&BC){BA=strings.str_modal_send_msg_title;BG=strings.str_comp_invalidSubjectAndContent;A8=strings.str_comp_send;}if(BE.allowSend){if(BG){BE.allowSend=false;BE.confirm(BA,BG,function(){A0();},function(){A2(AP.one("#subject-field"));},A8);}else{A0();}}}function W(Y){var A1=this,Az,A0=A1.baseNode.one(".attachment-button-attach");if(Y){Az=A1.cdo.after("saveactionChange",function(A2){Az.detach();A1.author.set("forceClose",1);A1.author.set("close",1);A0.fire("compose:close");});}else{A0.fire("compose:close");A1.author.set("forceClose",1);A1.author.set("close",1);}}function p(A0,Az,Y){A0.addClass(AS);}function C(Y){Y.removeClass(AS);}function b(A1,A0){var A3=this,A2,Y,Az;if(A0){A0.preventDefault();}if(!A3.allowEdit){return;}A3._switchWellGuts(A1,A0);A3._restoreFocus();A3.editor.resize();}function e(A3,A2){var A5=this,A4,Y,A0,Az,A1;A0=d[A3].well;if(d[A3].isRTE&&!A5._isRTEActive()){A0="div.rich-text-switch-pane";}A5._closeWellGuts();Az=A5.baseNode.one(A0);C(Az);if(Az.hasClass("attachments-pane")){A5.attView.attachPaneHidden=false;}A4=A5.cdo._getAttachmentsCount();if(A4!=0){A5.baseNode.one("div.attachments-well").removeClass(AS);}else{A5.baseNode.one("div.attachments-well").addClass(AS);}A5.baseNode.one(d[A3].tab).get("parentNode").get("parentNode").addClass("active");A1=A5.baseNode.one("div.rte li.active a");A1.set("aria-selected",true);Az.set("aria-labelledby",A1.generateID());A5._switchWellCB(A3,A2);if(A2){J.set(Ae,A3);}if(A5.attView){A3!="atch"?A5.attView.reposAttachObj(As):A5.attView.reposAttachObj(AU);}}function M(Y){var Az=this;if(Y){Y.preventDefault();}Az._closeWellGuts();Az.attView&&Az.attView.reposAttachObj(As);J.set(Ae,"none");Az._restoreFocus();Az.editor.resize();}function Aa(){var A0=this,Y,Az;Y=A0.baseNode.all("div.gwell");Y.each(p);A0.attView.attachPaneHidden=true;A0.baseNode.one("div.rich-text-switch-pane").addClass(AS);if((Az=A0.baseNode.one("div.rte li.active"))){Az.removeClass("active");Az.one("a").removeAttribute("aria-selected");}}function L(Y){var Az=this;Az._toggleRTEWell(Y,".rte .emoticons",".emoticons-pane");Az._toggleRTEWell(Y,".rte .rich-text",".format-pane");}function P(A0,A2,A3){var A5=this,A1,Az,A4,Y;if(A5.baseNode.one(A2).get("parentNode").get("parentNode").hasClass("active")){A1=A5.baseNode.one(A3);Az=A5.baseNode.one(".rich-text-switch-pane");A4=A0?Az:A1;Y=A0?A1:Az;A4.addClass(AS);Y.removeClass(AS);A5.editor.resize();}}function K(Az,Y){var A0=this;if(Az=="fmt"){A0._initializeSpellCheck();}else{if(Az=="atch"){A0.fire("darlaEvent",{action:"attch_upload_av_display"});}}}function D(){}function AR(A1){var A2=this,Y=A2.getRTEDocNode(),A0=A2.getRTEInstance(),Az;Az=A1?A2.editor.getContentOnSave():A2.editor.getContent();if(A2._isSpellCheckActive()){AP.mail.Controller.SpellCheck.removeAllMarkers(Y,null);}return R.assembleSendBody(Y,A2.editor.richFontInfo,Az);}function x(){var Y=this;if(Y._isSpellCheckActive()){return;}if(Y.spellCheckView==null){if(strings.str_tog_spellcheckEnabled){Y.spellCheckView=new AP.mail.ui.SpellCheckView(Y,Y.cdo);Y.spellCheckView.bindCDO();}else{Y.spellCheckView=0;Y.formatButtons.each(function(Az){var A0=Az.get("id");if(A0=="spellCheck"||A0=="btn-spell-langs"){Az.addClass(AS);}});}}}function w(){var Y=this;AP.use("mail-ui-composeview-spellcheck",function(){Y._activateSpellCheck();if(Y._isSpellCheckActive()){Y.spellCheckView.doSpellCheck();
Y.setFocus("body");Y.fire("darlaEvent",{action:"spell_chk"});}});}function AD(Y){var Az=this;AP.use("mail-ui-composeview-spellcheck",function(){Az._activateSpellCheck();if(Az._isSpellCheckActive()){Az.spellCheckView.showLangMenu(Y);}});}function AB(){return this.editor.getRTE().getInstance();}function Aj(){return this.getRTEInstance().one("doc");}function Ab(){this.editor.resize();}function H(){var A1=this,A0,Y,Az;if(NeoConfig.fullPage){if(A1.baseNode==null){return;}A0=A1.baseNode.one("table");if(A0==null){return;}Az=parseInt(A0.one(".compose-header").getStyle("height"));Y=AP.one("body").get("winHeight")+Az;if(Y<Ac){Y=Ac;}A0.setStyle("height",Y+"px");if(AP.UA.ie){A1.baseNode.setStyle("height",Y+"px");}}if(AP.UA.ie){A1.editor.resize(true);}}function o(A3){var A4=this,Az,Y,A0,A1=g.length;if(!0){Az=A3.commands;A4.formatButtons.removeClass("pressed");A4.formatButtons.each(function(A7){var A6=A7.getAttribute("data-action"),A5=A7.hasClass("btnpress");if(A6&&Az[A6]&&A5){A7.addClass("pressed");}});A4.fontFamilyOptions.each(function(A5){var A6=A5.get("value").toLowerCase();if(A6.indexOf(","!==-1)){A6=(A6.split(","))[0];}if(A6===A3.fontFamily){A5.set("selected",true);}});if(A3.fontSize.indexOf("pt")!==-1){Y=A3.fontSize.replace("pt","");for(var A2=0;A2<A1;A2++){if(A4.fontSizeOptions.item(A2).get("text")===Y){A4.fontSizeOptions.item(A2).set("selected",true);}}}else{Y=parseInt(A3.fontSize.replace("px",""));if(!isNaN(Y)){A4.fontSizeOptions.item(A4._fontSizeMatch(Y)).set("selected",true);}else{if(AP.UA.webkit){Y=A4._fontSizeMatchWebkit(A3.fontSize);if(!isNaN(Y)){A4.fontSizeOptions.item(Y-1).set("selected",true);}}}}if(A3.fontColor){if(!A4._formatPane){A4._formatPane=A4.baseNode.one(".format-pane");}A0=A4._formatPane.one("#btn-forecolor i");A0.setStyle("backgroundColor",A3.fontColor);}}}function v(A2){var A3=10000,A0,Az=A2,A1,Y=g.length;if(Az>7){for(A1=0;A1<Y;A1++){A0=Math.abs(A2-g[A1]);if(A0<A3){A3=A0;Az=A1;}}}else{if(Az){Az--;}}return Az;}function AC(Y){var Az=Y=="-webkit-xxx-large"?7:Y=="xx-large"?6:Y=="x-large"?5:Y=="large"?4:Y=="medium"?3:Y=="small"?2:Y=="x-small"?1:Y;return Az;}function AI(A0,Az,Y){var A1=T(A0);AP.one("body").appendChild(A1);AP.use("comms-ui-menu-base",function(A2){Az.plug(A2.Plugin.Menu,{"menu":A1});Az.menu.show();A1.delegate("mousedown",function(A7){A7.halt();var A6=A7.target,A5=A7.currentTarget,A3=A6.ancestor(function(A9){return A9.getAttribute("data-action")||A9===A5;},true),A4=A3?A3.getAttribute("data-action"):0,A8=A3.getAttribute("data-value")||"";A1.fire("menuSelected",{dataAction:A4,dataValue:A8,item:A3});Az.menu&&Az.menu.hide();},"li");Y(A1);});return A1;}function N(Y){var A1=this,A0,Az=AP.mail.model.DataStore.Messages.getPermMidPart;if(Y&&Y.oMsg&&A1.draftMID){return Az(A1.draftMID)==Az(Y.oMsg.mid);}if(!A1._isOrigin()){if(!Y||!Y.oMsg){return true;}}if(Y&&Y.oMsg){A0=A1.cdo.get("origin");return(Y.action===A0.action&&Y.fid===A0.fid&&Y.oMsg.mid===A0.oMsg.mid&&Y.forwardAsAttachment===A0.forwardAsAttachment);}return false;}function Ai(){var Az=this,Y;Y=Az.cdo.get("origin");return(Y.action&&Y.fid&&Y.oMsg);}function AV(){var Az=this,Y;Y=Az.cdo.get("origin");Az._clearOriginTimers();Az._writeLoadingHtml(Y.errInfo=="ok"?"pop":"slow");}function y(){var Y=this;Y._writeLoadingHtml("start");}function s(Az,Y){this.editor.setContent(Az,Y);}function Ax(Az){var Y=this;if(Y.loadingArea.hasChildNodes()){Y.loadingArea.get("children").remove().destroy(true);}Y.loadingArea.appendChild(T(V(Av.base,null,Y.loadFormatters,Az,strings,Aq)));}function AZ(){var Y=this;Y.slowOriginReqTimer&&clearTimeout(Y.slowOriginReqTimer);Y.loadingTimer&&clearTimeout(Y.loadingTimer);}function AH(Y){var A1=this,A0,Az;if(A1.allowSend){AP.use("common-ui-dialog-helper",function(A2){A1.allowSend=false;A0={hd:Y?strings.str_rte_attachments_alert_virus_title:strings.str_comp_dialogtitle_invalidSendAttachments,bd:Y?strings.str_rte_attachments_alert_virus:strings.str_comp_dialogbody_invalidSendAttachments,suppressRestoreFocus:true};Az=function(){A1.allowSend=true;A1._restoreFocus();};A2.common.ui.DialogHelper.alert(A0,{ok:{handler:Az},cancel:{handler:Az}});});}else{A1._restoreFocus();}}function t(A0,Az,Y){AW.push({params:AP.clone(A0),appInstance:Az,handler:Y});AP.fire("om:compose_add_btn");}function X(Y){AP.each(AW,function(Az,A0){if(Az.appInstance===Y){AW.splice(A0,1);}});AP.fire("om:compose_remove_btns",Y);}AP.extend(AO,AP.mail.ui.MailCompose);AP.mix(AO.prototype,{NAME:"FullCompose",render:AK,bindUI:B,_bindWellUI:Ar,onKeyDown:j,onFocus:q,handleActiveChanged:AG,handleToolbarSelection:F,handleCloseChange:An,updateToolbar:l,getContent:A,getRTE:AF,getRTEInstance:AB,getRTEDocNode:Aj,getFirstNode:Q,setFocus:Ag,contentChangeAfter:AL,replyheaderChangeAfter:Au,replyContentChangeAfter:u,postRender:Af,matchOrigin:N,setContent:s,_bindCDO:AM,_initOpenMailButtons:Ad,_addFocusListeners:Al,_intlBindUIRTE:D,_allowEditing:AX,_invokeDataAction:a,_invokeRTECommand:AE,_invokeAction:Ao,_isRTEActive:At,_updateRTToolbar:o,_adjustLowRes:m,_resizeComposePage:H,_resizeRTE:Ab,assembleSendBody:AR,_invokeSend:O,_closeAfterWarning:W,_closeWell:M,_closeWellGuts:Aa,_switchWell:b,_switchWellGuts:e,_switchWellCB:K,_toggleRTEWellMode:L,_toggleRTEWell:P,_switchEditMode:G,_cmdTextSwitch:Ak,_showMenus:AJ,_showRTEMenu:AI,_alertInvalidAttachments:AH,_initializeSpellCheck:AA,_activateSpellCheck:x,_isSpellCheckActive:Aw,_doSpellCheck:w,_openSpellCheckMenu:AD,_isOrigin:Ai,_handleSlowOriginRequest:AV,_displayLoading:y,_writeLoadingHtml:Ax,_clearOriginTimers:AZ,_setComposePreference:n,_fontSizeMatch:v,_fontSizeMatchWebkit:AC,ondestroy:function(){AO.superclass.ondestroy.call(this,arguments);}},true);AP.namespace("mail");AP.mail.ComposeView=AO;AP.mix(AP.mail.ComposeView,{addButton:t,removeButtons:X},true);if(NeoConfig.intl==="jp"){AP.use("mail-ui-composeview-base-jp",function(Az){Az.extend(Az.mail.ComposeViewJp,AO);Az.mail.ComposeView=Az.mail.ComposeViewJp;});}},"1.0.0",{requires:["mail-ui-mailcompose","mail-ui-rteview","mail-ui-messagepane-utils","forms_css","rte_css","attachments_css","mod-stationery_css","mod-compose_css","mail-ui-composeview-attach","editor-base","editor-para","editor-br","node","stylesheet","mail-controller-compose-text","mail-model-compose","contacts-api-utils","contacts-api","filter-contacts","plugin","comms-bidi-textentry","comms-editor-autobidi","comms-intl-bidi","editor-bidi","_shared_module_compose","_shared_module_toolbar_compose","_shared_module_compose_loading","_shared_module_offscreen_bin_compose","_shared_module_offscreen_bin_compose_menu_spellcheck","_shared_module_offscreen_bin_compose_modal_cancel_compose","_shared_module_rte_well_content_format","_shared_module_rte_well_content_emoticons","_shared_module_rte_well_content_attachments","_shared_module_rte_well_tabs_compose","common-ui-toolbar-base","_shared_module_offscreen_bin_compose_menu_list","_shared_module_offscreen_bin_compose_menu_text_align"]});
YUI.add("_shared_module_compose_title",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_title={base:"<span class='compose'><span>{{str_comp_title}}</span>{{compose_title}}</span>"};},"1.0.0");YUI.add("mail-ui-authorview-base",function(F){var P=F.Node.create,W="hidden";var V=function(Y){var g=this,f;g.keyCodes=[];g.keyCodesL10N={};g.parent=null;g.subview=null;g.subviews=[];g.cdo=null;g.composeView=null;g.composeViewTainer=null;g.sendConfirmView=null;g.sendConfirmViewTainer=null;g.captchaView=null;g.captchaViewTainer=null;g.localCharCodes=[8,77,78,73,84];g.composeActive=true;g.type="author";g.keyCodesL10N[strings["str_cfg_sc_keycode_save_as_draft"]]=83;g.keyCodesL10N[strings["str_cfg_sc_keycode_close_tab"]]=220;for(f in g.keyCodesL10N){g.keyCodes.push(f);}V.superclass.constructor.call(g,Y);g.set("charCodes","13,13+ctrl,13+meta,27,188+ctrl,190+ctrl,"+g.keyCodes.join("+ctrl,")+"+ctrl,"+g.keyCodes.join("+meta,")+"+meta");if(F.UA.ie){g.set("localCharCodes",g.localCharCodes.join());}g.closeChgHandler=g.on("closeChange",g.handleCloseChange,g);g.updateTabTitle(g.get("title"));g.dsMsgChgHandler=F.on("ds:msg:change",g.handleDSMessageChange,g);};function d(Y){var f=this;f.dsMsgChgHandler&&f.dsMsgChgHandler.detach();f.closeChgHandler&&f.closeChgHandler.detach();f.toolBarHandler&&f.toolBarHandler.detach();}function C(g,p,j,r,m){var n=this,q=n.cdo&&n.cdo.oComposeData&&n.cdo.oComposeData.origin,f,h,k,Y=j&&j[0],l,o;if(q){f=q.oMsg;h=q.fid;k=q.action;}if((k=="reply_all"||k=="reply_sender"||k=="forward")&&m=="move"){for(l=0;f&&l<j.length;l++){o=j[l].mid;if(F.mail.model.DataStore.Messages.hasMoved(f.mid,o,h,g)){n.backToMessageTab=null;n.subview.showToolbarButtons&&n.subview.showToolbarButtons();n.dsMsgChgHandler&&n.dsMsgChgHandler.detach();return;}}}}function e(Y){var f=this;Y=Y||strings["str_tabs_compose"];f.set("title",Y);}function R(Y){var f=this;f.set("direction",Y);}function M(g){var h=this,Y=h.localCharCodes.length,f;for(f=0;f<Y;f++){if(g==h.localCharCodes[f]){return true;}}return false;}function I(Y){var g=this,f=Y.keyCode;f=g.keyCodesL10N[f]||f;switch(f){case 220:if(!Y.altKey&&(Y.metaKey||Y.ctrlKey)){g.set("close",1);return true;}break;case 27:g.set("close",1);return true;break;}if(F.UA.ie&&g.subview.onLocalKeyDown){if(!g.subview.onLocalKeyDown(Y)){return false;}}if(g.subview&&g.subview.onKeyDown){return g.subview.onKeyDown(Y);}else{return null;}}function J(Y){var f=this;if(f.subview.onFocus){return f.subview.onFocus(Y);}else{return null;}}function O(){var Y=this;if(Y.subview.isDirty){return Y.subview.isDirty();}else{return true;}}function D(){var Y=this;if(Y.subview.isSaved){return Y.subview.isSaved();}else{return false;}}function Q(Y){var f=this;if(f.subview.matchOrigin){return f.subview.matchOrigin(Y);}else{return false;}}function E(Y){var f=this;f.set("contentToolbar",Y);if(Y){f.toolBarHandler=Y.on("itemSelected",N,f);}}function N(Y){var f=this;if(Y.item&&Y.item.ancestor().hasClass("disabled")){return;}if(f.subview.handleToolbarSelection){f.subview.handleToolbarSelection(Y);}else{}}function B(Y){var f=this;f.sendConfirmViewTainer.addClass(W);f.composeViewTainer.removeClass(W);f.composeView.isSending=false;f.composeView.updateToolbar();f.composeView.resetSaveTimer();if(Y){f.composeView.dirty=true;f.composeView.allowSend=true;}f.composeActive=true;f.subview=f.composeView;}function U(Y){var g=this,f;g.sendConfirmViewTainer.removeClass(W);g.composeViewTainer.addClass(W);g.sendConfirmView.updateToolbar();if(!Y&&NeoConfig.fullPage){f=F.config.win||window,f.scrollTo(0,0);}g.composeActive=false;g.subview=g.sendConfirmView;g.sendConfirmViewTainer.setAttribute("tabIndex","-1");g.set("focusNode",g.sendConfirmViewTainer.one(".col-a"));g.sendConfirmViewTainer.one(".col-a").focus();}function Z(g,f){var h=this,Y;g.cdo&&g.cdo.get("passive")?Y=g.cdo:Y=F.mail.Controller.Compose.createCDO();f=false||f;if(f){h.setDraftOrigin(Y,g);h.setDraftFromAddress(Y);}else{h.setMessageFromAddress(Y);h.setMessageOrigin(Y,g);}if(g&&g.cbfn){Y.set("prePopulated",true);g.cbfn(Y,g);}if((!g||!g.action||!g.fid||!g.oMsg)&&!(g.cdo&&g.cdo.get("passive"))){F.mail.Controller.Compose.insertSignature(Y);}return Y;}function L(f,Y){var g=this;Y=false||Y;g.cdo=g.initComposeData(f,Y);g.cdo.handles=[];g.subview=g.createComposeView(g.cdo,Y,f);g.subviews.push(g.subview);if(f&&f.postRender){g.subview.handles.push(g.subview.on("renderComplete",function(){f.postRender(g,f);}));}if(f&&f.oMsg&&f.oMsg.header){f.oMsg.header.subject=F.mail.Controller.Compose.seedSubject(f);}return g.subview;}function H(Y,h,f){var g=this;f&&f.start(1,"moduleLoad");F.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base",function(k){var i=g.sendConfirmView?g.sendConfirmView.sdo:null,j=k.mail.persist.MetaData.get("cg.pref.general.showconfirmpage");if(f){f.start(1,"prepareSend");f.action="normal";}i=k.mail.Controller.Compose.transformSend(Y,i,h,true);g.createSendConfirmView(i,Y);k.mail.Controller.SendConfirm.sendMessage(i,f);k.use("contacts-api-utils",function(l){g.showSendConfirm(h.noScroll);});});}function a(Y,f){if(f&&f.action&&f.fid&&f.oMsg){Y.set("origin",{action:f.action,fid:f.fid,oMsg:f.oMsg,forwardAsAttachment:f.forwardAsAttachment,ctxReq:null});}}function A(Y){var f=Y.get("header");f.from=F.mail.Controller.Compose.getDefaultFromAddress();Y.set("header",f);}function G(Y,f){if(f&&f.action&&f.fid&&f.oMsg){Y.set("origin",{action:f.action,fid:f.fid,oMsg:f.oMsg,ctxReq:null});}}function S(Y){var g=Y.get("header"),f=Y.get("origin").oMsg;g.from=f.from?f.from:(f.header||{}).from;Y.set("header",g);}function K(h,Y){var l=this,k=Y.get("origin"),j=0,i=0,g=null,f=null;if(!!k&&k.action&&k.action=="reply_sender"||k.action=="reply_all"){j=1;}else{if(!!k&&k.action=="forward"){i=1;}}g=new F.mail.SendConfirmView({sdo:h,author:l,isReply:j,isForward:i});g.handles=[];g.handles.push(g.on("darlaEvent",function(m){l.fire("darlaEvent",m);}));f=P('<div class="hidden">');f.addClass(W);g.render(f);l.parent.appendChild(f);l.set("rootNode",l.parent.one("div.compose.content"));g.postrender(f);l.addChild(g);l.sendConfirmView=g;l.subviews.push(g);l.sendConfirmViewTainer=f;}function c(Y,g,h){var i=this,f=null;f=new F.mail.ComposeView(Y,g,i,h);f.handles=[];f.handles.push(f.on("darlaEvent",function(j){i.fire("darlaEvent",j);
}));i.addChild(f);i.composeView=f;return f;}function T(){var Y=this;Y.parent=Y.get("parentNode");Y.composeView.render(Y.parent);Y.composeViewTainer=Y.composeView.baseNode;Y.composeView.postRender();}function b(f){var g=this,Y=F.one(f);g.set("parentNode",Y);g.set("rootNode",Y.one("div.compose.content"));return;}function X(){return;}F.extend(V,F.mail.ui.BaseWidget);F.mix(V.prototype,{NAME:"AuthorView",onKeyDown:I,onFocus:J,bindUI:X,render:b,initCompose:L,initComposeData:Z,createComposeView:c,bindComposeView:T,createSendConfirmView:K,showSendConfirm:U,showCompose:B,isLocalCharCode:M,isDirty:O,isSaved:D,invokeSend:H,matchOrigin:Q,setMessageOrigin:a,setMessageFromAddress:A,setDraftOrigin:G,setDraftFromAddress:S,attachToolbar:E,proxyToolbarSelection:N,updateTabTitle:e,updateTabDirection:R,handleCloseChange:d,handleDSMessageChange:C},true);F.namespace("mail.ui");F.mail.ui.AuthorView=V;},"1.0.0",{requires:["mail-controller-base","mail-controller-compose","mail-ui-fullcompose","_shared_module_compose_title"]});YUI.add("om-ui-autosuggest",function(F){var H=F.Lang,R=F.contacts,G=R.api,N=R.utils,S=F.comms,J=F.om,K=J.Controller,L=K.Views,T=J.common.Utils,C=J.model.DataStore,P=F.common.Utils,M=C.Registry,B=C.ViewRegistry,O=C.EventRegistry,D=F.mail.Tabs,A=K.Compose,Q="hidden";function I(U){var W=M.getAll(),V=U.length;while(V--){if(W[U[V]]){return true;}}return false;}function E(d){var b=this,W=d.acContent,U=W.context,Y=W.data,h=U.appid,V=C.ApplicationList.getByAppId(h),c=U.instanceid,g=Y.height,f=Y.view,X=(f in V.views&&V.views[f].type)||"",a=F.one("body"),Z=true,e=L.getInternalUserViewId(h,"autosuggest-"+f.replace(/\W/g,"_")+(+new Date()));b.appViewIds=[];b.leftOffset=0,b.viewObj=null;b.xobniAppIds=["34dr268rjceb2","6acb3cgojccpm"];b.styles={visible:{zIndex:"99999",position:"absolute",visibility:"visible",display:"block"}};L.openView(h,V.instance,e,f,X,"alignedoverlay",d.context||null,{},480,g,0,"","api/openView",null,null,null,null,{renderParams:[a,Z],parentWidget:b,appParams:d},function(){b.appViewIds.push(e);b.set("alignNode",d.acNode);b.viewObj=B.get(e);b.setACListeners();});E.superclass.constructor.apply(this,arguments);}E.NAME="OMAutoSuggestView";F.extend(E,F.contacts.ui.ACWidget,{NAME:"OMAutoSuggestView",bindUI:function(U){},setACListeners:function(){var U=this;F.on("om:resize",function(b){if(I(U.xobniAppIds)&&U.viewObj){var W=U.get("alignNode"),Z=U.styles.visible,Y=b.data;if(Y){var V=Y.height,X=Y.width,a=Y.left;if(V&&V>0){Z.height=V;}if(X&&X>0){Z.width=X;}if(a&&a>0){U.leftOffset=a;Z.left=U.leftOffset+W.getX()+1;}}U.viewObj.syncUI(Z);}});F.on("ac:query",function(Y){var V=D.getActiveTab(),Z=H.trim(Y.value);if(Z!==""){var a=V.widget.composeView.header.getHeader();a.currentField=U.get("alignNode").get("id");F.fire("om:compose.autosuggest",{header:a,data:Z,yid:NeoConfig.loginId});if(U.viewObj&&!U.isVisible()){var W=U.get("alignNode"),X=U.styles.visible;X.top=W.getY()+W.get("clientHeight")+2;X.left=W.getX()+U.leftOffset+1;U.viewObj.show(X);}}});F.on("ac:next",function(V){F.fire("om:compose.downkey",{header:D.getActiveTab().widget.composeView.header.getHeader()});});F.on("ac:previous",function(V){F.fire("om:compose.upkey",{header:D.getActiveTab().widget.composeView.header.getHeader()});});F.on("ac:hide",function(V){if(U.isVisible()){U.hide();}});},_getEventPlugin:function(U){var V=false;isUndef=H.isUndefined;if(!isUndef(U.acNode)&&!isUndef(U.acTarget)){V=U.acTarget.plug(S.ui.AutoCompleteEventsPlugin,{alignNode:U.acNode}).ac;}return V;},hide:function(U){if(this.viewObj&&this.isVisible()){this.viewObj.hide();}},refresh:function(U){this.set("alignNode",U.acNode);return E.superclass.refresh.apply(this,arguments);},getItemMarkup:function(U){return E.superclass.getItemMarkup.apply(this,arguments);},buildName:function(X,V,W,U){return E.superclass.buildName.apply(this,arguments);},updateHighlighting:function(U){return E.superclass.updateHighlighting.apply(this,arguments);},_hlMatch:function(U,V){return E.superclass._hlMatch.apply(this,arguments);},hlFn:function(U){return E.superclass.hlFn.apply(this,arguments);},_sortMatches:function(V,U){return E.superclass._sortMatches.apply(this,arguments);},click:function(U){},handleEnter:function(V,U){V.halt();F.fire("om:compose.select",{});},detachAppViews:function(){this.set("closing",1);F.each(this.appViewIds,function(U){L.closeView(U);});this.appViewIds=[];},handleCloseChange:function(U){},handleActiveChanged:function(U){},backToMessage:function(){},isVisible:function(){if(this.viewObj){return !this.viewObj.get("hidden");}else{return false;}}});F.namespace("om.ui");F.om.ui.AutoSuggestView=E;},"1.0.0",{requires:["ac-widget"]});YUI.add("om-ui-mailcompose-header",function(B){var G=B.Lang,Z=B.contacts,F=Z.api,T=Z.utils,a=B.comms,L=B.ui.Templates,S=B.common.Utils.substitute,W=B.Lang.trim,N=B.Node.create,d=B.mail.Controller.Compose,M=B.common.persist.UserData,V=B.mail.persist.MetaData,D=B.common.Utils,H=B.mail.ui.PaneUtils,S=D.substitute,O=D.escapeHtml,U=D.unescapeHtml,C=strings.str_cfg_tog_unescape_ncr,L=B.ui.Templates,c=L._shared_module_compose_message_header&&L._shared_module_compose_message_header.compose_from_address,Z=B.contacts,F=Z.api,T=Z.utils,b="neo.pref.compose.showBcc",X="hidden",E="focus",K=B.om,A=K.model.DataStore,R=A.Registry,X="hidden",Q=false,P=[];function J(Y){var f=R.getAll(),e=Y.length;while(e--){if(f[Y[e]]){return true;}}return false;}function I(Y){this.xobniAppIds=["34dr268rjceb2","6acb3cgojccpm"];I.superclass.constructor.apply(this,arguments);}I.NAME="MailComposeHeader";B.extend(I,B.mail.compose.HeaderBase,{NAME:"OMMailComposeHeader",setInputFocus:function(Y){if(!Q){return I.superclass.setInputFocus.apply(this,arguments);}Y.preventDefault();B.fire("om:compose.infocus",{header:B.mail.Tabs.getActiveTab().widget.composeView.header.getHeader()});I.superclass.setInputFocus.apply(this,arguments);},handleACBlur:function(Y){if(!Q){return I.superclass.handleACBlur.apply(this,arguments);}var f=this;if(B.ACWidgetInst){setTimeout(function(){B.ACWidgetInst.hide();f._lozengeIt(Y.currentTarget);},200);}},canACWidgetInstHandleEnter:function(f){if(!Q){return I.superclass.canACWidgetInstHandleEnter.apply(this,arguments);}var Y=B.ACWidgetInst;return(Y&&Y.isVisible());},setACCategory:function(Y,e){if(!Q){I.superclass.setACCategory.apply(this,arguments);}},handleEnter:function(f){if(!Q){return I.superclass.handleEnter.apply(this,arguments);}if(this.canACWidgetInstHandleEnter()){var Y=B.ACWidgetInst;return Y.handleEnter(f,Y);}},handleTab:function(f){if(!Q){return I.superclass.handleTab.apply(this,arguments);}var Y=f.target;if(!Y.get("value")&&!B.ACWidgetInst.isVisible()){return;}else{this.handleEnter(f);}},handleSpacebar:function(Y){if(!Q){return I.superclass.handleSpacebar.apply(this,arguments);}},_bindAutoComplete:function(){var i=this;if(!Q){if(NeoConfig.isXobniEnabled&&J(i.xobniAppIds)){var f=B.mail.Tabs.getActiveTab();if(f&&f.widget.composeView){var g=f.widget.parent,e=false;var Y=B.Node.create("<div id='smartrMenuButton' class='smartrMenuButton'><img src='http://smartrsearch.xobni.com/img/smartr_menulozenge_d.png' class='smartrMenuButtonImg'/><div class='smartrMenu'>Try Xobni's autosuggest</div></div>"),h=g.one("#to").ancestor(".contact-search");h.appendChild(Y);Y.on("click",function(){if(!e){B.fire("om:installxobni");e=true;setTimeout(function(){e=false;},300);}});B.on("removeXobniInstallBtn",function(){Y.hide();});}}}I.superclass._bindAutoComplete.apply(i,arguments);},_initAutoComplete:function(i,e,g){var j=this;if(!Q&&!g){I.superclass._initAutoComplete.apply(j,arguments);}else{var f={"to-field":".cm-to","cc-field":".cm-cc","bcc-field":".cm-bcc"},h=i.get("id"),Y=j.composeView.baseNode.one(f[h]);if(g){if(B.ACWidgetInst&&B.ACWidgetInst.name==="ACWidget"){j._unBindAutoComplete();B.ACWidgetInst.destroy();B.ACWidgetInst=undefined;}if(!B.ACWidgetInst){B.ACWidgetInst=new B.contacts.ui.ACWidget({acNode:Y,acTarget:i,acContent:e}).render();Q=true;j._bindAutoComplete();return;}}if(h&&f[h]){i.removeClass("whiteout");if(B.ACWidgetInst.get("alignNode")!==Y){B.ACWidgetInst.refresh({acNode:Y,acTarget:i,width:Y.getStyle("width")}).render();}}}}});B.namespace("om.ui");B.om.ui.MailComposeHeader=I;},"1.0.0",{requires:["mail-ui-mailcompose-base-header","om-ui-autosuggest"]});YUI.add("om-ui-composeview",function(F){var E=false,D=false;function C(H){var J=F.om.model.DataStore.Registry.getAll(),I=H.length;while(I--){if(J[H[I]]){return true;}}return false;}var A=function(){var H=this;H.xobniAppIds=["34dr268rjceb2","6acb3cgojccpm"];!D&&G();if(C(H.xobniAppIds)){F.once("om:loadautosuggest",function(I){F.mail.ui.Factory.register("contacts.ui.ACWidget",F.om.ui.AutoSuggestView);H.header._initAutoComplete(F.one("#to-field"),I,true);});}A.superclass.constructor.apply(H,arguments);!E&&H.once("renderComplete",function(){F.use("om-ui-sendconfirm",B);});F.fire("om:compose.start",{cdo:H.cdo},H);};function G(){F.mail.ui.Factory.register("mail.compose.HeaderBase",F.om.ui.MailComposeHeader);D=true;}function B(H){H.mail.ui.Factory.register("mail.SendConfirmView",H.om.ui.SendConfirmView);E=true;}F.extend(A,F.mail.ComposeView,{NAME:"OMComposeView"},{addButton:F.mail.ComposeView.addButton,removeButtons:F.mail.ComposeView.removeButtons});F.namespace("om.ui");F.om.ui.ComposeView=A;},"1.0.0",{requires:["om-ui-mailcompose-header","mail-ui-fullcompose","om-ui-autosuggest"]});YUI.add("om-controller-compose-events",function(B){var G=B.om,H=G.Controller,S=H.extend("ComposeEvents"),T=G.common.Utils,D=function(){B.log.apply({},arguments);T.log.apply({},arguments);},E=B.Lang,R=B.common.Utils,Q=B.contacts.utils,P=0,N={},M={INFOCUS:"compose.infocus",AUTOSUGGEST:"compose.autosuggest",DOWNKEY:"compose.downkey",UPKEY:"compose.upkey",SELECT:"compose.select",LOADAUTOSUGGEST:"compose.loadautosuggest",START:"compose.start",SENDSTART:"compose.sendstart",SENDCOMPLETE:"compose.sendcomplete",USER_EVENT:"compose.user_event"};function U(a,X,b){var Y={};this.view=b;try{Y=this.formatData(B.clone(X||{}));}catch(Z){D('Bad incomding data to Open Mail event "'+this.eventName+'" : '+Z.message);throw Z;}var L=b&&(b.cdo||b.sdo),V=L&&L._yuid,c=L&&L.get&&L.get("origin"),W;switch(c&&c.action){case"reply_sender":case"reply_all":W="reply";break;case"forward":W="forward";break;default:W="compose";}this.returnEventId=a+B.guid("-");this.sharedData={data:Y,action:W,instance:V||"",cancel:I(U.CANCEL,this.eventName,this.returnEventId),proceed:I(U.SUCCESS,this.eventName,this.returnEventId)};}U.CANCEL="cancel";U.SUCCESS="success";U.prototype={eventName:"",onCancel:function(){},onSuccess:function(){},getSharedData:function(){return this.sharedData;},formatData:function(L){return L;},validateSuccessData:function(L){return true;},validateCancelData:function(L){return true;},validateLog:function(L,V){var X;if(!L){X=["OM compose_event: Invalid data from App."," returnEventId=",this.returnEventId,", data="].join("");try{X+=B.JSON.stringify(V||"");}catch(W){X+="(Error stringifying data: "+W.message+")";}D(X);}return L;},responseHandler:function(V,W,L){if(V.returnCode===U.SUCCESS){this.validateSuccessData(V.data)&&this.onSuccess.apply(this,arguments);}else{if(V.returnCode===U.CANCEL){this.validateCancelData(V.data)&&this.onCancel.apply(this,arguments);}else{D("OM compose_events handler - unhandled returnCode ["+V.returnCode+"], event: "+this.returnEventId);}}}};function I(V,L,W){return["function(o) { ",'    var _context = { eventName: "',L,'",','                     returnEventId: "',W,'"};','    var _params =  { cmd:"returnEvent", args:{ ctx:_context, ','                     returnCode:"',V,'", data:o } };',"    openmail.Application.callWebService( ",'          { url:"apps://", method:"GET", parameters : _params });',"};"].join("");}function O(V){var L=V.eventName;N[L]=B.Base.create(L,U,[],V);}P&&O({eventName:M.START,formatData:function(X){var L=X.cdo,Y=L.get("header"),W=L.get("isRichText"),V=L.get("origin");return{header:Y,isRich:W,content:W?L.get("content"):L.get("textcontent"),fid:V.fid||"",action:V.action||""};},onSuccess:function(V,W,L){D("compose.start success callback");}});O({eventName:M.SENDSTART,formatData:function(W){var V=W.sdo,X=V.get("header"),L=B.clone(V.get("recipients"),true);B.Array.each([].concat(L.to,L.cc),function(Y){Y.contactId=(Q.getContactsByEmail(Y.email)||[0])[0]["id"];});return{subject:R.escapeHtml(X.subject),recipients:L,from:X.from};},validateSuccessData:function(V){var L=V.view&&E.isString(V.view)&&(!V.width||E.isNumber(parseInt(V.width,10)))&&(!V.height||E.isNumber(parseInt(V.height,10)));return this.validateLog(L,V);},onSuccess:function(V,W,L){if(L&&L.attachAppView){L.attachAppView(W,V.data,this.sharedData.data);}else{D("OM compose event onSuccess - no view or not an OMSendconfirmView: event="+this.returnEventId);}}});O({eventName:M.INFOCUS});O({eventName:M.AUTOSUGGEST,formatData:function(L){return L;}});O({eventName:M.UPKEY});O({eventName:M.DOWNKEY});O({eventName:M.SELECT});O({eventName:M.LOADAUTOSUGGEST,onSuccess:function(V,W,L){D("INVOKING LOADAUTOSUGGEST IN OM CONTROLLER COMPOSE EVENTS");}});P&&O({eventName:M.SENDCOMPLETE,onSuccess:function(V,W,L){D("compose.sendcomplete success callback");}});O({eventName:M.USER_EVENT,formatData:function(W){var V=this.view,X=V._getHeader(),L={to:X.to,cc:X.cc,bcc:X.bcc};this.appArgs=W.args;V.getRTEInstance().Selection.cleanCursor();return{body:V.getContent(),recipients:L,from:X.from,subject:R.escapeHtml(X.subj)};},getSharedData:function(){if(!this.sharedData.returneMessage){this.sharedData.returnMessage=this.sharedData.proceed;}B.mix(this.sharedData,this.appArgs);this.sharedData.body=this.sharedData.data.body;delete this.sharedData.data.body;return this.sharedData;},validateSuccessData:function(Y){var Z=!Y.body||E.isString(Y.body),X=!Y.to||E.isArray(Y.to),W=!Y.cc||E.isArray(Y.cc),L=Y.body||Y.to||Y.cc,V=Z&&X&&W&&L;return this.validateLog(V,Y);},onSuccess:function(W,a,V){var L=W.data.body,Z=W.data.to,X=W.data.cc,Y;if(L){V.setContent(L,false);if(W.data.enhanceDropboxLinks){J(V);}}if(Z){Y=V.getFirstNode("to");V._makeLozenges(Z,Y);}if(X){Y=V.getFirstNode("cc");V._makeLozenges(X,Y);}}});function F(){return B.Object.keys(N);}function K(L){if(!(L in N)){throw new Error("OM compose unsupported event: "+L);}return N[L];}var C=['<div id="menu-dropbox" class="optionMenu">',"<ul>",'<li data-action="follow_dropbox"><a href="#">',"<span>follow</span></a></li>",'<li data-action="delete_dropbox"><a href="#">',"<span>delete</span></a></li>","</ul>","</div>"].join("");function J(L){B.use("comms-ui-menu-base","menus_css",function(Z){var W,X,V;if(!(X=Z.one("#menu-dropbox"))){X=Z.one("body").append(C);X.insert('<span id="dropbox"></span>',"after");}W=L.getRTEDocNode().all("a[class$=link-dropbox]");W.on("click",function(Y){Y.preventDefault();V=Y.target.ancestor("div");A(V);});});}function A(L){var V=B.one("#dropbox"),X=B.one("#menu-dropbox"),W=B.one("#rtetext"),Y=W.getXY(),Z=L.getXY();if(!V.menu){V.plug(B.Plugin.Menu,{menu:X});}X.on("click",function(b){var a=b.target.ancestor("li").getAttribute("data-action");b.preventDefault();if(a=="delete_dropbox"){L.remove(true);}else{if(a=="follow_dropbox"){window.open(L.one("a").getAttribute("href"));}}X.detachAll();});X.on("menu:state",function(a){if(a.state=="hide"){X.detachAll();}});Z[0]+=Y[0];Z[1]+=Y[1];V.setXY(Z);V.menu.show();}B.mix(S,{COMPOSE:M,getSupportedEvents:F,getHandlerClass:K});},"1.0.0",{requires:["om-common-utils","om-controller-base"]});
YUI.add("om-controller-compose",function(E){var M=E.om,c=M.common.Utils,C=M.model.DataStore,T=C.Registry,Z=C.ViewRegistry,V=T.getAll(),N=M.Controller,a=M.Controller.Views,A=N.extend("Compose"),G=E.common.Utils.assert,K=function(){E.log.apply({},arguments);c.log.apply({},arguments);},I="om:",H=E.common.Utils.rocketstats,d=false,B=(function(){var Y={};return function(g,f){if(!(g in Y)||f){Y[g]=[];}return Y[g];};})(),X=N.ComposeEvents,S=X.COMPOSE,J=X.getSupportedEvents();function O(f){var Y;if(!f||T.isSick(f)){return null;}return c.tryProp(f,"config.events.compose.action.launch");}function b(Y,f){var g=a.getInternalViewId(Y,"compose",f);return Z.get(g)!==null;}function P(i,f){G(i.app==f);var g=i.instance,h=O(i),Y=T.isPreload(i);if(!h||!h.view||i.needsAck||T.isSick(i)){return;}if(b(f,h)){return;}if(!Y&&!d){return;}K("yomc:loadComposeView: "+i.name);E.each(J,function(j){var l=c.getEventName(i.instance,j,null),k=l+"registered";E.once(k,function(m,n){R(i,j,l);if(j===S.USER_EVENT){Q(i,l,n);}});});E.once("om:close_application"+g,F);a.runActions(i,"events","compose",true,null);}function U(){E.detach("omcompose|*");if(d){return;}d=true;V=T.getAll();E.each(V,P);}function R(i,Y,f){var g,h=i.instance;g=E.on(I+Y,function(n,k,j){var l,m;if(j&&j!==f){return;}try{l=new (X.getHandlerClass(Y))(f,n,k);}catch(o){K('OM Compose Ctrl: Caught exception for event "'+Y+'"... returning. '+o.message);return;}m=E.on(l.returnEventId,l.responseHandler,l,i,k);B(i.instance).push(m);E.fire(f,l.getSharedData());});B(h).push(g);}function F(Y){E.each(B(Y),E.detach);B(Y,true);}function Q(i,f,Y){var g=i.instance,h={label:Y.label,tooltip:Y.tooltip,tab:Y.tab};function j(l,k){Y.elemID=l;H.stat("OM","compose:user_event:click:"+i.app);E.fire(I+S.USER_EVENT,{args:Y},k,f);}E.once("om:close_application"+g,E.mail.ComposeView.removeButtons);E.mail.ComposeView.addButton(h,g,j);}function e(){var Y=[];E.each(V,function(f){if(T.isLargeFiler(f)){Y.push(f);}});return Y;}function D(Y){a.runActions(Y,"events","url",true,{});}function L(m){var Y=e();if(!Y.length){return false;}var k=window.strings||{},h=k["str_comp_attach_error"]||"",l=k["str_comp_attach_size_exceeded"],i=E.common.Utils.substitute,g={partner_name:function(){return Y[0].developer_name;},app_name:function(){return Y[0].name;}},j=k["str_comp_attach_install_app"];j=i(j,{},g);function f(){D(Y[0]);m._removeAllAttachments(m._isAttachmentOversized);}E.use("common-ui-dialog-helper",function(n){n.common.ui.DialogHelper.confirm({hd:h,bd:["<p>",l,"</p><p>",j,"</p>"].join("")},{ok:{handler:f,stopDestroy:false}});});return true;}function W(){E.each(V,P);E.on("om:register_app",P);E.once("omcompose|newMessage",U);E.once("omcompose|editMessage",U);E.once("omcompose|Y.mail.ui.Workspace:composeMessage:complete",U);}E.mix(E.mail.AttachmentView,{attachErrorSize:L},true);K("Open Mail is overriding mail.ComposeView.");E.mail.ui.Factory.register("mail.ComposeView",M.ui.ComposeView);if(C.Loading.isLoading()){E.on("om:datastoreLoaded",W);}else{W();}},"1.0.0",{requires:["om-controller-base","om-controller-views","om-ui-composeview","om-controller-compose-events","om-controller-internalapi","rocket-stats","om-common-utils","common-utils-stats"]});YUI.add("mail-service-uploader-v1",function(B){var A=function(D){if(NeoConfig.flashUploaderPercentage==""){NeoConfig.flashUploaderPercentage=100;}var E=!!(D.mail.UploaderServiceDebug||false),F=parseInt(NeoConfig.flashUploaderPercentage,10),J=parseInt(Math.random()*100,10),M=(J>=F);D.namespace("mail");var G=(window.location.search.indexOf("uploader=yui")>0),H=(window.location.search.indexOf("uploader=form")>0)&&!G,K=function(P,N,Q){var O=D.log;if(D.mail.UploaderServiceDebug){D.mail.UploaderServiceDebug.logIt(P,N,Q);}if(window.location.search.indexOf("uploaddebug=1")>0){O(P);}};if((NeoConfig.isFullSSL&&!NeoConfig.isAttachSSL)||M){G=false;H=true;}function I(){var N=NeoConfig.yuiUploaderDisabledIntls;if(N=="1"){return false;}return D.SWFDetect.isFlashVersionAtLeast(10,1,0);}function C(){var N=D.mail.UploaderService,O=D.common.Utils.rocketstats;K("Uploader Service: Determining default uploader...");if(I()&&!H){K("Uploader Service: YUI is the default Uploader",null,"YUI");N.DEFAULT_UPLOADER=N.UPLOADER_TYPE_YUI;O.intlStat("UploaderService","UploaderTypeYUI");N.INITIAL_UPLOADER=N.UPLOADER_TYPE_YUI;}else{K("Uploader Service: Flash is not available");K("Uploader Service: Form is the default Uploader",null,"Form");N.DEFAULT_UPLOADER=N.UPLOADER_TYPE_FORM;O.intlStat("UploaderService","UploaderTypeForm");N.INITIAL_UPLOADER=N.UPLOADER_TYPE_FORM;}N.emptyCreateQueue();return;}D.mail.UploaderService={debug:E,UPLOADER_TYPE_WAIT:"wait",UPLOADER_TYPE_FORM:"form",UPLOADER_TYPE_YUI:"yui",UPLOADER_TYPE_FLASH:"yui",UPLOAD_URL_BASE:NeoConfig.launch_protocol+(NeoConfig.attachmentServer?NeoConfig.attachmentServer+"/":"")+((NeoConfig.isFullSSL&&!NeoConfig.isAttachSSL)?window.location.host:(strings["str_cfg_base_intl"]+"."+NeoConfig.farm+".mail.yahoo."+(NeoConfig.intl=="jp"?"co.jp":"com")))+"/ya/upload",DEFAULT_UPLOADER:"wait",createQueue:[],uploadersCreated:{},uploadersCount:0,rs:D.common.Utils.rocketstats,handlePostRedirectResponse:function(N){D.mail.UploaderUtils.handlePostRedirectResponse(N);},emptyCreateQueue:function(){var N=this.createQueue;for(var O=0;O<N.length;O++){N[O]();}},create:function(P,O,Q){var R=this,N=function(){Q=Q||R.DEFAULT_UPLOADER;var S="mail-service-uploader-"+Q;R.type=Q;D.use(S,function(X){var V=new Date(),U=V.getTime(),W=R.uploadersCreated,T;P.uploaderID=U;switch(Q){case"yui":X.mail.Uploader=X.mail.UploaderYUI;break;case"form":X.mail.Uploader=X.mail.UploaderForm;break;}T=new X.mail.Uploader(P);if(T.fail){R.rs.intlStat("UploaderService","UploaderInstanceCreationFailed_"+Q);K("Uploader Service: Uploader creation failed for "+Q,"color:red;font-weight:bold;");R.DEFAULT_UPLOADER=R.UPLOADER_TYPE_FORM;K("Uploader Service: Reverting to uploader type: "+R.DEFAULT_UPLOADER);R.rs.intlStat("UploaderService","UploaderCreationFallback_"+R.DEFAULT_UPLOADER);S="mail-service-uploader-"+R.DEFAULT_UPLOADER;X.use(S,function(Z){R.create(P,O);});return;}else{R.rs.intlStat("UploaderService","UploaderInstanceCreated_"+Q);}W[U]=T;R.uploadersCount++;if(R.uploadersCount<6){R.rs.intlStat("UploaderService","UploadersCreated_"+R.uploadersCount);}else{if(R.uploadersCount==6){R.rs.intlStat("UploaderService","UploadersCreated_Plus");}}if(O){O(T);}});};if(R.DEFAULT_UPLOADER===R.UPLOADER_TYPE_WAIT){R.createQueue.push(N);R.rs.intlStat("UploaderService","UploaderCreationQueued");}else{N();}}};D.mail.UploaderService.logIt=K;C();var L=function(N){function O(Q,P){this.theQueue.push({action:Q,att:P});}};D.mail.attachmentQueue=L;};A(B);},"1.0.0",{requires:["_shared_module_compose","mail-controller-compose","mail-model-compose","rocket-stats","common-utils","swfdetect","mail-service-uploader-utils"]});