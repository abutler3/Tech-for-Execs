YUI.add("ult-tracker",function(B){B.namespace("mail.ult");var K=B.Lang,O=B.common.Utils,C=B.mail.log.ult,I={clk:{},lnVw:{},pg:{}},A={},J=spaceId=978500001,L=new Image(),Q="/neo/php/ultLog.php?",F=function(V){var U={};if(O.isEmpty(V)||!K.isObject(V)){return;}if(O.isEmpty(I.clk)){I.clk=V;}else{U=E();B.mix(I.clk,U);if(NeoConfig.expBucketId!="0"){C.beaconClick(I.clk);}I.clk=V;}},R=function(X,W){var V,U=false;if(O.isEmpty(X)||!K.isObject(X)){return;}if(!O.isEmpty(I.lnVw)||!O.isEmpty(I.pg)){for(V in X){if(I.lnVw[V]){U=true;break;}}if(W){for(V in W){if(I.pg[V]){U=true;break;}}}if(U&&NeoConfig.expBucketId!="0"){G();}}S(X,W);},N=function(V){var U;if(O.isEmpty(V)||!K.isObject(V)){return;}if(NeoConfig.expBucketId!="0"){for(U in V){if(I.pg[U]){G();break;}}}S(false,V);},S=function(U,V){if(U){B.mix(I.lnVw,U);}if(V){B.mix(I.pg,V);}},H=function(U){var W={},V={};switch(U){case"CLICK":W=A.clk?A.clk:{};V=E();break;case"LINK":W=A.lnVw?A.lnVw:{};V=M();break;case"PAGE":W=A.pg?A.pg:{};V=D();break;}if(!O.isEmpty(V)){B.mix(W,V);}return W;},G=function(){var V=Q,U={};P();U=H("PAGE");if(!O.isEmpty(U)){V+="&pg="+JSON.stringify(U);}U=H("LINK");if(!O.isEmpty(U)){V+="&ln="+JSON.stringify(U);}V=V+"&sid="+spaceId;V=V+"&rand="+Math.floor(Math.random()*1000000);U=H("CLICK");if(!O.isEmpty(U)){V=C.trackClick(V,U);}L.src=V;},T=function(){var W={ult:{}},V={},U;P();V=H("CLICK");if(!O.isEmpty(V)){U=C.trackClick("www.dummyurl.com",V);U=U.split("_ylc=")[1];W._ylc=U;}V=H("LINK");if(!O.isEmpty(V)){W.ult.ln=V;}V=H("PAGE");if(!O.isEmpty(V)){W.ult.pg=V;}return W;},P=function(){A=I;I={clk:{},lnVw:{},pg:{}};},E=function(){return{_S:J,_s:spaceId};},M=function(){return{};},D=function(){var U={};if(NeoConfig.expBucketId&&NeoConfig.expBucketId!="0"){U={test:NeoConfig.expBucketId,intl:NeoConfig.intl,mt:(NeoConfig.isMailPlus==1)?"plus":"free",pt:NeoConfig.partnerType};}return U;};B.on("spaceIdChange",function(U){J=spaceId;spaceId=U.sp;});B.on("ult:trackClick",F);B.on("ult:trackView",R);B.on("ult:trackPageParam",N);B.on("ult:sendULTData",G);B.mix(B.mail.ult,{getULTData:T});},"1.0.0",{requires:["ult_wrapper"]});