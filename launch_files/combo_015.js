YUI.add("_shared_module_send_confirm_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_send_confirm_rollup={base:'<div class="content send-confirm"> <div class="col-a" aria-live="polite" role="document"> <div class="box box-iso"> <h3 class="loading">{{str_comp_sending}}</h3></div> <div class="box box-iso hidden"> {{sending_error_else}} </div> <div class="box box-iso hidden"> {{sending_error}} </div> {{is_im}} </div> <div class="col-b"> {{is_mon}} {{is_lrec}} </div> </div>',msg_replied_to:'<h3 class="from">{{from}}</h3> <p class="subj">{{subject}}</p> <p class="snippet">{{snippet}}</p> ',is_reply:'<div class="items replied-to"> <h2 class="legend"><span class="label"><b>{{str_comp_original_msg}}</b></span></h2> {{msg_replied_to}} <div> <span class="btn left right small menu" data-action="menu"> <a title="{{str_move}}" href="#">{{str_move}}<b></b></a> </span> <span class="btn left right small"> <a title="{{str_delete}}" href="#">{{str_delete}}<b></b></a> </span> </div></div> ',message_sent_success:'<h3 class="success"><i></i><span class="msg">{{str_comp_email_sent}}</span></h3><div class="offset"> <span class="btn default left right"><a href="{{url_minty_inbox}}" data-action="navigate" role="button">{{str_comp_done}}</a></span></div>',new_recipients:"underline",contacts_not_in_ab:'<li> <span class="btn lozenge btn-contact small left" data-name="{{name}}" data-address="{{email_id}}" data-action="contact-menu"> <a role = "button" title="{{str_btn_recipient_lozenge_attr}}" href="#">{{msg_display_name}}</a> </span><span class="btn lozenge lozengeadd right small btn-kiosk-addcontact" data-name="{{name}}" data-address="{{email_id}}" data-action="modal"> <a role = "button" title="{{str_btn_add_recipient_attr}}" href="#">&nbsp;</a> </span> </li> ',contacts_in_ab:'<li> <span class="btn lozenge btn-contact left small right" data-name="{{name}}" data-address="{{email_id}}" data-action="contact-menu"> <a role = "button" title="{{str_btn_recipient_lozenge_attr}}" href="#">{{msg_display_name}}</a> </span> </li> ',global_auto_add_contacts:'checked=""',new_recipients1:'<div class="field"> <div class="checkbox"> <label><input type="checkbox" {{global_auto_add_contacts}} class="checkbox"> {{str_comp_auto_add_to_contacts}} </label> </div> </div>',sending_error_else:'{{message_sent_success}} <div class="items {{new_recipients}}"> <h2 class="legend"><span class="label"><b>{{str_comp_recipients}}</b></span></h2> <ul class="inline-items"> <span class = "lozengeContainer"> {{contacts_not_in_ab}} {{contacts_in_ab}} </span> </ul></div>{{new_recipients1}} {{is_reply}} ',sending_error:'<h3 class="error"> {{sending_error_msg}}</h3><div style="margin:10px;color:red;">{{sending_error_detail}}</div> ',is_im:'<div id="jp_ads_sc_module"></div> <div id="jp_ads_im_sent"></div> ',is_mon:'<div id="slot_MON_sent" class="ch_mod gxBoom boom"><div id="tgtMON_sent" ></div></div> ',is_lrec:'<div id="slot_LREC_sent"><div id="tgtLREC_sent" class="darla" tabindex="-1" hidefocus="true"></div></div> '};},"1.0.0");YUI.add("mail-model-send",function(D){var C=function(){C.superclass.constructor.apply(this,arguments);};var B={oSendData:null,initializer:function(){this.oSendData={cascade:{message:{subject:null,from:null,to:null,cc:null,bcc:null,replyto:{name:null,email:null},simplebody:{html:null,text:null,attachment:null}}},origin:{fid:null,oMsg:null,action:null},draftMID:null,cid:null};},destructor:function(){},reset:function(){delete this.oSendData;this.initializer();},_setHeader:function(F){for(var E in F){if(E){this.oSendData.cascade.message[E]=F[E];}}},_setContentHTML:function(E){this.oSendData.cascade.message.simplebody.html=E;},_setContentText:function(E){this.oSendData.cascade.message.simplebody.text=E;},_setAttachments:function(E){this.oSendData.cascade.message.simplebody.attachment=E;},_setOrigin:function(E){this.oSendData.origin=E;if(E.action&&E.action!="edit"&&E.fid&&E.oMsg&&E.oMsg&&E.oMsg.mid){this.oSendData.cascade.messageReference={fid:E.fid,mid:E.oMsg.mid,replied:E.action=="reply_all"||E.action=="reply_sender",forwarded:E.action=="forward"};}},_getOrigin:function(){return this.oSendData.origin;},_setDraftMID:function(E){this.oSendData.draftMID=E;},_getDraftMID:function(){return this.oSendData.draftMID;},_setCaptcha:function(F){if(!this.oSendData.cascade.headers){this.oSendData.cascade.headers={};}for(var E in F){if(E){this.oSendData.cascade.headers[E]=F[E];}}},_getRecipients:function(){return{to:this.oSendData.cascade.message.to,cc:this.oSendData.cascade.message.cc,bcc:this.oSendData.cascade.message.bcc};},_getCascade:function(){return this.oSendData.cascade;},_setCID:function(E){this.oSendData.cid=E;},_getCID:function(){return this.oSendData.cid;}};D.extend(C,D.Base,B,{NAME:"sendModel",ATTRS:{header:{setter:B._setHeader},contenthtml:{setter:B._setContentHTML},contenttext:{setter:B._setContentText},attachments:{setter:B._setAttachments},origin:{setter:B._setOrigin,getter:B._getOrigin},draftMID:{setter:B._setDraftMID,getter:B._getDraftMID},captcha:{setter:B._setCaptcha},recipients:{getter:B._getRecipients},cascade:{getter:B._getCascade},sendaction:{},disableaddcontact:{},cid:{setter:B._setCID,getter:B._getCID}}});var A=new function(){var F=this;function E(){var G=new C();return G;}D.mix(F,{createModel:E});};D.namespace("mail.model");D.mail.model.SendModel=C;D.mail.model.SendModelFactory=A;},"1.0.0",{requires:["base"]});YUI.add("mail-controller-messages-ops",function(F){var K,b,h=F.mail,Q=h.model.DataStore,g=Q.Messages,X=F.common.Utils,C=h.Controller,I=C.Folders,W=F.Lang,e={passthru:{move:"MoveMessages",flag:"FlagMessages",remove:"DeleteMessages",fullHeader:"GetMessageRawHeader",redirectMsg:"RedirectMessage",addFilter:"AddFilters"},isdup:{FlagMessages:function(k,j){var i=k.setFlags,Y=j.setFlags;if(k.mid&&j.mid&&k.mid.length==1&&j.mid.length==1&&k.mid[0]==j.mid[0]&&i.read==Y.read&&i.flagged==Y.flagged){return true;}}}},N,V,E="%40C%40Chats",f="Trash",J="%40B%40Bulk",a={"replied":"isReplied","flagged":"isFlagged","read":"isRead","draft":"isDraft","forwarded":"isForwarded","ham":"isHam","spam":"isSpam"},M=strings.str_cfg_tog_set_spam_read_flag;e.batchable=e.passthru;N=C.extend("Messages",e);V=N.Error;b=e.order;function d(l,q,k){var j,m,p=q.parms,Y=q.reason,n=q.api,o=l.error;if(o){for(m=0;m<o.length;m++){if(o[m].code!="WARN"){k("failure");return N._error(l,V.invalidmid);}}}if(n=="move"){g.move(p.sourceFid,p.destinationFid,p.mid,l.mid,Y);}if((j=l.sourceFolder)&&q.custom.isSparse){Q.Folders.set(j,"ds:msg:",1);}if(j=l.destinationFolder){Q.Folders.set(j,"ds:msg:",1);}}function P(l,q){var n,m=l.destinationFid&&l.destinationFid==J,j,o=q.origParms,Y=o.destinationFid,k=o.sourceFid,p=q.origParms.mid;if(m){j={};if(Y==J){j[a["spam"]]=1;j[a["ham"]]=0;}if(k==J&&Y!=f){j[a["ham"]]=1;j[a["spam"]]=0;}g.update(l.sourceFid||l.fid,p,{flags:j},"flag");if(M){for(n=0;n<p.length;n++){p[n].flags.isRead=1;}}}g.remove(l.sourceFid||l.fid,p,!l.destinationFid);}function R(l,n,m){var k=n.origParms,j,Y=l.returnCodes;if(Y&&Y.length){for(j=0;j<Y.length;j++){if(Y[j].code!="WARN"){m("failure");return N._error(l,V.invalidmid);}}}else{if(!k.mid){I.refresh();}else{if(n.custom.isSparse&&T(k.setFlags,"read")){if(!n.noRefresh){I.refresh();}}}}}function T(i,Y){return i&&(Y in i);}function L(l,i){var k,Y,j=l.setFlags;Y={};for(k in j){Y[a[k]]=j[k];}if(Y[a["spam"]]){Y[a["ham"]]=0;}if(Y[a["ham"]]){Y[a["spam"]]=0;}if(W.isUndefined(j.spam)&&i.reason!=="move"){g.update(l.fid,i.origParms.mid||[],{flags:Y},i.reason);}}function S(k,Y){var m,j=0,l=Y.origParms.mid;while(m=l[j++]){if(!m.header){Y.custom.isSparse=1;}}}function U(Y,i){i("failure");X.rocketstats.stat("msgops","invalidparm_"+Y.api);return N._error({},V.invalidparams);}function O(j){var Y=0,k=j.mid;if(!W.isArray(k)){k=(k?[k]:[]);}j.mid=[];for(;Y<k.length;Y++){j.mid[Y]=k[Y].mid||k[Y];}return Y||j.selection;}function G(m,r,AB){var AA=m.mid,u,t,p,k={},s,v,q,o,j,w,n,z=[],x=10,y=m.sourceFid,Y=y||m.fid;if(Y=="%40S%40Search"){m.enableRetry=true;for(t=0,u=AA.length;t<u;t++){v=AA[t].fid||Y;if(!k[v]){k[v]=[];}k[v].push(AA[t]);}if((o=X.size(k))==1&&v=="%40S%40Search"){return;}if(r.api=="remove"){m.sourceFid=m.sourceFid||m.fid;delete m.fid;m.destinationFid=f;r.newApi("move","MoveMessages",m);AB("pre","move");AB(1,m);return;}delete m.mids;for(t in k){n=F.clone(m);if(y){n.sourceFid=t;}else{n.fid=t;}n.mid=k[t];z[z.length]=n;}X.assert(o==z.length);if(o>1){var l=AB(function(){r.cbk.abort();});w=Math.ceil(o/x);for(p=0;p<w;p++){q=C.batch().Messages;for(t=p*x;(t<o&&t<p*x+x);t++){if(t==o-1){q[r.api](z[t],{success:function(i){l(i,"success",b.usercbk);},failure:function(i){l(i,"failure",b.usercbk);}});}else{q[r.api](z[t]);}}q.execute();}}else{return z[0];}}}function c(j,Y,m){var l=j.mid,i=l.mid||l,k=j.fid;if(k=="%40S%40Search"){j.enableRetry=true;if(l.fid&&(l.fid!=k)){j.fid=l.fid;}O(j);}}function Z(r,u,l){var k,Y,j,s,m=0,n=r.mid,o=r.setFlags,t=r.mid=[];if(X.isEmpty(o)){return U(u,l);}if(!W.isArray(n)){n=(n)?[n]:[];}if((o.spam&&(r.fid!=J))||(o.ham&&(r.fid==J))){j=1;}while(k=n[m++]){if(!X.isEmpty(k.flags)){k=g.get(r.fid,k.mid)||k;for(Y in o){if((k.flags[a[Y]]!=o[Y])||j){t.push(k);break;}}}else{t.push(k);u.custom.isSparse=1;}}if(n.length&&!t.length){l("success");return;}if(!O(r)){return U(u,l);}if(!r.spam&&((s=o.spam)||o.ham)){var p=u.getBatch(),q={sourceFid:r.fid,destinationFid:s?J:"Inbox",mid:n||u.origParms.mid,spam:1,enableRetry:r.enableRetry||false};u.noRefresh=1;if(s&&M){o.read=1;}l(1,r);p.Messages.move(q);p.execute(u.cbk);}delete r.spam;}function A(k,i,o){var Y,l,n=k.destinationFid,j=k.sourceFid,m={fid:j,mid:k.mid,spam:1,enableRetry:k.enableRetry||false};if(!k.spam){if(n==J){l=m.setFlags={spam:1};if(M){l.read=1;}}if(j==J&&n!=f){l=m.setFlags={ham:1};}}if(l){i.newApi("flag","FlagMessages",m);Y=i.getBatch();i.noRefresh=1;o("pre","flag");o(1,m);k.spam=1;k.bidiDetection=NeoConfig.bidi;Y.Messages.move(k);Y.execute(i.cbk);}delete k.spam;if(!O(k)){return U(i,o);}}function D(i,Y,j){if((i.fid!=f)&&(i.fid!=J)&&(i.fid!=E)&&!i.force){i.sourceFid=i.fid;delete i.fid;i.destinationFid=f;Y.api=Y.reason="move";Y.method=e.passthru["move"];j("pre","move");return i;}delete i.force;if(!O(i)){return U(Y,j);}}function B(i,Y){if(i&&(i.reason==V.invalidparams)){return;}if(Y.parms.sourceFid){g.flush(0,1);}I.refresh();}function H(j,Y){if(j&&(j.reason==V.invalidparams)){return;}var i=Y.parms;if("read" in i.setFlags){I.refresh();}else{g.flush(i.fid);}}K={success:d,failure:B};N.hook({move:K,remove:K,flag:{success:R,failure:H}});K={pre:P};N.hook({move:K,remove:K},0,b.optimistic);N.hook({move:{pre:G},remove:{pre:G},flag:{pre:G},fullHeader:{pre:c},redirectMsg:{pre:G}},0,b.fixParms);N.hook({move:{pre:A,aborted:B},remove:{pre:D,aborted:B},flag:{pre:Z,aborted:H},redirectMsg:{pre:function(Y){O(Y);}}},0,b.fixParms);N.hook({move:{pre:S},flag:{pre:L}},0,b.optimistic);F.mix(V,{invalidmid:V._reservedIdx+1,invalidparams:V._reservedIdx+1,noitems:V._reservedIdx+2});},"3.0.0",{requires:["rocket-stats","mail-controller-base","mail-model-datastore","json-stringify"]});YUI.add("mail-controller-sendconfirm",function(E){var Z=E.mail,D=Z.Controller,U=D.extend("SendConfirm"),F=E.common.Utils,J=D.Messages,T=E.contacts,G=T.config,I=T.api,S=T.utils,Q=Z.model.DataStore,X=Q.Messages,O="forward",N=E.common.persist.UserData,K=F.rocketstats,B=null,C=45000,R=90000,P=R+15000;function A(d,a){var m,f=d.get("origin"),o,c,i,l=[],e=(!d.get("disableaddcontact")&&(N.get("userSendPref.addUnknownContact")=="always"))?true:false,b=d.get("api"),g=function(){},Y={success:g,failure:g},k=function(q){try{if(q){E.mail.Controller.Messages.remove({fid:"Draft",mid:q,force:true},Y);}}catch(p){K.stat("SEND","PostSend:FailedToDeleteDraft");}};m={success:function(q,v){V();o=d.get("draftMID");c=d.get("keepDraft");i=d.get("cid");var r=L(v.args.sdo);r.contactsAdded=0;if(!NeoConfig.isAMT&&e&&r.unknown.length>0){var p={guid:NeoConfig.neoguid,requestFn:E.common.net.requestProxy,wspath:NeoConfig.socdirProxyPath,success:g,failure:g};G.setAttrs(p);r.contactsAdded=r.unknown.length;E.Array.each(r.unknown,function(y){l.push({fields:[{type:"email",value:y.email}]});});r.known=r.known.concat(r.unknown);r.unknown=[];I.saveContacts(l);}d.set("sendaction",{action:"success",args:{addy:r,mid:q.mid}});try{if(f.fid&&f.oMsg){var t={fid:f.fid,mid:[f.oMsg],setFlags:f.action==O?{"forwarded":1}:{"replied":1}};J.flag(t,{suppressCodes:["*"]});}}catch(u){K.stat("SEND","PostSend:FailedToSetFlag");}if(!strings.str_cfg_tog_sendconfirm_keep_draft&&c!==true){k(o);}try{if(i){var x={mid:q.mid,cid:i,flags:f.action==O?{"forwarded":1}:{"replied":1},header:d.oSendData.cascade.message};Z.model.ConvStore.Conversations.msgAdd(i,null,x);}else{X.set("Sent",q.mid,"add");}}catch(u){K.stat("SEND","PostSend:FailedToSetSent");}if(b==true){if(!NeoConfig.tmpForceAdSendTest){var w=Q.Folders.get(f.fid),s=Z.ui.common.StringUtils.getSystemFolderName(f.fid,w.folderInfo.name);E.use("mail-ui-messagepane-utils",function(y){y.fire("darlaEvent",{action:"sent_api",value:{siteAttr:Z.ui.MessagePaneUtils.getAdSiteAttribsFromMesgObj(f.oMsg,f.fid),foldername:s}});});}}else{E.fire("SentSuccess",f);}a&&a.stop();K.stat("SEND","Success");},failure:function(q,u){var p=u.args.sdo,r=q.code,t=q.fault,s=t&&t.message,v;V();switch(r){case"Client.HumanVerificationRequired":case"Client.WrongInput":case"Client.InputTooEarly":case"Client.TimedOut":case"Client.CannotSendThisMessage":case"Client.AccountVerificationRequired":p.set("sendaction",{action:"captcha",args:{fault:t}});K.intlStat("SEND","Failure:Captcha");break;case"Client.UserAbuseDetected":p.set("sendaction",{action:"abuse",args:null});o=p.get("draftMID");k(o);K.intlStat("SEND","Failure:Error:"+r);break;case"Server.SendMessageFailed":v=(s&&s.indexOf("Failed to get")>=0)?":FailedToGet":":Other";K.intlStat("SEND","Failure:Error:"+r+v);if(s){E.use("common-utils-error",function(){F.error.report("Send Failure: "+s);});}default:p.set("sendaction",{action:"error",args:{fault:t}});K.intlStat("SEND","Failure:Error:"+r);break;}},args:{sdo:d},timeout:R,suppressCodes:"*"};if(a){a.bodySize=0;if(d.get("contenthtml")){a.bodySize+=d.get("contenthtml").length;}if(d.get("contenttext")){a.bodySize+=d.get("contenttext").length;}a.attachCount=d.get("attachments").length;a.start(1,"msgSend");}K.stat("SEND","Attempt");if(d.get("origin").action==="om:app"){m.appid="MyPhotos";}if(NeoConfig.tmpForceAdSendTest){var n,j,h;if(f.action=="reply_all"||f.action=="reply_sender"||f.action=="forward"){j=Q.Folders.get(f.fid);h=Z.ui.common.StringUtils.getSystemFolderName(f.fid,j.folderInfo.name);n={siteAttr:Z.ui.MessagePaneUtils.getAdSiteAttribsFromMesgObj(f.oMsg,f.fid),foldername:h};}E.use("mail-ui-messagepane-utils",function(p){p.fire("darlaEvent",{action:"sent",value:n});});}E.mail.Controller.Messages.send(d.get("cascade"),m);M(d);E.fire("Y.mail.sendMessage",d);}function M(Y){if(B){B.cancel();}B=E.later(P,this,function(a){a.set("sendaction",{action:"error"});},[Y],false);}function V(){if(B){B.cancel();B=null;}}function H(b,c){var d=b.auto,a={destination:{fid:"Draft"},message:b.sdo.get("cascade").message},Y={success:function(e){var g=a.message,f={mid:e.mid,flags:{},header:{from:g.from,to:g.to,cc:g.cc,bcc:g.bcc,subject:g.subject,replyto:g.replyto}};X.set("Draft",f,"add");if(b.mid){X.remove("Draft",b.mid,true);}if(c){c(e.mid,0);}},failure:function(e){if(c){c(e.mid,-1);}},args:{sdo:b.sdo,auto:d},timeout:!d&&C,suppressCodes:d?["*"]:["Client.MessageNotFound"]};b.mid?a.destination.mid=b.mid:"";if(b.appid){Y.appid=b.appid;}E.mail.Controller.Messages.save(a,Y);}function W(){return function(c){var k=[],Y=[],e,h,a=[],f=c.get("recipients"),b=[f.to,f.cc,f.bcc],d,g,j;for(e=0,h=b.length;e<h;++e){d=E.Array.each(b[e],function(i){a.push(i);});}for(e=0,h=a.length;e<h;++e){g=(S.getContactsByEmail(a[e].email)||[])[0];if(g&&g.id>=0){if(!a[e].name){j=S.getFirstFieldValue(g,"name")||{};a[e].givenName=j.givenName;a[e].familyName=j.familyName;}a[e].cid=g.id;k.push(a[e]);}else{if(N.isUsersEmailAddress(a[e].email)){k.push(a[e]);}else{Y.push(a[e]);}}}return{known:k,unknown:Y};};}var L=W();E.mix(U,{sendMessage:A,saveMessage:H},true);},"3.0.0",{requires:["mail-controller-base","mail-model-send","contacts-api-utils","contacts-api","mail-controller-messages-ops","rocket-stats","common-utils-stats"]});YUI.add("_shared_module_send_confirm_recipients_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_send_confirm_recipients_rollup={base:'<div class="items {{new_recipients}}"> <h2 class="legend"><span class="label"><b>{{str_comp_recipients}}</b></span></h2> <ul class="inline-items"> <span class = "lozengeContainer"> {{contacts_not_in_ab}} {{contacts_in_ab}} </span> </ul></div>{{new_recipients1}}',new_recipients:"underline",contacts_not_in_ab:'<li> <span class="btn lozenge btn-contact small left" data-name="{{name}}" data-address="{{email_id}}" data-action="contact-menu"> <a role = "button" title="{{str_btn_recipient_lozenge_attr}}" href="#">{{msg_display_name}}</a> </span><span class="btn lozenge lozengeadd right small btn-kiosk-addcontact" data-name="{{name}}" data-address="{{email_id}}" data-action="modal"> <a role = "button" title="{{str_btn_add_recipient_attr}}" href="#">&nbsp;</a> </span> </li> ',contacts_in_ab:'<li> <span class="btn lozenge btn-contact left small right" data-name="{{name}}" data-address="{{email_id}}" data-action="contact-menu"> <a role = "button" title="{{str_btn_recipient_lozenge_attr}}" href="#">{{msg_display_name}}</a> </span> </li> ',global_auto_add_contacts:'checked=""',new_recipients1:'<div class="field"> <div class="checkbox"> <label><input type="checkbox" {{global_auto_add_contacts}} class="checkbox"> {{str_comp_auto_add_to_contacts}} </label> </div> </div>'};},"1.0.0");YUI.add("minty_module_toolbar_inbox_sent_msg_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_toolbar_inbox_sent_msg_rollup={base:'<div id="pagetoolbar" class="{{msgliststate}}"> {{is_reply}} {{sending_error}}</div>',is_reply:'<span class="btn left right hidden"><a href="#" data-action="back-to-message" title="{{str_toolbar_back_to_message}}">{{str_toolbar_back_to_message}}</a></span> <span class="btn left hidden"><a class="icon prev" href="#" data-action="prev" title="{{str_next_attr}}"><i>{{str_next}}</i></a></span><span class="btn right hidden"><a class="icon next" href="#" data-action="next" title="{{str_previous_attr}}"><i>{{str_previous}}</i></a></span> ',backtomsg:'<span class="btn left right"><a href="#" data-action="backtomsg" title="{{str_comp_back_to_msg_attr}}">{{str_comp_back_to_msg}}</a></span>',tryagain:'<span class="btn left right"><a href="#" data-action="retry" title="{{str_comp_try_again_attr}}">{{str_comp_try_again}}</a></span>',abuse:'<span class="btn left right"><a href="#" data-action="navigate">{{str_comp_done}}</a></span>',sending_error:"{{backtomsg}}{{tryagain}}{{abuse}} "};},"1.0.0");YUI.add("minty_module_toolbar_inbox_sent_msg_thread_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_toolbar_inbox_sent_msg_thread_rollup={base:'<div id="pagetoolbar" class="{{msgliststate}}"> {{sending_error}}</div>',backtomsg:'<span class="btn left right"><a href="#" data-action="backtomsg" title="{{str_comp_back_to_msg_attr}}">{{str_comp_back_to_msg}}</a></span>',tryagain:'<span class="btn left right"><a href="#" data-action="retry" title="{{str_comp_try_again_attr}}">{{str_comp_try_again}}</a></span>',abuse:'<span class="btn left right"><a href="#" data-action="navigate">{{str_comp_done}}</a></span>',sending_error:"{{backtomsg}}{{tryagain}}{{abuse}} "};},"1.0.0");YUI.add("_shared_module_send_confirm_captcha_blocked",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_send_confirm_captcha_blocked={base:"{{message_blocked}}{{account_blocked}}",message_blocked:'<div class="error"> <strong>{{str_comp_captcha_msg}}</strong> <p>{{str_comp_captcha_msg_suspicious_activity}}</p> <p>{{str_comp_captcha_msg_contact_cust_care}}</p> <p>{{str_comp_captcha_apology}}</p></div>',account_blocked:'<div class="error"> <strong>{{str_comp_captcha_account}}</strong> <p>{{str_comp_captcha_account_suspicious_activity}}</p> <p>{{str_comp_captcha_account_contact_cust_care}}</p> <p>{{str_comp_captcha_apology}}</p></div>'};},"1.0.0");YUI.add("comms-lozenge",function(D){var C=D.Lang;var B=D.comms.Utils.escapeHtml;function A(E){A.superclass.constructor.apply(this,arguments);}A.NAME="lozenge";A.ATTRS={data:{value:{value:""},setter:"_setData"},segmentCount:{value:1},segmentTypes:{value:[]},segmentHovers:{value:[]},labelSegment:{value:0},label:{valueFn:"_defEscapeDataValueFn"},validate:{value:false},error:{value:false},selectable:{value:true},selected:{value:false}};A.LOZENGE_TEMPLATE='<span class="lozengeSegment {segclass}"><a tabindex="0" role="button">{label}</a></span>';D.extend(A,D.Widget,{initializer:function(F){var E=F.data||{};if(this.get("validate")){this.set("error",this._isError(E));}},destructor:function(){this._lozengeNode=null;},renderUI:function(){var I,E,J,G,H,L,M,F=[],K;E=this.get("segmentCount");J=this.get("segmentTypes");L=this.get("labelSegment");K=this.get("contentBox");M=this.get("label");for(I=0;I<E;I++){G=D.substitute(A.LOZENGE_TEMPLATE,{label:(L==I)?M:"",segclass:J[I]});H=D.Node.create(G);F.push(H);if(I==L){this._lozengeNode=H;}K.appendChild(H);}F[0].addClass("left");F[E-1].addClass("right");},bindUI:function(){this.after("dataChange",this._afterDataChange);this.before("selectedChange",this._beforeSelectedChange);this.after("selectedChange",this._afterSelectedChange);this.after("errorChange",this._afterErrorChange);this.get("contentBox").delegate("click",this._onClick,".lozengeSegment",this);},syncUI:function(){this._updateUI();var E=this.get("boundingBox");E.lozengeObj=this;},removeSegment:function(F){var K,E,I,J,H,G;K=this.get("segmentCount");if(F<0||F>(K-1)){return;}if(K==1){}E=this.get("segmentTypes");I=this.get("labelSegment");J=this.get("contentBox");H=J.all(".lozengeSegment");G=H.item(F);K--;if(K){if(F==0){H.item(1).addClass("left");}else{if(F==K){H.item(K-1).addClass("right");}}}G.remove(true);E.splice(F,1);this.set("segmentCount",K);if(F==I){I=null;}},_defDataValueFn:function(){var E=this;return function(){return E.get("data").value||"";};},_defEscapeDataValueFn:function(){var E=this;return B(E.get("data").value||"");},_isError:function(E){E=E||this.get("data");return !!(E.value);},_setData:function(E,F){E=E||"";if(typeof(E)!=="object"){return{value:E.toString()};}return E;},_afterDataChange:function(F){var E=B((F.newVal.value)?F.newVal.value:F.newVal);this.set("label",E);this.get("segmentHovers")[this.get("labelSegment")]=E;this._updateUI();},_afterSelectedChange:function(F){var E=this.get("boundingBox");if(F.newVal){E.addClass("lozengeSelected");}else{E.removeClass("lozengeSelected");}},_beforeSelectedChange:function(E){if(!this.get("selectable")){E.preventDefault();}},_afterErrorChange:function(F){var E=this.get("boundingBox");if(F.newVal){E.addClass("lozengeError");}else{E.removeClass("lozengeError");}},_onClick:function(G){var E=this.get("contentBox");var I=this.get("segmentTypes");var H=E.all(".lozengeSegment");var F=H.indexOf(G.currentTarget);this.fire(this.name+":segmentClick",F,I[F]);},_updateUI:function(){var F,I,K,H=this.get("boundingBox"),J=this.get("contentBox").all(".lozengeSegment"),L=this.get("segmentCount"),E=this.get("segmentHovers"),G=this.get("labelSegment");for(F=0;F<L;F++){I=J.item(F);K=I.one("a");I.setAttribute("title",E[F]);if(F==G){K.setContent(this.get("label"));}else{K.setContent("&nbsp;<b></b>");}}if(this.get("error")){H.addClass("lozengeError");}else{H.removeClass("lozengeError");}if(this.get("selected")){H.addClass("lozengeSelected");}else{H.removeClass("lozengeSelected");}}});A.prototype.BOUNDING_TEMPLATE="<li></li>";A.prototype.CONTENT_TEMPLATE="<span></span>";D.namespace("comms");D.comms.Lozenge=A;D.comms.LozengeUtils={updateABSegments:function(U,E){var K,J,O,H=[],L=[],N=[],Q,T,M,G,P,S,R,I,F=[];for(O in E){S="";M=E[O]["fields"];for(K=0,J=M.length;K<J;K++){T=M[K];if(T["type"]=="email"){P=T["value"];}else{if(T["type"]=="name"){G=T["value"];S=D.common.Utils.substitute(strings["str_name_format"],{given_name:G.givenName,family_name:G.familyName});}}}H.concat(E[O]["id"]||null);L=L.concat(P);N=N.concat(S||P);}I=U.all(".plus");I.each(function(Z){var W=Z.ancestor(".yui3-lozenge"),Y=W.lozengeObj,V=Y.get("data.email"),X="";for(R=0;R<L.length;R++){X=L[R];if(X==V){F.push(W);Y.removeSegment(1);Y.set("data",{name:N[R]||X,email:X,cid:H[R]});}}});return F;}};},"0.0.1",{requires:["node","widget","substitute","comms-utils"]});YUI.add("comms-lozenge-address",function(D){var C=D.Lang;var A=D.comms.Utils.escapeHtml;function B(){}B.ATTRS={data:{value:{name:"",email:"",isNN:""},setter:"_setData"},segmentCount:{value:2},segmentTypes:{value:["name","plus"]},labelSegment:{value:0},label:{valueFn:function(){var E=this.get("data");return A(E.name||E.email||"");}},segmentHovers:{valueFn:function(){var E=this.get("data");if(E.name==E.email){return["",""];}else{return[E.email,""];}}},validate:{value:true}};B.prototype={_isError:function(E){var F=(E&&E.data&&E.data.email)||this.get("data.email");if(F){return !(this._isValidEmail(F));}return false;},_setData:function(F,G){var E,H;if(typeof(F)!=="object"){E=F.toString();F={name:"",email:E};}else{if(!F.email){return D.Attribute.INVALID_VALUE;}}return F;},_isValidEmail:function(F){var K=this,J,I,E,G,H=/^([^@ ;:()\[\],<>\\]+@[^@ ;:()\[\],<>\\]+\.[^@ ;:()\[\],<>\\]+)/;F=F||K.get("data").email;if(!H.test(F)){return false;}G=F.split("@");J=G[0];I=G[1];if(!I||!J){return false;}G=I.split(".");E=G[1];if(!E){return false;}return F;},_afterDataChange:function(I){var H,G,J,F=I.newVal.name,E=I.newVal.email;if(!F||(F===E)){F=A(E);G="";}else{F=A(F);G=E;}this.set("label",F);J=this.get("labelSegment");this.set("segmentHovers."+J,G);if(this.get("validate")){H=this._isValidEmail(E);this.set("error",!H);}this._updateUI();}};D.namespace("comms");D.comms.LozengeAddressMod=B;D.comms.AddressLozenge=D.Base.create("addressLozenge",D.comms.Lozenge,[D.comms.LozengeAddressMod]);},"0.0.1",{requires:["base-build","comms-lozenge"]});YUI.add("mail-ui-sendconfirmview-base",function(D){var i=D.common.persist.UserData,W=D.mail.persist.MetaData,q=D.mail.Controller.SendConfirm,k=D.mail.Controller.Compose,R=D.ui.Templates,n=D.common.Utils,y=D.common.Utils.substitute,F=R._shared_module_send_confirm_rollup,t=(NeoConfig.hasConv||NeoConfig.hasConvRelease)?R.minty_module_toolbar_inbox_sent_msg_thread_rollup:R.minty_module_toolbar_inbox_sent_msg_rollup,X=D.mail.ui.Toolbar,a=R._shared_module_send_confirm_recipients_rollup,M=D.Node.create,u="hidden",T=200,x=strings["str_cfg_tog_monster_ad_send_l10n"],Z=D.mail.ui.SearchBar,d=D.common.Utils.escapeHtml,B;var p=function(Y){var AD=this,AC,AA,AB,z=Y.sdo;AD.title="Message Sent";AD.isReply=Y.isReply;AD.isForward=Y.isForward;AD.parent=null;AD.loading=null;AD.error=null;AD.success=null;AD.isAbuseDetected=false;AD.toolong=null;AD.author=Y.author;AD.mainCol=null;AD.sendingError=false;AD.sendingErrorElse=false;AD.autoAddContacts=(i.get("userSendPref.addUnknownContact")=="always"&&!NeoConfig.isAMT)?"always":"prompt";AD.focusNode=null;AD.adNode=null;AD.formatters={msg_replied_to:function(){return"";},is_reply:function(){return"";},message_sent_success:function(){return y(F.message_sent_success,{},AD.formatters,null,strings,R);},sending_error_else:function(){return y(F.sending_error_else,{},AD.formatters,null,strings,R);},sending_error:function(){return y(F.sending_error,{},AD.formatters,null,strings,R);},is_im:function(){return"";},is_reply_else:function(){return AD.isReply?y(F.is_reply_else,{},AD.formatters,null,strings,R):"";},global_path_img:function(){return"/ued/assets/img";}};AD.tbFormatters={is_reply:function(){return(AD.isReply||AD.isForward)&&!AD.sendingError&&NeoConfig.send_confirm_nav_enabled?y(t.is_reply,{},AD.tbFormatters,null,strings,R):"";},sending_error:function(AE){return AD.sendingError?y(t.sending_error,AE,AD.tbFormatters,null,strings,R):"";},backtomsg:function(AE){return(AE&&!AE.backtomsg)?"":y(t.backtomsg,AE,AD.tbFormatters,null,strings,R);},tryagain:function(AE){return(AE&&!AE.tryagain)?"":y(t.tryagain,AE,AD.tbFormatters,null,strings,R);},abuse:function(AE){return(!AE||!AE.abuse)?"":y(t.abuse,AE,AD.tbFormatters,null,strings,R);}};p.superclass.constructor.call(AD);AD.modifyAttr("canClose",{getter:AD.canWeClose});AD.on("closeChange",AD.handleCloseChange,AD);AD.after("activeChange",AD.handleAfterActiveChanged,AD);AD.updateToolbar();AD.setAllButtonState(false);AD.set("charCodes","13");AD.bindSDO(z);};function m(z){var AA=this,Y;z=z||{backtomsg:true,tryagain:true,abuse:false};Y=M(y(t.base,z,AA.tbFormatters,null,strings,R));AA.author.attachToolbar(new X({root:Y}));}function l(Y){var z=this;z.sdo=Y;z.sdo.after("sendactionChange",function(AA){var AB=AA.newVal.action;switch(AB){case"success":B=AA.newVal.args.addy;z.showSuccess(AA.newVal.args.addy);break;case"captcha":z.showCaptcha(AA.newVal.args.fault);break;case"error":z.showError(null,null,AA.newVal.args.fault);break;case"abuse":z.showAbuse(null,null,null);break;default:break;}});}function O(Y){var AA=this,z=Y?Y.dataAction:0;switch(z){case"back-to-message":case"next":case"prev":AA.author.backToMessageTab&&AA.author.backToMessageTab(z);break;case"retry":AA.retrySendMessage();break;case"backtomsg":AA.backToMessage();break;default:break;}}function A(){var Y=this;Y.resetLoading();if(Y.sendingError){Y.sendingError=false;}Y.hideStatusBoxes();Y.adNode&&Y.adNode.get("parentNode").removeChild(Y.adNode);Y.loading.removeClass(u);Y.updateToolbar();Y.set("forceClose",1);Y.author.removeChild(Y);Y.author.showCompose(true);}function r(AA){var Y=D.one("#pagetoolbar"),z;z=Y.all("a");z.each(function(AB){if(AB.getAttribute("data-action")==AA){AB.ancestor().toggleClass("disabled");return;}});}function V(AA){if(D.Lang.type(AA)!="boolean"){return;}var Y=D.one("#pagetoolbar"),z;if(Y){z=Y.all("span");z.each(function(AB){AB.removeClass("disabled");});}}function K(z){var AB=this,AA=z.keyCode,Y=false;switch(AA){case 13:if(!z.ctrlKey&&!z.metaKey&&!z.altKey&&!z.shiftKey){if(!AB.success.hasClass(u)){z.target.simulate("click");Y=true;}else{Y=true;}}break;case 188:if(z.metaKey){break;}case 190:if((AA==188||AA==190)&&!z.ctrlKey){break;}AB.handleToolbarSelection({dataAction:(AA==188?"prev":"next")});Y=true;z.halt();break;default:break;}return Y;}function N(){var z=this,Y;Y=z.success.one("input.checkbox").get("checked")?"always":"prompt";if(!NeoConfig.isAMT){if(z.autoAddContacts!=Y){i.set("userSendPref.addUnknownContact",Y);i.saveOne("userSendPref.addUnknownContact");}}}function Q(z){var AA=this,Y;if(z.newVal==1&&!AA.success.hasClass(u)){if(AA.addToABHandler){D.detach(AA.addToABHandler);}Y=D.all("body>#menu-contact-compact");if(Y){Y.remove();Y.destroy(true);}if(AA.success.one("input.checkbox")){AA.setAutoAddContacts();}AA.parent&&AA.parent.remove(true);}}function h(){return false;}function f(Y){if(Y.newVal==1){NeoConfig.send_confirm_nav_enabled&&this.showToolbarButtons();}}function w(){var z=this,Y;Y=z.success.one(".btn");D.on("keydown",function(AA){if(AA.keyCode===32){AA.preventDefault();AA.target.simulate("click");}},Y,z);D.on("click",function(AA){AA.halt();z.author.set("forceClose",1);z.author.set("close",1);},Y,z);z.mainCol.delegate("click",function(AG){var AF=AG.currentTarget,AA=AF.lozengeObj,AB=AG.target,AC=AB.ancestor(".lozengeSegment",true),AE=AA.get("data.name"),AD=AA.get("data.email");if(AC.hasClass("plus")){if(AE===AD){AE="";}D.fire("addContact",AE,AD);}},".yui3-lozenge");z.mainCol.all(".inline-items").on("keydown",function(AC){var AB=D.UA.os,AA=(AB=="windows"||AB=="win");if((AA&&AC.shiftKey&&AC.keyCode==121)||(!AA&&AC.ctrlKey&&AC.shiftKey&&AC.altKey&&AC.keyCode==77)){AC.preventDefault();n.simulateContextMenu(AC.target);}});z.mainCol.all(".inline-items").on("contextmenu",function(AD){AD.halt();var AF=AD.target.ancestor(".yui3-lozenge"),AA,AB,AC,AE,AG=AD.target;if(D.Lang.isNull(AF)){return false;}AA=AF.lozengeObj;AB=AF.one(".lozengeSegment");AE=AA.get("data.name");AC=AA.get("data.email");D.use("contacts-ui-contact-popup",function(AK){var AH=!AF.one(".plus"),AI=AA.get("data.cid")||"",AJ={name:AE,email:AC,cid:AI,editable:false,inAB:AH,copyable:true};
AJ.stateChangeCB=function(AL){if(AL.state=="show"){AF.addClass("lozenge-open-menu");}else{AF.removeClass("lozenge-open-menu");AG&&AG.focus();}};AK.mail.ContactPopup.showContactMenu(AK.mail.ContactPopup.TYPE_INTERMEDIATE,AB,AJ);});return true;});D.on("SentSuccess",function(AE){var AF=this,AA,AB,AD,AC=(B.contactsAdded==0&&B.unknown.length==0);AA=W.get("cg.pref.general.showconfirmpage");if(!(NeoConfig.expUltMode!="0"&&NeoConfig.expBucketId=="scf_test")&&(D.Lang.isUndefined(AA)||!(AA=="0"||(AA=="n"&&AC)))){if(AE.action=="reply_all"||AE.action=="reply_sender"||AE.action=="forward"){AB=D.mail.model.DataStore.Folders.get(AE.fid);AD=D.mail.ui.common.StringUtils.getSystemFolderName(AE.fid,AB.folderInfo.name);D.use("mail-ui-messagepane-utils",function(AG){var AH=this;AH.fire("darlaEvent",{action:"sent",value:{siteAttr:AG.mail.ui.MessagePaneUtils.getAdSiteAttribsFromMesgObj(AE.oMsg,AE.fid),foldername:AD}});});}else{AF.fire("darlaEvent",{action:"sent"});}}});}function g(AA){var AB=this,z,Y;if(AA){AB.parent=AA;Y=x?{is_mon:y(F.is_mon,{},AB.formatters,null,strings,R)}:{is_lrec:F.is_lrec};z=y(F.base,Y,AB.formatters,null,strings,R);AA.append(M(z));AB.mainCol=AA.one(".col-a");AB.loading=AB.mainCol.one(".loading").ancestor();AB.success=AB.mainCol.one(".success").ancestor();AB.error=AB.mainCol.one(".error").ancestor();AB.bindUI();}}function b(Y){var z=this;z.adNode=x?Y.one("#slot_MON_sent"):Y.one("#slot_LREC_sent");z.adNode&&z.adNode.addClass(u);}function P(){var Y=this;Y.hideStatusBoxes();Y.loading.removeClass(u);}function U(){var AB=this;var AA=true;if(AB.dirty==="ForceClose"){return true;}var Y=AB.isDirty();if(Y){AA=false;var z='<span id="{{btnID}}ModalOverlay" class="btn left right {{default}}"><a href="#" data-action="{{btnID}}">{{btnLabel}}</a></span>';D.use("common-ui-dialog-helper",function(AH){var AG=y(z,{btnID:"SaveDraft","default":"default",btnLabel:strings["str_comp_savetodrafts"]});var AC=y(z,{btnID:"DontSave",btnLabel:strings["str_comp_abandon"]});var AD=y(z,{btnID:"Continue",btnLabel:strings["str_comp_keepwriting"]});var AF={modal_classes:"lg",hd:strings["str_comp_close"],bd:strings["str_comp_close_confirm"],ft:AG+AC+AD};var AE={SaveDraft:{handler:function(){AB.author.composeView._invokeSaveDraft({forceSave:true});AB.dirty="ForceClose";AB.author.set("forceClose",1);AB.author.set("close",1);}},DontSave:{handler:function(){AB.dirty="ForceClose";AB.author.set("forceClose",1);AB.author.set("close",1);}},Continue:{handler:function(){AB.backToMessage();}}};AH.common.ui.DialogHelper.createCommon(AF,AE);});}return AA;}function e(){var Y=this;Y.success.addClass(u);Y.loading.addClass(u);Y.error.addClass(u);}function H(AA,z,AE){var AF=this,AD,Y,AB,AC=["str_cascd_ExceededMaxTo","str_cascd_ExceededMaxCc","str_cascd_ExceededMaxBcc","str_cascd_ExceededMaxRecipients","str_cascd_ExceededMaxHourlyMessages","str_cascd_ExceededMaxDailyMessages","str_cascd_InvalidRecipientAddress"];AF.sendingError=true;AA=AA||function(){var AG=[],AH=AE.code.replace(/[^\.]*\./,"");AG.sending_error_msg=strings.str_comp_send_error;AG.sending_error_detail=strings["str"+"_cascd_"+AH]||"["+AH+"]";return y(F.sending_error,null,null,null,AG,R);}();AF.updateToolbar(z);AF.hideStatusBoxes();AD=AF.error.get("children");AD.each(function(AG){AG.remove();});AF.error.appendChild(M(AA));AF.error.removeClass(u);Y=D.one("a[data-action=backtomsg]");if(Y){Y.focus();}AB=D.one("#pagetoolbar");if(AB){D.delegate("keydown",function(AG){if(AG.keyCode===13){AG.target.simulate("click");}},AB,"a",AF);}if(NeoConfig.tmpForceAdSendTest){AF.adNode&&AF.adNode.removeClass(u);}}function I(z,Y,AD){var AE=this,AC,AB,AA;if(!Y){Y={tryagain:false,backtomsg:false,abuse:true};}AE.isAbuseDetected=true;AE.sendingError=true;z=z||function(){var AF=[];AF.sending_error_msg=strings.str_comp_send_abuse_error;AF.sending_error_detail="";return y(F.sending_error,null,null,null,AF,R);}();AE.updateToolbar(Y);AE.hideStatusBoxes();AC=AE.error.get("children");AC.each(function(AF){AF.remove();});AB=D.one('#pagetoolbar a[data-action="navigate"]');D.on("keydown",function(AF){if(AF.keyCode===32||AF.keyCode===13){AF.preventDefault();AF.target.simulate("click");}},AB,AE);D.on("click",function(AF){AE.author.set("forceClose",1);AE.author.set("close",1);AF.halt();},AB,AE);AE.error.appendChild(M(z));AE.error.removeClass(u);if(AB){AB.focus();}if(NeoConfig.tmpForceAdSendTest){AE.adNode&&AE.adNode.removeClass(u);}}function L(Y){var z=this;if(/AccountVerificationRequired/.test(Y.code)){z.doBlocked({type:"account"});return;}else{if(/CannotSendThisMessage/.test(Y.code)){z.doBlocked({type:"message"});return;}}if(NeoConfig.tmpForceAdSendTest){z.adNode&&z.adNode.removeClass(u);}D.use("mail-ui-captcha-controller",function(AC){var AA,AB={data:Y.detail,contCbk:AC.bind(function(AD){z.retrySendMessageWithCaptcha(AD);},z),cancelCbk:AC.bind(function(){z.backToMessage();},z)};AA=new AC.mail.ui.CaptchaController(AB);AA.show();});}function C(AC){var AD=this,z,Y,AA,AB=R._shared_module_send_confirm_captcha_blocked;Y={tryagain:false,backtomsg:true,abuse:false};AA=AC.type==="message"?AB.message_blocked:AB.account_blocked;z=y(AA,null,null,null,strings,R);AD.showError(z,Y);}function J(z){var AA=this,Y;if(z.value){AA.resetLoading();AA.sendingError=false;AA.updateToolbar();AA.setAllButtonState(false);if(z.captchaView=="audio"){AA.sdo.set("captcha",{"X-HumanVerification-AudioUrl":z.url,"X-HumanVerification-Answer":z.value});}else{AA.sdo.set("captcha",{"X-HumanVerification-ImageUrl":z.url,"X-HumanVerification-Answer":z.value});}var Y=new n.Stopwatch("SendConfirm","start");Y.action="captcha";q.sendMessage(AA.sdo,Y);}}function E(){var z=this,Y;z.resetLoading();var Y=new n.Stopwatch("SendConfirm","start");Y.action="retry";q.sendMessage(z.sdo,Y);}function S(){var Y=this;Y.sendingError=false;Y.updateToolbar();Y.hideStatusBoxes();Y.loading.removeClass(u);Y.loading.one("h3").set("text",strings["str_comp_sending"]);}function G(AD){var AP=this,Aa=AP.success.one(".inline-items"),AX=W.get("cg.pref.general.showconfirmpage"),Ab=AD.known,AZ=AD.unknown,AT,AS,AC,AH,AR,AV,AN,AW=Z.getSearchField(),AJ=0,AM,AI,z,AO,AG=[],AK="",AF=Ab.length+AZ.length,AB=5,AU=8,AE=0,AA=0,AY=160,Y=AF>AB,AL=function(Ac){var Ad;
if(Ac.name){return Ac.name;}else{if(Ac.first){Ad=y(strings["str_name_format"],{given_name:Ac.first||"",middle_name:"",family_name:Ac.last||""});return Ad.replace("  "," ");}else{return Ac.email;}}};AP.after("activeChange",function(Ac){if(Ac.newVal==0){AP.author.set("forceClose",1);AP.author.set("close",1);}});AP.after("closeChange",function(Ac){if(Ac.newVal){AP.author.set("forceClose",1);AP.author.set("close",1);}},AP);AP.on("activeChange",function(Ac){if(Ac.newVal==1){AP.fire("darlaEvent",{action:"sent"});}});if((NeoConfig.expUltMode!="0"&&NeoConfig.expBucketId=="scf_test")||(!D.Lang.isUndefined(AX)&&(AX=="0"||(AX=="n"&&(AD.contactsAdded==0&&AD.unknown.length==0))))){if(AP.author.subview){AP.author.subview.dirty="ForceClose";}AP.author.set("forceClose",1);AP.author.set("close",1);return;}AP.setAllButtonState(true);AP.hideStatusBoxes();AP.success.removeClass(u);function AQ(Af,Ae){var Ag=Af.email,Ad=Ag.toLowerCase(),Ac=Af.cid||"";if(D.Array.indexOf(AG,Ad)==-1){AG.push(Ad);AC=AL(Af);AH=(!AC||AC==Ag)?"":Ag;if(Y){AA+=AC.length;if(AJ==AU||(AA>AY&&AJ>=AB)){AE=AF-AJ;Y=false;}}AO={data:{name:AC,email:Ag,cid:Ac},segmentHovers:[AH,y(strings["str_btn_add_recipient_attr"],{email_id:Ag})],segmentCount:Ae?1:2};z=new D.comms.AddressLozenge(AO);z.render(Aa);if(AE){z.get("boundingBox").addClass(u);}AJ++;}}AT=AZ.length;if(AT){for(AS=0;AS<AT;AS++){AQ(AZ[AS],false);}AK=y(a.new_recipients1,{"global_auto_add_contacts":(AP.autoAddContacts=="always"?y(a.global_auto_add_contacts,{},null,null,strings,R):"")},null,null,strings,R);AV=M(AK);AP.success.appendChild(AV);AI=function(Aj){var Af,Ai,Ad,Ah,Ac,Ag=Aj.details[0],Ae=Ag.created;Ah=D.comms.LozengeUtils.updateABSegments(Aa,Ae);Ac=Ah.length;for(Af=0;Af<Ac;Af++){Ai=Ah[Af];if(Ai.menu){Ad=Ai.lozengeObj;D.mail.ContactPopup.updateContactMenu(Ai,{name:Ad.get("data.name"),email:Ad.get("data.email"),cid:Ad.get("data.cid")});}}};AP.addToABHandler=D.on("contacts:api:contactChanged",AI);}AG=[];AT=Ab.length;if(AT){for(AS=0;AS<AT;AS++){AQ(Ab[AS],true);}}if(AE){AK='<li style="vertical-align:top"><span style="vertical-align:baseline;" class="small btn left right" data-action="more"><a role="button" href="#" title="{{str_msg_hdr_btn_more_attr}}">{{str_msg_hdr_btn_more_to}}</a></span></li>';AK=y(AK,{has_more_to:AE},null,null,strings,R);AN=M(AK);Aa.appendChild(AN);AM=function(Ac){Aa.all("li").each(function(Ad){Ad.removeClass(u);});AN.addClass(u);};D.on("click",AM,AN);}AP.hideStatusBoxes();AP.success.removeClass(u);AP.showToolbarButtons();if(D.UA.ie){AW&&AW.focus();}AP.success.one("span.btn a").focus();AP.adNode&&AP.adNode.removeClass(u);}function v(){var z=this,Y;if(!NeoConfig.send_confirm_nav_enabled||z.get("active")==0||z.success.hasClass(u)){return;}Y=D.all("#pagetoolbar span");if(Y&&z.author.backToMessageTab){Y.each(function(AA){AA.removeClass(u);});}}function j(Y){var z=this;if(Y){Y.focus();z.registerFocus(Y);}}function s(Y){var z=this;z.focusNode=Y;if(z.author){z.author.set("focusNode",Y);}}function c(){var Y=this;Y.setFocus(Y.focusNode);}function o(){var Y=this;return(Y.success.hasClass(u)&&!Y.isAbuseDetected);}D.extend(p,D.mail.ui.BaseWidget,{NAME:"SendConfirmView",render:g,postrender:b,bindUI:w,canWeClose:U,showAbuse:I,showError:H,showCaptcha:L,showSuccess:G,hideStatusBoxes:e,handleToolbarSelection:O,onKeyDown:K,onFocus:h,handleAfterActiveChanged:f,retrySendMessageWithCaptcha:J,toggleButtonState:r,setAllButtonState:V,updateToolbar:m,backToMessage:A,retrySendMessage:E,showLoading:P,showToolbarButtons:v,resetLoading:S,handleCloseChange:Q,setAutoAddContacts:N,setFocus:j,registerFocus:s,restoreFocus:c,doBlocked:C,bindSDO:l,isDirty:o});D.namespace("mail");D.mail.SendConfirmView=p;if(NeoConfig.intl==="jp"){D.use("mail-ui-sendconfirmview-base-jp",function(z){z.mail.SendConfirmView=z.extend(z.mail.SendConfirmViewJp,z.mail.SendConfirmView);});}},"1.0.0",{requires:["common-utils","_shared_module_send_confirm_rollup","mail-controller-sendconfirm","_shared_module_send_confirm_recipients_rollup","minty_module_toolbar_inbox_sent_msg_rollup","minty_module_toolbar_inbox_sent_msg_thread_rollup","_shared_module_send_confirm_captcha_blocked","comms-lozenge-address","comms-ui-lozenge","mail-ui-searchbar"]});YUI.add("om-ui-sendconfirm",function(G){var B=G.om,D=B.Controller,A=D.Compose,H=D.Views,F=B.common.Utils,C="hidden";var E=function(){var I=this;I.appViewIds=[];E.superclass.constructor.apply(I,arguments);G.later(0,null,function(){G.fire("om:compose.sendstart",{sdo:I.sdo},I);});};G.extend(E,G.mail.SendConfirmView,{NAME:"OMSendConfirmView",attachAppView:function(I,O,J){if(!this.success){F.log("trying to attach view - but sendconfirm has not rendered","OMSendConfirm");return;}var N=this,R=I.app,P=O.view,K=(P in I.views&&I.views[P].type)||"",Q=H.getInternalUserViewId(R,"sendconfirm-"+P.replace(/\W/g,"_")+(+new Date())),M=N.success.one("div.items ul"),L=true;H.openView(R,I.instance,Q,P,K,"panel",O.context||null,J,O.width,O.height,0,"","api/openView",null,null,null,null,{renderParams:[M,L],parentWidget:N,appParams:O},function(){N.appViewIds.push(Q);});},detachAppViews:function(){var I=this;I.set("closing",1);G.each(I.appViewIds,function(J){H.closeView(J);});I.appViewIds=[];},handleCloseChange:function(I){var J=this;if(I.newVal==1&&!J.success.hasClass(C)){J.detachAppViews();}E.superclass.handleCloseChange.apply(J,arguments);},handleActiveChanged:function(I){var J=this;E.superclass.handleActiveChanged.apply(J,arguments);if(!J.success.hasClass(C)&&!J.author.get("closing")){if(I.newVal==0){J.detachAppViews();}}},backToMessage:function(){var I=this;I.detachAppViews();I.set("closing",0);E.superclass.backToMessage.apply(I,arguments);}});G.namespace("om.ui");G.om.ui.SendConfirmView=E;},"1.0.0",{requires:["mail-ui-sendconfirmview-base"]});