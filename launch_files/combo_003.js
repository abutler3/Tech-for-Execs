YUI.add("mail-ui-mailevents",function(G){G.namespace("mail.ui");var A=G.common.Utils.substitute,F=G.common.ui,E,D=NeoConfig.grayoutEnabled,C=[];var B=function(H){var I=this;I.KEY;I.strings;};G.mix(B.prototype,{remove:function(I,J,H){},move:function(J,I,K,H){},flag:function(K,L,J,H,I){},showNotification:function(H){},getAllHandleCallback:function(H,I){},print:function(H,I){},quickFilter:function(H){},addContact:function(H,J,I){},send:function(I,H){},getBulkOperations:function(H){},handleOpenDraft:function(I,H,J){},handleAction:function(I,K,J,H){},buttonEnabled:function(I){var H=G.mail.ui.ContextButton;return H?H.buttonEnabled(I):1;},removeMails:function(K,I,H){var J=this;H=H||{};H.header=strings.str_delete;H.dlgHandle=H.dlgHandle||{};H.dlgHandle.abortHandle=J.remove(I,K,H);},moveMails:function(J,I,L,H){var K=this;if(J==="%40C%40Chats"){return;}H=H||{};H.header=strings.str_move;H.dlgHandle=H.dlgHandle||{};H.dlgHandle.abortHandle=K.move(J,I,L,H);},setFlagSelected:function(J,L,O,H){var N=this,I,K={},M;H=H||{};H.header=N.getDataActionInfo(J).name;H.dlgHandle=H.dlgHandle||{};if(!H.hasMsgList&&O){M=O[0]&&O[0][N.KEY];if(G.Array.indexOf(C,M)>=0){return;}H[N.KEY]=M;C.push(M);}switch(J){case"unread":K.read=0;break;case"unflagged":K.flagged=0;break;case"notspam":K.ham=1;break;case"spam":K.spam=1;if(strings.str_cfg_tog_set_spam_read_flag){K.read=1;}G.fire("darlaEvent",{action:"mark_spam"});break;default:K[J]=1;break;}H.dlgHandle.abortHandle=N.flag(L,O,K,H,I);},createBulkOpCallback:function(H){var I=this;return{suppressCodes:["Client.MessageIdsNotFound"],success:function(){I.showNotification(H);if(!H.hasMsgList){C.splice(G.Array.indexOf(C,H[I.KEY]),1);}H.widget&&H.widget.vlist&&H.widget.vlist.clear();if(H.dlgHandle&&H.dlgHandle.destroy){H.dlgHandle.destroy();}if(strings.str_cfg_tog_timed_alert_dialog){G.use("mail-ui-message-timedalertdialog",function(J){J.mail.ui.messageTimedAlertDialogRender(H);});}},failure:function(){if(!H.hasMsgList){C.splice(G.Array.indexOf(C,H[I.KEY]),1);}if(H.dlgHandle&&H.dlgHandle.destroy){H.dlgHandle.destroy();}},progress:function(J){if(J.processed===0&&!(H.dlgHandle&&H.dlgHandle.destroy)){I.createProgressDialog(H);}else{if(H.dlgHandle&&H.dlgHandle.get){H.dlgHandle.get("contentBox").one("div.prog-indicator div.progress").setStyle("width",Math.floor((J.processed*100)/J.total)+"%");}}}};},createProgressDialog:function(I,H){G.use("attachments_css","common-ui-dialog-helper","_shared_module_offscreen_bin_progress_bar",function(N){var K=N.ui.Templates,J=N.common.ui.DialogHelper,L={cancel:{handler:function(){var P=I.dlgHandle||{};if(P.abortHandle&&P.abortHandle.abort){P.abortHandle.abort();}I.aborted=1;}}},M={},O={"delete":true,"spam":true,"notspam":true,"trash":true,"inbox-move":true,"move":true};M.hd=I.header;M.bd="<br /><br />"+A(K._shared_module_offscreen_bin_progress_bar.base,0,0,0,{progress:"0"});J.cancelDialog(M,L,function(P){if(I.dlgHandle&&I.dlgHandle.abortHandle){P.abortHandle=I.dlgHandle.abortHandle;}if(NeoConfig.fullPage&&O[I.action]){P.set&&P.set("adAction","disableRetriggerOnHide");}I.dlgHandle=P;I.aborted=0;if(H){H(P);}});});},confirmRemove:function(I,H,J){var L=this,K=I&&I.get&&I.get("selectCount");L.confirmRemoveBase("str_modal_message_delete_title",(typeof K!=="number"||K===1)?"str_modal_message_delete_single_question":"str_modal_message_delete_question",H,J);},confirmRemoveAll:function(K,H,J,L){var R=G.ui.Templates,Q=H.get("selectCount"),P="",I="",N="",M=strings.str_modal_message_delete_num_question,O;if(K==="%40B%40Bulk"){I="default";M=strings.str_empty_spam_conf;}else{if(K==="Trash"){M=strings.str_empty_trash_conf;}N="default";}if(Q){P=Q.toString();}O=A(M,0,0,0,{num_selected:P});G.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_generic",function(W){var X=A(R._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"ok","default":I,btnLabel:strings.str_ok}),T=A(R._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"cancel","default":N,btnLabel:strings.str_btn_cancel}),V={hd:strings.str_modal_message_delete_all_title,bd:O,ft:X+T,hasfetchAdsInCbk:NeoConfig.intl==="jp"},U={ok:{handler:function(){J();}},cancel:{handler:function(){L&&L();}}},S=function(Y){Y.set&&Y.set("adAction","disableRetriggerOnOk");};W.common.ui.DialogHelper.createCommon(V,U,S);});},confirmRemoveBase:function(K,J,H,I){G.use("common-ui-dialog-helper",function(){F.DialogHelper.confirm({hd:strings[K],bd:strings[J]},{ok:{handler:function(){H();}},cancel:{handler:function(){I&&I();}}});});},alertInvalidSelection:function(L,M,N,K){var O=this,H=["open","forward","reply_sender","reply_all","edit","fullheader","addcontact","set_encodings","print","reply-im","reply-sms","quick_filter"],I=G.Array.indexOf(H,M)!==-1,J=N==="%40C%40Chats";if(L===1||(L>1&&!I)){return 0;}if(D&&K){return !O.buttonEnabled(K);}G.use("common-ui-dialog-helper",function(){if(L===0){F.DialogHelper.alert({hd:strings.str_modal_no_msg_title,bd:strings[J?"str_modal_zero_selected_conv":"str_modal_zero_selected"]});}else{if(L>1){F.DialogHelper.alert({hd:strings.str_modal_too_many_msgs_title,bd:strings[J?"str_modal_select_single_message_conv":"str_modal_select_single_message"]});}}});return 1;},getDataActionInfo:function(J){var H=strings.str_move,I={"delete":{op:"remove",name:strings.str_delete},spam:{op:"spam",name:strings.str_spam},notspam:{op:"spam",name:strings.str_not_spam},read:{op:"flag",name:strings.str_menu_mark_read},unread:{op:"flag",name:strings.str_menu_mark_unread},flagged:{op:"flag",name:strings.str_menu_flag},unflagged:{op:"flag",name:strings.str_menu_clear_flag},trash:{op:"move",name:H},"inbox-move":{op:"move",name:H},"folder-new":{op:"move",name:H},move:{op:"move",name:H}};return I[J];},getSelectedHandleCallback:function(J,L,I,N){var M=this;if(N){M.handle(J,N,L);}else{if(I){var H=M.getDataActionInfo(J.action),K=I.get("selectCount");if(M.shouldShowProgressDialog(H,K)){G.mix(J,{dlgHandle:null,header:H.name});J.widget=I;M.createProgressDialog(J,function(){I.getSelected(function(O){M.handle(J,O,L);
});});}else{I.getSelected(function(O){M.handle(J,O,L,I);});}}}if(J.afterHandle){J.afterHandle(J.afterHandleParams);}},shouldShowProgressDialog:function(H,J){var L=this,I=L.getBulkOperations(H&&H.op),K;if(H&&I){K=I.fixed;if(K){return J>=K*2.5;}else{return 2*I.bs<=J;}}},handleUI:function(J,M,I,O){var N=this,K,L,H;E=E||G.one("#pagetoolbar");J=J||{};K=J.action;J.root=E;J.cancelCbk=J.cancelCbk||0;if(K==="delete"&&(L=G.mail.model.DataStore.Folders.get(M))&&L.total===0&&!L.isSystem&&!D){G.use("mail-ui-folderevents",function(P){P.mail.ui.FolderEvents.handle({dataAction:"folder-remove"},M);});return;}if((K!=="menu"&&K!=="move-menu")&&(!O&&I&&N.alertInvalidSelection(I.get("selectCount"),K,M,J))){return;}switch(K){case"delete":case"trash":N.handleOpenDraft();if(I&&I.selectAllNode.get("checked")&&I.get("selectCount")!==1){N.confirmRemoveAll(M,I,function(){N.getSelectedHandleCallback(J,M,I,O);});}else{if((K==="delete")&&((M==="Trash")||(M==="%40B%40Bulk")||(M==="%40C%40Chats"))){N.confirmRemove(I,function(){N.getSelectedHandleCallback(J,M,I,O);},J.cancelCbk);}else{N.getSelectedHandleCallback(J,M,I,O);}}break;case"folder-new":G.use("mail-ui-folderevents","mail-controller-folders",function(P){P.mail.ui.FolderEvents.createFolder(function(Q){Q.action=Q.action||"folder-new";H=function(){N.getSelectedHandleCallback(Q,M,I,O);};if(J.preHandle){J.preHandle(H);}else{H();}},"move");});break;case"redirectmsg":N.redirectMessages(function(){N.getSelectedHandleCallback(J,M,I,O);});break;case"folder-allread":J.action="read";J.filterBy={"filterBy-isRead":0};J.selection={isRead:0};N.getAllHandleCallback(J,M);break;default:N.getSelectedHandleCallback(J,M,I,O);break;}},handle:function(I,N,L,H){I=I||{};var M=this,K=I.action,J;if(I.aborted){return;}if(strings.str_cfg_tog_edit_draft_from_search&&K==="open"&&N[0].sourceFolderInfo.fid==="Draft"){I.action=K="edit";}if(I.tbAction){I.noScroll=true;}if(K==="move"&&strings.str_cfg_tog_flag_spam_on_move){if(I.fid==="%40B%40Bulk"){I.action=K="spam";}else{if(L==="%40B%40Bulk"){I.action=K="notspam";}}}switch(K){case"delete":M.removeMails(N,L,I);break;case"spam":case"notspam":case"read":case"unread":case"flagged":case"unflagged":M.setFlagSelected(K,L,N,I);break;case"trash":M.moveMails(L,"Trash",N,I);break;case"inbox-move":M.moveMails(L,"Inbox",N,I);break;case"folder-new":M.moveMails(L,I.fid,N,I);break;case"move":M.moveMails(L,I.fid,N,I);break;case"move-menu":G.fire("toolbar:ui-automation","menu","move");break;case"print":M.print(N[0],L);break;default:M.handleAction(I,N,L,H);}}});G.mail.ui.MailEvents=B;},"1.0.0",{requires:["mail-controller-messages","mail-controller-messages-ops","common-utils","common-ui-tabs-base","mail-model-datastore","comms-utils"]});YUI.add("mail-ui-messageevents",function(F){var B=F.mail.Controller.Messages,A=F.common.Utils.escapeHtml,D=F.comms&&F.comms.Utils,C=F.common.ui;var E=function(G){var H=this;H.KEY="mid";E.superclass.constructor.call(H,G);};F.extend(E,F.mail.ui.MailEvents,{remove:function(I,H,G){var J=this;return B.remove({fid:I,mid:H},J.createBulkOpCallback(G));},move:function(J,H,I,G){var K=this;G.totalMsgs=(I)?I.length:0;return B.move({sourceFid:J,destinationFid:H,mid:I},K.createBulkOpCallback(G));},flag:function(L,I,K,G,H){var N=this,J,M=strings.str_cfg_tog_flag_spam_on_move;G.totalMsgs=(I)?I.length:0;J={fid:L,mid:I,setFlags:K};if(K.ham&&G.fid!=="%40B%40Bulk"&&M){J.destFid=G.fid;}H=G.selection;if(H){J.selection=H;}return B.flag(J,N.createBulkOpCallback(G));},showNotification:function(G){var H=F.common.ui.Notification;if(H){H.msgNotification({action:G.action,totalMsgs:G.totalMsgs,fid:G.fid});}},getAllHandleCallback:function(I,K){var L=this,G=L.getDataActionInfo(I.action),H=I.numMid||0,J;if(H===0){return;}if(L.shouldShowProgressDialog(G,H)){J={fid:K,numMid:H};I.filterBy&&F.mix(J,I.filterBy);F.mix(I,{dlgHandle:null,header:G.name});L.createProgressDialog(I,function(){B.list(J,{success:function(M){L.handle(I,M.mid,K);}});});}else{L.handle(I,null,K);}if(I.afterHandle){I.afterHandle();}},print:function(H,G){F.use("mail-ui-print",function(){F.mail.ui.print({fid:G,msg:H});});},quickFilter:function(G){F.use("mail-ui-messagesview-quickfilter",function(H){H.mail.ui.QuickFilter.createDialog({msgHeader:G.header});});},addContact:function(H,J,M){var L,G,N,K,I,O=/[\s\S]+"cloud_id":(\d+)[\s\S]+/;if(J==="%40C%40Chats"){N=H.clickedAddress||H.header.from.email||"";G=H.clickedName||H.header.from.name||"";L=[];if(N==="mailbot@yahoo.com"&&(/^\d+$/).test(G)){L.push({type:"phone",value:G,flags:["MOBILE"]});}else{L.push({type:"name",value:D&&D.splitName&&D.splitName(G)});L.push({type:"email",value:N});K=H.body?O.exec(H.body.display):(NeoConfig.msgrData&&NeoConfig.msgrData.reply&&["",NeoConfig.msgrData.reply.cloud_id]);I={1:"LCS",2:"MSN",9:"IBM"};if(K&&K[1]&&I[K[1]]){L.push({type:"otherid",value:N,flags:[I[K[1]]]});}else{L.push({type:"yahooid",value:N.replace(/@yahoo\.(.+)/,function(Q,P){return(P==="cn")?Q:"";})});}}}else{if("msg"===M.context){N=H.header.from.email||"";G=H.header.from.name||"";}else{N=H.clickedAddress||"";G=H.clickedName||"";}}F.fire("addContact",G,N,L);},send:function(H,J){var I=J,M=I.header||{},L=M.from||{},K=L.email||"",G=NeoConfig.msgrData.reply||{};if(K==="mailbot@yahoo.com"){K=L.name;G.id=K;G.network="sms";G.cloud_id=undefined;NeoConfig.msgrData.reply=G;}if((H==="IM")&&(K.indexOf("@")<0)){K+="@yahoo.com";}if(K){F.fire("chats:send"+H,{id:K});}},getBulkOperations:function(G){return G&&B.bulkOps[G];},handleOpenDraft:function(J,G,L){var K,H,I,M=false;if(L==="Draft"){G.getSelected(function(N){for(H=0;H<N.length;H++){K=N[H];I=F.mail.Tabs.getTab(function(O){return O.type&&O.type==="author"&&O.matchOrigin({oMsg:K,fid:L,action:"delete"});});if(I){F.use("common-ui-dialog-helper",function(){C.DialogHelper.alert({hd:strings.str_branding_mail,bd:strings.str_modal_delete_open_draft});});M=true;return;}}});if(M){return;}}},handleAction:function(H,M,K,G){var L=this,J=H.action,I;switch(J){case"open":if(G&&G.sortedColumn&&(I=G.vlist)&&I.arrItems){F.fire("openMessage",{msg:M[0],fid:K,noScroll:H.tbAction,sortCol:G.sortedColumn,arrMsgSeq:I.arrItems,index:(I.rootSelect&&I.rootSelect.index)||null});}else{F.fire("openMessage",{msg:M[0],fid:K,noScroll:H.tbAction});}break;case"forward":F.fire("newMessage",F.mix(H,{fid:K,oMsg:M[0]}));break;case"forward_as_attachment":H.action="forward";H.forwardAsAttachment=true;F.fire("newMessage",F.mix(H,{fid:K,oMsg:M[0]}));break;case"reply_sender":F.fire("newMessage",F.mix(H,{fid:K,oMsg:M[0]}));break;case"reply_all":F.fire("newMessage",F.mix(H,{fid:K,oMsg:M[0]}));break;case"reply-im":L.send("IM",M[0]);break;case"reply-sms":if(NeoConfig.tog_hasSMS){L.send("Sms",M[0]);}break;case"edit":F.fire("editMessage",F.mix(H,{fid:K,oMsg:M[0]}));break;case"fullheader":L.fullHeader(M,K);break;case"addcontact":L.addContact(M[0],K,H);break;case"set_encodings":L.setEncoding(M,K);break;case"redirectmsg":L.doRedirect(M,K,document.getElementById("redirectMsg").value);break;case"quick_filter":L.quickFilter(M[0]);break;}},doRedirect:function(G,I,H){F.use("common-ui-dialog-helper","modal_css",function(P){var L=P.common.persist.UserData;var N=L.get("userSendPref");var K={name:"",email:""};if(N){K.name=N.defaultFromName;K.email=N.defaultFromAddress;}var O=[];for(var J=0;J<G.length;J++){O.push(G[J].mid);}var M=[];M.push({email:H});B.redirectMsg({fid:I,mid:O,resentFrom:K,resentTo:M},{success:function(){C.DialogHelper.alert({hd:"Redirect Messages",bd:"Message redirection <b>successful.</b>"});},failure:function(){C.DialogHelper.alert({hd:"Redirect Messages",bd:"Message redirection <b>failed.</b>"});}});});},redirectMessages:function(G){F.use("common-ui-dialog-helper",function(){C.DialogHelper.confirm({hd:"Redirect messages",bd:'Redirect to: &nbsp; <input id="redirectMsg" class="field-name " type="text" size="30" value="buggy_messages@yahoo.com" name="redirectMsg">'},{ok:{handler:function(I,H){G();H.destroy();},stopDestroy:true}});});},setEncoding:function(I,G){var H=this;F.use("mail-ui-message-encodings",function(J){J.mail.ui.MessageEncodings.setMessageEncoding(I,G);});},fullHeader:function(G,H){F.use("common-ui-dialog-helper",function(I){B.fullHeader({fid:H,mid:G[0].mid},{success:function(J){C.DialogHelper.alert({modal_classes:"lg",hd:strings.str_modal_full_header,bd:['<textarea readonly="true" style="width:100%;height:25em;" class="default">',J?A(J.rawheaders[0]):strings.str_error_no_body_returned,"</textarea>"].join(""),focusedNode:".default"});},failure:function(){C.DialogHelper.alert({hd:strings.str_modal_full_header,bd:strings.str_error_no_body_returned});}});});}});F.mail.ui.MessageEvents=new E();},"1.0.0",{requires:["mail-controller-messages","mail-controller-messages-ops","mail-model-datastore","mail-ui-mailevents"]});
